{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"fair-shares","text":"<p>Python library for calculating fair share allocations of global carbon budgets and emission pathways.</p>"},{"location":"#getting-started","title":"Getting Started","text":"Goal Start Here Install and run first allocation Quick Start Allocate budgets to countries country-fair-shares Work with IAMC model regions iamc-regional-fair-shares Understand equity principles Science Explore function signatures API Reference Extend the library Developer Guide"},{"location":"CONTRIBUTING/","title":"Contributing","text":""},{"location":"CONTRIBUTING/#core-rule","title":"Core Rule","text":"<p>Documentation must match the code. When they conflict, the code is correct and the docs are wrong.</p> <p>If you can't explain something accurately in simple terms, link to the authoritative source instead of inventing a simplified version.</p>"},{"location":"CONTRIBUTING/#documentation-hierarchy","title":"Documentation Hierarchy","text":"Layer Location Source of truth for Docstrings <code>src/fair_shares/library/</code> What the code does (LaTeX math, parameters, return types) Science docs <code>docs/science/</code> Why it works this way (principles, citations, design rationale) User guides <code>docs/user-guide/</code> How to use it (workflows, examples, quick reference) API docs <code>docs/api/</code> Auto-generated from docstrings via mkdocstrings <p>User guides may simplify, but only when the simplification remains accurate. If API docs are wrong, fix the docstring, not the docs.</p>"},{"location":"CONTRIBUTING/#before-merging-documentation-changes","title":"Before Merging Documentation Changes","text":""},{"location":"CONTRIBUTING/#ground-technical-claims","title":"Ground technical claims","text":"<p>Every claim about function behavior, formulas, or parameter effects must be traceable to a docstring, science doc, or test case. Add HTML comment cross-references:</p> Markdown<pre><code>&lt;!-- REFERENCE: per_capita_adjusted_budget() in src/fair_shares/library/allocations/budgets/per_capita.py\n     Mathematical details: docs/science/allocations.md --&gt;\n</code></pre>"},{"location":"CONTRIBUTING/#dont-invent-formulas","title":"Don't invent formulas","text":"<p>The allocation system uses multiplicative adjustments, not additive components. This is the most common documentation error:</p> <p>Wrong: \"With weights (0.5, 0.3, 0.2), the allocation is 50% population, 30% responsibility, 20% capability\"</p> <p>Right: \"Weights control the strength of inverse adjustments to population-based allocation. See <code>docs/science/allocations.md</code> for mathematical details.\"</p>"},{"location":"CONTRIBUTING/#test-code-examples","title":"Test code examples","text":"<p>Run every code example before documenting it. Verify output matches claims. Check that comments are accurate -- especially parameter explanations.</p>"},{"location":"CONTRIBUTING/#build-locally","title":"Build locally","text":"Bash<pre><code>uv run mkdocs serve\n</code></pre> <p>Check for broken links, missing front matter, and syntax warnings.</p>"},{"location":"CONTRIBUTING/#when-to-update-what","title":"When to Update What","text":"Change Update New parameter Docstring, <code>docs/science/allocations.md</code> if math changes, user guide if user-facing Bug fix Code first, then docstring if behavior changed, then check user guides for affected examples Clearer docs Read the docstring and science docs first, verify your version matches, add cross-reference comments"},{"location":"CONTRIBUTING/#getting-help","title":"Getting Help","text":"<ol> <li>Read the code -- docstrings in <code>src/</code> are authoritative</li> <li>Check <code>docs/science/allocations.md</code> for theoretical grounding</li> <li>Run a test to verify behavior</li> <li>Tag maintainers for review</li> </ol>"},{"location":"quickstart/","title":"Quick Start","text":"","boost":2},{"location":"quickstart/#prerequisites","title":"Prerequisites","text":"<ul> <li>Python 3.11+</li> <li>Git</li> <li>uv</li> </ul>","boost":2},{"location":"quickstart/#installation","title":"Installation","text":"Bash<pre><code>git clone https://github.com/setupelz/fair-shares.git\ncd fair-shares\nuv sync\n</code></pre> <p>Verify:</p> Bash<pre><code>uv run pytest tests/unit\n</code></pre>","boost":2},{"location":"quickstart/#running-notebooks","title":"Running Notebooks","text":"Bash<pre><code>uv run jupyter lab\n</code></pre> Workflow Notebook country-fair-shares <code>notebooks/301_custom_fair_share_allocation.ipynb</code> iamc-regional-fair-shares <code>notebooks/401_custom_iamc_allocation.ipynb</code> <p>See User Guide for detailed workflow documentation.</p>","boost":2},{"location":"api/","title":"API Reference","text":"<p>Documentation generated from docstrings.</p>"},{"location":"api/#modules","title":"Modules","text":"Module Description Budget Allocations Cumulative budget allocation functions Pathway Allocations Annual pathway allocation functions Allocation Manager High-level batch allocation interface Core Utilities Data manipulation functions Data Utilities Data processing and convergence prep Math Utilities Convergence solver and adjustments Adjustments Adjustment calculation functions Validation Input validation Convergence Validation Convergence-specific validation Configuration Models Pydantic configuration models"},{"location":"api/#see-also","title":"See Also","text":"<ul> <li>Allocation Approaches \u2014 Design rationale</li> <li>User Guide \u2014 Workflow documentation</li> </ul>"},{"location":"api/allocations/budgets/","title":"Budget Allocation Functions","text":"<p>Budget allocation functions distribute a fixed cumulative emission budget among countries in a given allocation year.</p>"},{"location":"api/allocations/budgets/#overview","title":"Overview","text":"<p>All budget allocation approaches return a <code>BudgetAllocationResult</code> containing:</p> <ul> <li><code>approach</code>: Name of the allocation approach used</li> <li><code>parameters</code>: Dictionary of parameters used in the calculation</li> <li><code>relative_shares_cumulative_emission</code>: DataFrame of budget shares (sum to 1.0)</li> </ul>"},{"location":"api/allocations/budgets/#per-capita-budgets","title":"Per Capita Budgets","text":""},{"location":"api/allocations/budgets/#equal_per_capita_budget","title":"equal_per_capita_budget","text":""},{"location":"api/allocations/budgets/#fair_shares.library.allocations.budgets.per_capita.equal_per_capita_budget","title":"fair_shares.library.allocations.budgets.per_capita.equal_per_capita_budget","text":"Python<pre><code>equal_per_capita_budget(\n    population_ts: TimeseriesDataFrame,\n    allocation_year: int,\n    emission_category: str,\n    preserve_allocation_year_shares: bool = False,\n    group_level: str = \"iso3c\",\n    unit_level: str = \"unit\",\n    ur: PlainRegistry = get_default_unit_registry(),\n) -&gt; BudgetAllocationResult\n</code></pre> <p>Equal per capita budget allocation for cumulative emissions.</p> <p>This function generates cumulative shares for the allocation year based on equal per capita principles.</p> Mathematical Foundation <p>Two allocation modes are supported:</p> <p>Mode 1: Dynamic shares (preserve_allocation_year_shares=False, default)</p> <p>Population shares are calculated using cumulative population from allocation_year onwards. This accounts for changes in relative population shares over time:</p> \\[ A(g) = \\frac{\\sum_{t \\geq t_a} P(g, t)}{\\sum_{g} \\sum_{t \\geq t_a} P(g, t)} \\] <p>Where:</p> <ul> <li>\\(A(g)\\): Budget share allocated to country \\(g\\)</li> <li>\\(P(g, t)\\): Population of country \\(g\\) in year \\(t\\)</li> <li>\\(t_a\\): Allocation year</li> <li>\\(\\sum_{t \\geq t_a} P(g, t)\\): Cumulative population of country \\(g\\) from allocation year onwards</li> <li>\\(\\sum_{g} \\sum_{t \\geq t_a} P(g, t)\\): Total cumulative population across all countries from allocation year onwards</li> </ul> <p>Mode 2: Preserved shares (preserve_allocation_year_shares=True)</p> <p>Population shares calculated at the allocation year are preserved. This means the relative allocation between groups remains constant:</p> \\[ A(g) = \\frac{P(g, t_a)}{\\sum_{g} P(g, t_a)} \\] <p>Where:</p> <ul> <li>\\(A(g)\\): Budget share allocated to country \\(g\\)</li> <li>\\(P(g, t_a)\\): Population of country \\(g\\) at allocation year \\(t_a\\)</li> <li>\\(\\sum_{g} P(g, t_a)\\): Total world population at allocation year</li> </ul> <p>Parameters:</p> Name Type Description Default <code>population_ts</code> <code>TimeseriesDataFrame</code> <p>Timeseries of population for each group of interest</p> required <code>allocation_year</code> <code>int</code> <p>Year from which to start calculating allocations and budgets. See docs/science/parameter-effects.md#allocation_year for how this affects country shares</p> required <code>emission_category</code> <code>str</code> <p>Emission category to include in the output</p> required <code>preserve_allocation_year_shares</code> <code>bool</code> <p>If False (default), shares are calculated using cumulative population from allocation_year onwards. If True, shares calculated at allocation_year are preserved</p> <code>False</code> <code>group_level</code> <code>str</code> <p>Level in the index which specifies group information</p> <code>'iso3c'</code> <code>unit_level</code> <code>str</code> <p>Level in the index which specifies the unit of each timeseries</p> <code>'unit'</code> <code>ur</code> <code>PlainRegistry</code> <p>The unit registry to use for calculations</p> <code>get_default_unit_registry()</code> <p>Returns:</p> Type Description <code>BudgetAllocationResult</code> <p>Container with relative shares for cumulative emissions budget allocation. The TimeseriesDataFrame contains only the allocation_year column with population shares that sum to 1 across groups for the specified emission category.</p> Notes <p>Theoretical grounding:</p> <p>See docs/science/allocations.md#equal-per-capita for detailed mathematical formulation, limitations, and when to use this approach.</p> <p>For translating the egalitarian tradition (which grounds the equal per capita principle) into code, see docs/science/principle-to-code.md#egalitarianism for implementation guidance.</p> <p>Examples:</p> <p>Calculate equal per capita budget allocation for 2020:</p> Python Console Session<pre><code>&gt;&gt;&gt; from fair_shares.library.utils import create_example_data\n&gt;&gt;&gt; data = create_example_data()\n&gt;&gt;&gt; result = equal_per_capita_budget(\n...     population_ts=data[\"population\"],\n...     allocation_year=2020,\n...     emission_category=\"co2-ffi\",\n... )\nConverting units...\n&gt;&gt;&gt; result.approach\n'equal-per-capita-budget'\n&gt;&gt;&gt; # Shares are proportional to population\n&gt;&gt;&gt; shares = result.relative_shares_cumulative_emission\n&gt;&gt;&gt; bool(abs(shares[\"2020\"].sum() - 1.0) &lt; 1e-10)  # Should sum to 1.0\nTrue\n</code></pre> <p>Using preserve_allocation_year_shares to fix shares at allocation year:</p> Python Console Session<pre><code>&gt;&gt;&gt; result_preserved = equal_per_capita_budget(\n...     population_ts=data[\"population\"],\n...     allocation_year=2020,\n...     emission_category=\"co2-ffi\",\n...     preserve_allocation_year_shares=True,\n... )\nConverting units...\n&gt;&gt;&gt; # Shares are based only on 2020 population, not cumulative from 2020 onwards\n&gt;&gt;&gt; result_preserved.parameters[\"preserve_allocation_year_shares\"]\nTrue\n</code></pre>"},{"location":"api/allocations/budgets/#per_capita_adjusted_budget","title":"per_capita_adjusted_budget","text":""},{"location":"api/allocations/budgets/#fair_shares.library.allocations.budgets.per_capita.per_capita_adjusted_budget","title":"fair_shares.library.allocations.budgets.per_capita.per_capita_adjusted_budget","text":"Python<pre><code>per_capita_adjusted_budget(\n    population_ts: TimeseriesDataFrame,\n    allocation_year: int,\n    emission_category: str,\n    country_actual_emissions_ts: (\n        TimeseriesDataFrame | None\n    ) = None,\n    gdp_ts: TimeseriesDataFrame | None = None,\n    responsibility_weight: float = 0.0,\n    capability_weight: float = 0.0,\n    historical_responsibility_year: int = 1990,\n    responsibility_per_capita: bool = True,\n    responsibility_exponent: float = 1.0,\n    responsibility_functional_form: str = \"asinh\",\n    capability_per_capita: bool = True,\n    capability_exponent: float = 1.0,\n    capability_functional_form: str = \"asinh\",\n    max_deviation_sigma: float | None = 2.0,\n    preserve_allocation_year_shares: bool = False,\n    group_level: str = \"iso3c\",\n    unit_level: str = \"unit\",\n    ur: PlainRegistry = get_default_unit_registry(),\n) -&gt; BudgetAllocationResult\n</code></pre> <p>Per capita budget allocation with responsibility and capability adjustments.</p> <p>This function generates cumulative shares for the allocation year based on adjusted per capita principles, incorporating historical responsibility and economic capability adjustments (but without Gini correction).</p> Mathematical Foundation <p>The per capita adjusted budget allocation adjusts for historical responsibility and economic capability using the following approach.</p> <p>Core Allocation Formula</p> <p>For budget allocation with dynamic shares (default mode):</p> \\[ A(g) = \\frac{\\sum_{t \\geq t_a} R(g) \\times C(g, t) \\times P(g, t)}{\\sum_g \\sum_{t \\geq t_a} R(g) \\times C(g, t) \\times P(g, t)} \\] <p>Where:</p> <ul> <li>\\(A(g)\\): Budget share allocated to country \\(g\\)</li> <li>\\(R(g)\\): Responsibility adjustment factor for country \\(g\\) (constant over time, equals 1.0 if not used)</li> <li>\\(C(g, t)\\): Capability adjustment factor for country \\(g\\) in year \\(t\\) (equals 1.0 if not used)</li> <li>\\(P(g, t)\\): Population of country \\(g\\) in year \\(t\\)</li> <li>\\(t_a\\): Allocation year</li> </ul> <p>Responsibility Adjustment</p> <p>Historical emissions reduce future allocation rights.</p> <p>For per capita responsibility (:code:<code>responsibility_per_capita=True</code>, default):</p> \\[ R(g) = \\left(\\frac{\\sum_{t=t_h}^{t_a-1} E(g, t)}{\\sum_{t=t_h}^{t_a-1} P(g, t)}\\right)^{-w_r \\times e_r} \\] <p>Where:</p> <ul> <li>\\(R(g)\\): Responsibility adjustment factor (inverse - higher emissions = lower allocation)</li> <li>\\(E(g, t)\\): Emissions of country \\(g\\) in year \\(t\\)</li> <li>\\(t_h\\): Historical responsibility start year</li> <li>\\(t_a\\): Allocation year</li> <li>\\(w_r\\): Normalized responsibility weight</li> <li>\\(e_r\\): Responsibility exponent</li> </ul> <p>For absolute responsibility (:code:<code>responsibility_per_capita=False</code>):</p> \\[ R(g) = \\left(\\sum_{t=t_h}^{t_a-1} E(g, t)\\right)^{-w_r \\times e_r} \\] <p>Capability Adjustment</p> <p>Economic capacity reduces allocation rights for wealthier countries.</p> <p>For per capita capability (:code:<code>capability_per_capita=True</code>, default):</p> \\[ C(g, t) = \\left(\\frac{\\text{GDP}(g, t)}{P(g, t)}\\right)^{-w_c \\times e_c} \\] <p>Where:</p> <ul> <li>\\(C(g, t)\\): Capability adjustment factor (inverse - higher GDP per capita = lower allocation)</li> <li>\\(\\text{GDP}(g, t)\\): Gross domestic product of country \\(g\\) in year \\(t\\)</li> <li>\\(w_c\\): Normalized capability weight</li> <li>\\(e_c\\): Capability exponent</li> </ul> <p>For absolute capability (:code:<code>capability_per_capita=False</code>):</p> \\[ C(g, t) = \\text{GDP}(g, t)^{-w_c \\times e_c} \\] <p>Two allocation modes are supported based on :code:<code>preserve_allocation_year_shares</code>:</p> <ul> <li>False (default): Uses cumulative adjusted population from   allocation_year onwards</li> <li>True: Uses adjusted population at allocation_year only</li> </ul> <p>Parameters:</p> Name Type Description Default <code>population_ts</code> <code>TimeseriesDataFrame</code> <p>Timeseries of population for each group of interest</p> required <code>allocation_year</code> <code>int</code> <p>Year from which to start calculating allocations and budgets. See docs/science/parameter-effects.md#allocation_year for how this affects country shares</p> required <code>emission_category</code> <code>str</code> <p>Emission category to include in the output</p> required <code>country_actual_emissions_ts</code> <code>TimeseriesDataFrame | None</code> <p>Historical emissions data (required if responsibility_weight &gt; 0)</p> <code>None</code> <code>gdp_ts</code> <code>TimeseriesDataFrame | None</code> <p>GDP data (required if capability_weight &gt; 0)</p> <code>None</code> <code>responsibility_weight</code> <code>float</code> <p>Weight for historical responsibility adjustment (0.0 to 1.0). See docs/science/parameter-effects.md#responsibility_weight for real allocation examples showing how this affects country shares</p> <code>0.0</code> <code>capability_weight</code> <code>float</code> <p>Weight for economic capability adjustment (0.0 to 1.0). See docs/science/parameter-effects.md#capability_weight for real allocation examples showing how this affects country shares</p> <code>0.0</code> <code>historical_responsibility_year</code> <code>int</code> <p>Start year for calculating historical responsibility (default: 1990)</p> <code>1990</code> <code>responsibility_per_capita</code> <code>bool</code> <p>If True, use per capita emissions; if False, use absolute emissions</p> <code>True</code> <code>responsibility_exponent</code> <code>float</code> <p>Exponent for the responsibility adjustment function</p> <code>1.0</code> <code>responsibility_functional_form</code> <code>str</code> <p>Functional form for responsibility: \"asinh\" or \"power\"</p> <code>'asinh'</code> <code>capability_exponent</code> <code>float</code> <p>Exponent for the capability adjustment function</p> <code>1.0</code> <code>capability_functional_form</code> <code>str</code> <p>Functional form for capability: \"asinh\" or \"power\"</p> <code>'asinh'</code> <code>max_deviation_sigma</code> <code>float | None</code> <p>Maximum allowed deviation from equal per capita in standard deviations. If None, no constraint is applied</p> <code>2.0</code> <code>preserve_allocation_year_shares</code> <code>bool</code> <p>If False (default), shares are calculated using cumulative adjusted population from allocation_year onwards. If True, shares calculated at allocation_year are preserved</p> <code>False</code> <code>group_level</code> <code>str</code> <p>Level in the index which specifies group information</p> <code>'iso3c'</code> <code>unit_level</code> <code>str</code> <p>Level in the index which specifies the unit of each timeseries</p> <code>'unit'</code> <code>ur</code> <code>PlainRegistry</code> <p>The unit registry to use for calculations</p> <code>get_default_unit_registry()</code> <p>Returns:</p> Type Description <code>BudgetAllocationResult</code> <p>Container with relative shares for cumulative emissions budget allocation. The TimeseriesDataFrame contains only the allocation_year column with adjusted population shares that sum to 1 across groups for the specified emission category.</p> Notes <p>Theoretical grounding:</p> <p>See docs/science/allocations.md#per-capita-adjusted for detailed mathematical formulation, parameter considerations, and CBDR-RC alignment.</p> <p>For translating equity principles into code, see:</p> <ul> <li>docs/science/principle-to-code.md#historical-responsibility-polluter-pays   for responsibility weight implementation</li> <li>docs/science/principle-to-code.md#capability-ability-to-pay for capability   weight implementation</li> <li>docs/science/principle-to-code.md#cbdr-rc for combining both principles</li> </ul> <p>Examples:</p> <p>Calculate allocation with both responsibility and capability adjustments:</p> Python Console Session<pre><code>&gt;&gt;&gt; from fair_shares.library.utils import create_example_data\n&gt;&gt;&gt; data = create_example_data()\n&gt;&gt;&gt; result = per_capita_adjusted_budget(\n...     population_ts=data[\"population\"],\n...     allocation_year=2030,\n...     emission_category=\"co2-ffi\",\n...     country_actual_emissions_ts=data[\"emissions\"],\n...     gdp_ts=data[\"gdp\"],\n...     responsibility_weight=0.5,\n...     capability_weight=0.5,\n...     historical_responsibility_year=2020,\n... )\nConverting units...\n&gt;&gt;&gt; result.approach\n'per-capita-adjusted-budget'\n&gt;&gt;&gt; # Shares sum to 1.0\n&gt;&gt;&gt; shares = result.relative_shares_cumulative_emission\n&gt;&gt;&gt; bool(abs(shares[\"2030\"].sum() - 1.0) &lt; 1e-10)\nTrue\n&gt;&gt;&gt; # Parameters include normalized weights\n&gt;&gt;&gt; result.parameters[\"responsibility_weight\"]\n0.5...\n&gt;&gt;&gt; result.parameters[\"capability_weight\"]\n0.5...\n</code></pre> <p>Using only responsibility adjustment (no capability):</p> Python Console Session<pre><code>&gt;&gt;&gt; result_resp_only = per_capita_adjusted_budget(\n...     population_ts=data[\"population\"],\n...     allocation_year=2030,\n...     emission_category=\"co2-ffi\",\n...     country_actual_emissions_ts=data[\"emissions\"],\n...     responsibility_weight=1.0,\n...     capability_weight=0.0,\n...     historical_responsibility_year=2020,\n... )\nConverting units...\n&gt;&gt;&gt; # Countries with higher historical emissions get lower allocations\n&gt;&gt;&gt; result_resp_only.approach\n'per-capita-adjusted-budget'\n&gt;&gt;&gt; result_resp_only.parameters[\"responsibility_weight\"]\n1.0...\n&gt;&gt;&gt; result_resp_only.parameters[\"capability_weight\"]\n0.0...\n</code></pre>"},{"location":"api/allocations/budgets/#per_capita_adjusted_gini_budget","title":"per_capita_adjusted_gini_budget","text":""},{"location":"api/allocations/budgets/#fair_shares.library.allocations.budgets.per_capita.per_capita_adjusted_gini_budget","title":"fair_shares.library.allocations.budgets.per_capita.per_capita_adjusted_gini_budget","text":"Python<pre><code>per_capita_adjusted_gini_budget(\n    population_ts: TimeseriesDataFrame,\n    gdp_ts: TimeseriesDataFrame,\n    gini_s: DataFrame,\n    allocation_year: int,\n    emission_category: str,\n    country_actual_emissions_ts: (\n        TimeseriesDataFrame | None\n    ) = None,\n    responsibility_weight: float = 0.0,\n    capability_weight: float = 1.0,\n    historical_responsibility_year: int = 1990,\n    responsibility_per_capita: bool = True,\n    responsibility_exponent: float = 1.0,\n    responsibility_functional_form: str = \"asinh\",\n    capability_per_capita: bool = True,\n    capability_exponent: float = 1.0,\n    capability_functional_form: str = \"asinh\",\n    income_floor: float = 0.0,\n    max_gini_adjustment: float = 0.8,\n    max_deviation_sigma: float | None = 2.0,\n    preserve_allocation_year_shares: bool = False,\n    group_level: str = \"iso3c\",\n    unit_level: str = \"unit\",\n    ur: PlainRegistry = get_default_unit_registry(),\n) -&gt; BudgetAllocationResult\n</code></pre> <p>Per capita budget allocation with responsibility, capability, and Gini adjustments.</p> <p>This function generates cumulative shares for the allocation year based on adjusted per capita principles, incorporating historical responsibility, Gini-corrected GDP capability adjustments, and inequality considerations.</p> Mathematical Foundation <p>The Gini-adjusted budget allocation extends the per capita adjusted approach by incorporating income inequality within countries.</p> <p>Core Allocation Formula</p> <p>For budget allocation with dynamic shares (default mode):</p> \\[ A(g) = \\frac{\\sum_{t \\geq t_a} R(g) \\times C_{\\text{Gini}}(g, t) \\times P(g, t)}{\\sum_g \\sum_{t \\geq t_a} R(g) \\times C_{\\text{Gini}}(g, t) \\times P(g, t)} \\] <p>Where:</p> <ul> <li>\\(A(g)\\): Budget share allocated to country \\(g\\)</li> <li>\\(R(g)\\): Responsibility adjustment factor (equals 1.0 if not used)</li> <li>\\(C_{\\text{Gini}}(g, t)\\): Gini-adjusted capability factor (equals 1.0 if not used)</li> <li>\\(P(g, t)\\): Population of country \\(g\\) in year \\(t\\)</li> <li>\\(t_a\\): Allocation year</li> </ul> <p>Gini Adjustment Process</p> <p>GDP is adjusted for within-country income inequality using the Gini coefficient. This process modifies the GDP values used in capability calculations:</p> \\[ \\text{GDP}^{\\text{adj}}(g, t) = \\text{GDP}(g, t) \\times (1 - \\text{income-share-floor}) \\] <p>Where the income share floor is calculated from the Gini coefficient and income floor parameters. The adjustment reduces GDP for high-inequality countries, reflecting that their wealth is concentrated among fewer people.</p> <p>Responsibility Adjustment</p> <p>Identical to per capita adjusted budget (see that function for details).</p> <p>For per capita responsibility (:code:<code>responsibility_per_capita=True</code>, default):</p> \\[ R(g) = \\left(\\frac{\\sum_{t=t_h}^{t_a-1} E(g, t)}{\\sum_{t=t_h}^{t_a-1} P(g, t)}\\right)^{-w_r \\times e_r} \\] <p>Where:</p> <ul> <li>\\(E(g, t)\\): Emissions of country \\(g\\) in year \\(t\\)</li> <li>\\(t_h\\): Historical responsibility start year</li> <li>\\(t_a\\): Allocation year</li> <li>\\(w_r\\): Normalized responsibility weight</li> <li>\\(e_r\\): Responsibility exponent</li> </ul> <p>Capability Adjustment with Gini-Adjusted GDP</p> <p>For per capita capability (:code:<code>capability_per_capita=True</code>, default):</p> \\[ C_{\\text{Gini}}(g, t) = \\left(\\frac{\\text{GDP}^{\\text{adj}}(g, t)}{P(g, t)}\\right)^{-w_c \\times e_c} \\] <p>Where:</p> <ul> <li>\\(C_{\\text{Gini}}(g, t)\\): Gini-adjusted capability factor (inverse - higher adjusted GDP = lower allocation)</li> <li>\\(\\text{GDP}^{\\text{adj}}(g, t)\\): Gini-adjusted GDP (reduced for high-inequality countries)</li> <li>\\(w_c\\): Normalized capability weight</li> <li>\\(e_c\\): Capability exponent</li> </ul> <p>The Gini adjustment effectively reduces capability for high-inequality countries, giving them larger emission allocations than unadjusted GDP would suggest.</p> <p>Two allocation modes are supported based on :code:<code>preserve_allocation_year_shares</code>:</p> <ul> <li>False (default): Uses cumulative adjusted population from   allocation_year onwards</li> <li>True: Uses adjusted population at allocation_year only</li> </ul> <p>Parameters:</p> Name Type Description Default <code>population_ts</code> <code>TimeseriesDataFrame</code> <p>Timeseries of population for each group of interest</p> required <code>gdp_ts</code> <code>TimeseriesDataFrame</code> <p>Timeseries of GDP for each group of interest (required)</p> required <code>gini_s</code> <code>DataFrame</code> <p>DataFrame containing Gini coefficient data for each group (required)</p> required <code>allocation_year</code> <code>int</code> <p>Year from which to start calculating allocations and budgets. See docs/science/parameter-effects.md#allocation_year for how this affects country shares</p> required <code>emission_category</code> <code>str</code> <p>Emission category to include in the output</p> required <code>country_actual_emissions_ts</code> <code>TimeseriesDataFrame | None</code> <p>Historical emissions data (required if responsibility_weight &gt; 0)</p> <code>None</code> <code>responsibility_weight</code> <code>float</code> <p>Weight for historical responsibility adjustment (0.0 to 1.0). See docs/science/parameter-effects.md#responsibility_weight for real allocation examples showing how this affects country shares</p> <code>0.0</code> <code>capability_weight</code> <code>float</code> <p>Weight for economic capability adjustment (0.0 to 1.0, default 1.0)</p> <code>1.0</code> <code>historical_responsibility_year</code> <code>int</code> <p>Start year for calculating historical responsibility (default: 1990)</p> <code>1990</code> <code>responsibility_per_capita</code> <code>bool</code> <p>If True, use per capita emissions; if False, use absolute emissions</p> <code>True</code> <code>responsibility_exponent</code> <code>float</code> <p>Exponent for the responsibility adjustment function</p> <code>1.0</code> <code>responsibility_functional_form</code> <code>str</code> <p>Functional form for responsibility: \"asinh\" or \"power\"</p> <code>'asinh'</code> <code>capability_exponent</code> <code>float</code> <p>Exponent for the capability adjustment function</p> <code>1.0</code> <code>capability_functional_form</code> <code>str</code> <p>Functional form for capability: \"asinh\" or \"power\"</p> <code>'asinh'</code> <code>income_floor</code> <code>float</code> <p>Minimum income floor for Gini adjustment calculations. See docs/science/parameter-effects.md#income_floor for real allocation examples showing how this affects country shares</p> <code>0.0</code> <code>max_gini_adjustment</code> <code>float</code> <p>Maximum allowed Gini adjustment factor</p> <code>0.8</code> <code>max_deviation_sigma</code> <code>float | None</code> <p>Maximum allowed deviation from equal per capita in standard deviations. If None, no constraint is applied</p> <code>2.0</code> <code>preserve_allocation_year_shares</code> <code>bool</code> <p>If False (default), shares are calculated using cumulative adjusted population from allocation_year onwards. If True, shares calculated at allocation_year are preserved</p> <code>False</code> <code>group_level</code> <code>str</code> <p>Level in the index which specifies group information</p> <code>'iso3c'</code> <code>unit_level</code> <code>str</code> <p>Level in the index which specifies the unit of each timeseries</p> <code>'unit'</code> <code>ur</code> <code>PlainRegistry</code> <p>The unit registry to use for calculations</p> <code>get_default_unit_registry()</code> <p>Returns:</p> Type Description <code>BudgetAllocationResult</code> <p>Container with relative shares for cumulative emissions budget allocation. The TimeseriesDataFrame contains only the allocation_year column with Gini-adjusted capability-weighted population shares that sum to 1 across groups for the specified emission category.</p> Notes <p>Theoretical grounding:</p> <p>See docs/science/allocations.md#gini-adjusted for detailed mathematical formulation, intra-national equity considerations, and when to use this approach.</p> <p>For translating equity principles into code, see:</p> <ul> <li>docs/science/principle-to-code.md#subsistence-protection for income floor   and Gini adjustment implementation</li> <li>docs/science/principle-to-code.md#cbdr-rc for combining with responsibility   and capability</li> </ul> <p>Examples:</p> <p>Calculate allocation with Gini-adjusted capability (no responsibility):</p> Python Console Session<pre><code>&gt;&gt;&gt; from fair_shares.library.utils import create_example_data\n&gt;&gt;&gt; data = create_example_data()\n&gt;&gt;&gt; result = per_capita_adjusted_gini_budget(\n...     population_ts=data[\"population\"],\n...     gdp_ts=data[\"gdp\"],\n...     gini_s=data[\"gini\"],\n...     allocation_year=2030,\n...     emission_category=\"co2-ffi\",\n...     responsibility_weight=0.0,\n...     capability_weight=1.0,\n... )\nConverting units...\n&gt;&gt;&gt; result.approach\n'per-capita-adjusted-gini-budget'\n&gt;&gt;&gt; # Shares are adjusted for inequality in addition to GDP\n&gt;&gt;&gt; shares = result.relative_shares_cumulative_emission\n&gt;&gt;&gt; bool(abs(shares[\"2030\"].sum() - 1.0) &lt; 1e-10)  # Should sum to 1.0\nTrue\n&gt;&gt;&gt; # Gini parameters are stored in result\n&gt;&gt;&gt; result.parameters[\"income_floor\"]\n0.0...\n&gt;&gt;&gt; result.parameters[\"max_gini_adjustment\"]\n0.8...\n</code></pre> <p>Calculate allocation with both responsibility and Gini-adjusted capability:</p> Python Console Session<pre><code>&gt;&gt;&gt; result_full = per_capita_adjusted_gini_budget(\n...     population_ts=data[\"population\"],\n...     gdp_ts=data[\"gdp\"],\n...     gini_s=data[\"gini\"],\n...     allocation_year=2030,\n...     emission_category=\"co2-ffi\",\n...     country_actual_emissions_ts=data[\"emissions\"],\n...     responsibility_weight=0.5,\n...     capability_weight=0.5,\n...     historical_responsibility_year=2020,\n... )\nConverting units...\n&gt;&gt;&gt; result_full.approach\n'per-capita-adjusted-gini-budget'\n&gt;&gt;&gt; # Both adjustments are reflected in parameters\n&gt;&gt;&gt; result_full.parameters[\"responsibility_weight\"]\n0.5...\n&gt;&gt;&gt; result_full.parameters[\"capability_weight\"]\n0.5...\n&gt;&gt;&gt; # High inequality countries get higher allocations than GDP alone suggests\n&gt;&gt;&gt; shares_full = result_full.relative_shares_cumulative_emission\n&gt;&gt;&gt; bool(abs(shares_full[\"2030\"].sum() - 1.0) &lt; 1e-10)\nTrue\n</code></pre>"},{"location":"api/allocations/budgets/#see-also","title":"See Also","text":"<ul> <li>Pathway Allocations: Annual emission pathways</li> <li>Scientific Documentation: Budget Allocations: Theoretical foundations</li> <li>country-fair-shares Guide: Conceptual overview</li> </ul>"},{"location":"api/allocations/manager/","title":"Allocation Manager","text":"<p>The <code>AllocationManager</code> provides a high-level interface for running allocations with data loading and output management.</p>"},{"location":"api/allocations/manager/#overview","title":"Overview","text":"<p>Manager for allocation operations with validation and result handling.</p> <p>This class provides a high-level interface for running allocations and managing the results, including validation, absolute calculations, and file output.</p> <p>The manager orchestrates the application of different allocation approaches, each of which operationalizes particular equity principles. Users should be aware that every approach embeds normative choices about how to weight competing claims to atmospheric space. This tool aims to make these choices explicit rather than hidden in default parameters. See docs/science/ for theoretical foundations.</p> Supported Approaches <p>Budget approaches (single-year cumulative budget allocation):</p> <ul> <li><code>equal-per-capita-budget</code>: Allocates budget proportional to population</li> <li><code>per-capita-adjusted-budget</code>: Adjusts for capability and/or responsibility</li> <li><code>per-capita-adjusted-gini-budget</code>: Further adjusts for within-country inequality</li> </ul> <p>Pathway approaches (multi-year emissions trajectory allocation):</p> <ul> <li><code>equal-per-capita</code>: Annual shares proportional to population</li> <li><code>per-capita-adjusted</code>: Adjusted for capability/responsibility</li> <li><code>per-capita-adjusted-gini</code>: Further adjusted for inequality</li> <li><code>per-capita-convergence</code>: Transitions to equal per capita (not a fair share)</li> <li><code>cumulative-per-capita-convergence</code>: Equal cumulative per capita from reference year</li> <li><code>cumulative-per-capita-convergence-adjusted</code>: With capability/responsibility</li> <li><code>cumulative-per-capita-convergence-gini-adjusted</code>: With inequality adjustment</li> </ul> Notes <p>The distinction between budget and pathway approaches matters for interpretation:</p> <ul> <li> <p>Budget approaches answer: \"What share of a remaining carbon budget does each   country have a claim to?\"</p> </li> <li> <p>Pathway approaches answer: \"What emissions trajectory should each country follow   to collectively achieve a global target while respecting equity principles?\"</p> </li> </ul> <p>Both require explicit choices about which equity principles to apply and how to weight them. The manager validates inputs and tracks these choices in output metadata to enable transparent, replicable analysis.</p>"},{"location":"api/allocations/manager/#running-allocations","title":"Running Allocations","text":""},{"location":"api/allocations/manager/#run_allocation","title":"run_allocation","text":"<p>Run a single allocation.</p> <p>This is the main method for running allocations. It handles:</p> <ul> <li>Parameter validation</li> <li>Data requirement checking</li> <li>Function execution</li> <li>Result validation</li> </ul> <p>Parameters:</p> Name Type Description Default <code>approach</code> <code>str</code> <p>The allocation approach to use</p> required <code>population_ts</code> <code>TimeseriesDataFrame</code> <p>Population time series data</p> required <code>first_allocation_year</code> <code>int</code> <p>First allocation year (for pathway allocations)</p> <code>None</code> <code>allocation_year</code> <code>int</code> <p>Allocation year (for budget allocations)</p> <code>None</code> <code>gdp_ts</code> <code>TimeseriesDataFrame</code> <p>GDP time series data (if required by approach)</p> <code>None</code> <code>gini_s</code> <code>TimeseriesDataFrame</code> <p>Gini coefficient data (if required by approach)</p> <code>None</code> <code>country_actual_emissions_ts</code> <code>TimeseriesDataFrame</code> <p>Country-level actual emissions time series data (if required by approach)</p> <code>None</code> <code>world_scenario_emissions_ts</code> <code>TimeseriesDataFrame</code> <p>World scenario emissions pathway (used by approaches that require it)</p> <code>None</code> <code>emission_category</code> <code>str</code> <p>Emission category to allocate</p> <code>None</code> <code>**kwargs</code> <p>Additional parameters specific to the allocation approach</p> <code>{}</code> <p>Returns:</p> Type Description <code>Union[BudgetAllocationResult, PathwayAllocationResult]</code> <p>The allocation result with relative shares</p> <p>Raises:</p> Type Description <code>AllocationError</code> <p>If validation fails or required data is missing</p> <code>DataProcessingError</code> <p>If other errors occur during allocation</p> <p>Examples:</p> <p>Run a simple budget allocation:</p> Python Console Session<pre><code>&gt;&gt;&gt; from fair_shares.library.allocations import AllocationManager\n&gt;&gt;&gt; from fair_shares.library.utils import create_example_data\n&gt;&gt;&gt;\n&gt;&gt;&gt; # Create example data\n&gt;&gt;&gt; data = create_example_data()\n&gt;&gt;&gt;\n&gt;&gt;&gt; # Initialize manager\n&gt;&gt;&gt; manager = AllocationManager()\n&gt;&gt;&gt;\n&gt;&gt;&gt; # Run equal per capita budget allocation\n&gt;&gt;&gt; result = manager.run_allocation(\n...     approach=\"equal-per-capita-budget\",\n...     population_ts=data[\"population\"],\n...     allocation_year=2020,\n...     emission_category=\"co2-ffi\",\n... )\nConverting units...\n&gt;&gt;&gt;\n&gt;&gt;&gt; # Check result\n&gt;&gt;&gt; result.approach\n'equal-per-capita-budget'\n&gt;&gt;&gt; # Shares sum to 1.0\n&gt;&gt;&gt; shares_sum = result.relative_shares_cumulative_emission.sum().iloc[0]\n&gt;&gt;&gt; bool(abs(shares_sum - 1.0) &lt; 0.01)\nTrue\n</code></pre> <p>Run a pathway allocation with adjustments:</p> Python Console Session<pre><code>&gt;&gt;&gt; # Run per capita adjusted pathway allocation\n&gt;&gt;&gt; result = manager.run_allocation(\n...     approach=\"per-capita-adjusted\",\n...     population_ts=data[\"population\"],\n...     gdp_ts=data[\"gdp\"],\n...     country_actual_emissions_ts=data[\"emissions\"],\n...     world_scenario_emissions_ts=data[\"world_emissions\"],\n...     first_allocation_year=2020,\n...     emission_category=\"co2-ffi\",\n...     responsibility_weight=0.5,\n...     capability_weight=0.5,\n... )\nConverting units...\n&gt;&gt;&gt;\n&gt;&gt;&gt; # Check result\n&gt;&gt;&gt; result.approach\n'per-capita-adjusted'\n&gt;&gt;&gt; # Check that shares are calculated for all years\n&gt;&gt;&gt; len(result.relative_shares_pathway_emissions.columns) == 3\nTrue\n</code></pre> Notes <p>This is the main entry point for running allocations. It automatically:</p> <ul> <li>Determines whether the approach is budget or pathway based</li> <li>Validates all input data structures</li> <li>Checks that required data is provided for the chosen approach</li> <li>Filters parameters to only pass what the allocation function needs</li> </ul> <p>When to use: Use this method for single allocation runs. For running multiple parameter combinations, use :meth:<code>run_parameter_grid</code> instead.</p> <p>Budget vs Pathway: Budget approaches (ending in \"-budget\") allocate a single year's cumulative budget. Pathway approaches allocate emissions over multiple years. Budget approaches use <code>allocation_year</code>, pathway approaches use <code>first_allocation_year</code>.</p> <p>Equity considerations: Each approach implements different equity principles. The equal per capita approaches treat population as the sole basis for claims. Adjusted approaches incorporate capability (ability to pay based on GDP) and/or historical responsibility, implementing aspects of CBDR-RC. Parameters like <code>responsibility_weight</code> and <code>capability_weight</code> represent explicit normative choices about how to balance these considerations.</p> <p>Transparency: All parameter choices are recorded in the result metadata to enable replication and critical assessment.</p>"},{"location":"api/allocations/manager/#run_parameter_grid","title":"run_parameter_grid","text":"<p>Run allocations for all parameter combinations in a grid.</p> <p>This method expands the configuration into all possible parameter combinations and runs each allocation.</p> <p>Parameters:</p> Name Type Description Default <code>allocations_config</code> <code>dict[str, list[dict[str, Any]]]</code> <p>Configuration dict with approach names as keys and lists of parameter dicts as values. Each parameter dict defines one configuration to run. Parameters within each dict can be single values or lists for grid expansion.</p> required <code>population_ts</code> <code>TimeseriesDataFrame</code> <p>Population time series data</p> required <code>gdp_ts</code> <code>TimeseriesDataFrame</code> <p>GDP time series data</p> <code>None</code> <code>gini_s</code> <code>TimeseriesDataFrame</code> <p>Gini coefficient data</p> <code>None</code> <code>country_actual_emissions_ts</code> <code>TimeseriesDataFrame</code> <p>Country-level actual emissions time series data</p> <code>None</code> <code>world_scenario_emissions_ts</code> <code>TimeseriesDataFrame</code> <p>World scenario emissions pathway data</p> <code>None</code> <code>emission_category</code> <code>str</code> <p>Emission category to allocate</p> <code>None</code> <code>target_source</code> <code>str</code> <p>Target source (e.g., \"rcbs\", \"ar6\")</p> <code>None</code> <code>harmonisation_year</code> <code>int</code> <p>Year at which scenarios are harmonized to historical data. Required for scenario-based targets (not RCBs).</p> <code>None</code> <p>Returns:</p> Type Description <code>list[Union[BudgetAllocationResult, PathwayAllocationResult]]</code> <p>list of allocation results</p> <p>Examples:</p> <p>Run multiple budget allocations across different years:</p> Python Console Session<pre><code>&gt;&gt;&gt; from fair_shares.library.allocations import AllocationManager\n&gt;&gt;&gt; from fair_shares.library.utils import create_example_data\n&gt;&gt;&gt;\n&gt;&gt;&gt; # Create example data\n&gt;&gt;&gt; data = create_example_data()\n&gt;&gt;&gt;\n&gt;&gt;&gt; # Initialize manager\n&gt;&gt;&gt; manager = AllocationManager()\n&gt;&gt;&gt;\n&gt;&gt;&gt; # Define configuration with multiple years for equal per capita\n&gt;&gt;&gt; config = {\"equal-per-capita-budget\": [{\"allocation-year\": [2020, 2030]}]}\n&gt;&gt;&gt;\n&gt;&gt;&gt; # Run parameter grid\n&gt;&gt;&gt; results = manager.run_parameter_grid(\n...     allocations_config=config,\n...     population_ts=data[\"population\"],\n...     emission_category=\"co2-ffi\",\n... )\n\nProcessing approach: equal-per-capita-budget\n...\n&gt;&gt;&gt; # Check we got 2 results (one per year)\n&gt;&gt;&gt; len(results)\n2\n&gt;&gt;&gt; # Both are budget results\n&gt;&gt;&gt; all(r.approach == \"equal-per-capita-budget\" for r in results)\nTrue\n</code></pre> <p>Run parameter grid with weight combinations for adjusted allocation:</p> Python Console Session<pre><code>&gt;&gt;&gt; # Define configuration with parameter grid expansion\n&gt;&gt;&gt; config = {\n...     \"per-capita-adjusted-budget\": [\n...         {\n...             \"allocation-year\": 2020,\n...             \"responsibility-weight\": 0.0,\n...             \"capability-weight\": [0.25, 0.5, 0.75],\n...         }\n...     ]\n... }\n&gt;&gt;&gt;\n&gt;&gt;&gt; # Run parameter grid (will expand to 3 combinations)\n&gt;&gt;&gt; results = manager.run_parameter_grid(\n...     allocations_config=config,\n...     population_ts=data[\"population\"],\n...     gdp_ts=data[\"gdp\"],\n...     emission_category=\"co2-ffi\",\n... )\n\nProcessing approach: per-capita-adjusted-budget\n...\n&gt;&gt;&gt; # Check we got 3 results (3 capability weights)\n&gt;&gt;&gt; len(results)\n3\n&gt;&gt;&gt; # All are per-capita-adjusted-budget results\n&gt;&gt;&gt; all(r.approach == \"per-capita-adjusted-budget\" for r in results)\nTrue\n</code></pre> Notes <p>This method is designed for systematic parameter exploration. It:</p> <ul> <li>Automatically expands parameter lists into all combinations</li> <li>Validates that approaches are compatible with the target source</li> <li>Ensures allocation years are consistent with harmonisation_year</li> <li>Returns a list of all results for comparison</li> </ul> <p>When to use: Use this method when you want to run the same allocation approach with multiple parameter combinations to compare results. For single allocations, use :meth:<code>run_allocation</code> instead.</p> <p>Parameter expansion: Any parameter value can be a list, and the method will create all combinations. For example, if <code>allocation-year: [2020, 2030]</code> and <code>capability-weight: [0.25, 0.5]</code>, this will run 4 allocations (2 years x 2 weights).</p> <p>Configuration format: The <code>allocations_config</code> parameter expects a nested structure where each approach maps to a list of parameter dictionaries. Each dictionary in the list can use either single values or lists for grid expansion.</p> <p>Exploring normative choices: The parameter grid is useful for exploring how different normative choices affect allocations. For example, varying <code>responsibility-weight</code> and <code>capability-weight</code> reveals the sensitivity of results to how CBDR-RC principles are operationalized. Similarly, varying <code>historical-responsibility-year</code> shows how the choice of start date for counting historical emissions affects current allocations - a choice that remains debated. See docs/science/allocations.md for details.</p>"},{"location":"api/allocations/manager/#results-processing","title":"Results Processing","text":""},{"location":"api/allocations/manager/#calculate_absolute_emissions","title":"calculate_absolute_emissions","text":"<p>Calculate absolute emissions from allocation result and emissions data.</p> <p>Converts relative shares (fractions summing to 1.0) into absolute emission quantities by applying the shares to a global emissions total. This separation of relative and absolute allows the same equity-based allocation to be applied to different emissions scenarios or budget estimates.</p> <p>Parameters:</p> Name Type Description Default <code>result</code> <code>Union[BudgetAllocationResult, PathwayAllocationResult]</code> <p>The allocation result containing relative shares. These shares represent each country's claim to a portion of the global emissions space.</p> required <code>emissions_data</code> <code>TimeseriesDataFrame</code> <p>Emissions data providing the global totals to which shares are applied. For budget allocations, this is the total budget to distribute. For pathway allocations, this is the year-by-year global trajectory.</p> required <p>Returns:</p> Type Description <code>TimeseriesDataFrame</code> <p>Absolute emissions/budgets calculated from relative shares. Units match the input emissions_data (typically MtCO2eq or GtCO2eq).</p>"},{"location":"api/allocations/manager/#save_allocation_result","title":"save_allocation_result","text":"<p>Save allocation results to parquet files.</p> <p>Persists allocation results with comprehensive metadata to enable transparent, replicable analysis. Following the transparency principles recommended for transparency, all parameter choices and data sources are recorded to allow critical assessment of the normative choices embedded in each allocation.</p> <p>Parameters:</p> Name Type Description Default <code>result</code> <code>Union[BudgetAllocationResult, PathwayAllocationResult]</code> <p>The allocation result to save</p> required <code>output_dir</code> <code>Path</code> <p>Directory to save results</p> required <code>absolute_emissions</code> <code>TimeseriesDataFrame</code> <p>Absolute emissions data (if None, only relative shares are saved)</p> <code>None</code> <code>climate_assessment</code> <code>str</code> <p>Climate assessment name (e.g., \"AR6\")</p> <code>None</code> <code>quantile</code> <code>float</code> <p>Quantile value for scenario (e.g., 0.5 for median)</p> <code>None</code> <code>data_context</code> <code>dict</code> <p>Context about data sources and processing. Should include sources for population, GDP, emissions, and other input data to enable verification.</p> <code>None</code> <code>**metadata</code> <p>Additional metadata to include</p> <code>{}</code> <p>Returns:</p> Type Description <code>dict[str, Path]</code> <p>Paths to saved parquet files</p> <p>Raises:</p> Type Description <code>DataProcessingError</code> <p>If data preparation fails</p> <code>IOError</code> <p>If file writing fails</p> Notes <p>The output includes a <code>warnings</code> column that flags allocations requiring attention, such as:</p> <ul> <li><code>not-fair-share</code>: Approaches like per-capita-convergence that privilege   current emission patterns during transition</li> <li><code>missing-net-negative</code>: Scenarios where negative emissions were excluded</li> </ul>"},{"location":"api/allocations/manager/#output-management","title":"Output Management","text":""},{"location":"api/allocations/manager/#generate_readme","title":"generate_readme","text":"<p>Generate README files for relative and absolute parquet files.</p> <p>Creates human-readable documentation of the allocation outputs, including column descriptions and data sources. This supports the transparency goal of enabling users to understand and critically assess the choices embedded in each allocation.</p> <p>Parameters:</p> Name Type Description Default <code>output_dir</code> <code>Path</code> <p>Directory containing parquet files</p> required <code>data_context</code> <code>dict</code> <p>Context about data sources and processing</p> <code>None</code>"},{"location":"api/allocations/manager/#create_param_manifest","title":"create_param_manifest","text":"<p>Create param_manifest.csv with proper kebab-case column names.</p> <p>The parameter manifest provides a summary of all allocation configurations run in a batch, enabling quick comparison of different normative choices. This supports transparent reporting of how different parameter combinations affect allocation results.</p> <p>Parameters:</p> Name Type Description Default <code>param_manifest_rows</code> <code>list[dict[str, Any]]</code> <p>List of parameter manifest rows, where each row contains parameters in snake_case format</p> required <code>output_dir</code> <code>Path</code> <p>Directory where param_manifest.csv will be saved</p> required"},{"location":"api/allocations/manager/#see-also","title":"See Also","text":"<ul> <li>Budget Allocations: Low-level budget allocation functions</li> <li>Pathway Allocations: Low-level pathway allocation functions</li> <li>country-fair-shares Guide: Choose and configure allocations</li> </ul>"},{"location":"api/allocations/pathways/","title":"Pathway Allocation Functions","text":"<p>Pathway allocation functions generate annual emission allocation shares over time.</p>"},{"location":"api/allocations/pathways/#overview","title":"Overview","text":"<p>All pathway allocation approaches return a <code>PathwayAllocationResult</code> containing:</p> <ul> <li><code>approach</code>: Name of the allocation approach used</li> <li><code>parameters</code>: Dictionary of parameters used in the calculation</li> <li><code>relative_shares_pathway_emissions</code>: DataFrame of annual shares (sum to 1.0 each year)</li> </ul>"},{"location":"api/allocations/pathways/#per-capita-pathways","title":"Per Capita Pathways","text":""},{"location":"api/allocations/pathways/#equal_per_capita","title":"equal_per_capita","text":""},{"location":"api/allocations/pathways/#fair_shares.library.allocations.pathways.per_capita.equal_per_capita","title":"fair_shares.library.allocations.pathways.per_capita.equal_per_capita","text":"Python<pre><code>equal_per_capita(\n    population_ts: TimeseriesDataFrame,\n    first_allocation_year: int,\n    emission_category: str,\n    preserve_first_allocation_year_shares: bool = False,\n    group_level: str = \"iso3c\",\n    unit_level: str = \"unit\",\n    ur: PlainRegistry = get_default_unit_registry(),\n) -&gt; PathwayAllocationResult\n</code></pre> <p>Equal per capita pathway allocation based on population shares.</p> <p>Allocates emissions in proportion to population, with no adjustments for historical responsibility or economic capability.</p> Mathematical Foundation <p>Mode 1: Dynamic shares (preserve_first_allocation_year_shares=False, default)</p> <p>Population shares are calculated at each year from first_allocation_year onwards. This accounts for changes in relative population shares over time:</p> \\[ A(g, t) = \\frac{P(g, t)}{\\sum_{g'} P(g', t)} \\] <p>Where:</p> <ul> <li>\\(A(g, t)\\): Allocation share for country \\(g\\) at year \\(t\\)</li> <li>\\(P(g, t)\\): Population of country \\(g\\) at year \\(t\\)</li> <li>\\(\\sum_{g'} P(g', t)\\): Total world population at year \\(t\\)</li> </ul> <p>Mode 2: Preserved shares (preserve_first_allocation_year_shares=True)</p> <p>Population shares calculated at the first_allocation_year are preserved across all periods. This means the relative allocation between groups remains constant:</p> \\[ A(g, t) = \\frac{P(g, t_a)}{\\sum_{g'} P(g', t_a)} \\quad \\forall t \\geq t_a \\] <p>Where:</p> <ul> <li>\\(A(g, t)\\): Allocation share for country \\(g\\) at year \\(t\\) (constant for all \\(t \\geq t_a\\))</li> <li>\\(P(g, t_a)\\): Population of country \\(g\\) at first allocation year \\(t_a\\)</li> <li>\\(\\sum_{g'} P(g', t_a)\\): Total world population at first allocation year</li> </ul> <p>Parameters:</p> Name Type Description Default <code>population_ts</code> <code>TimeseriesDataFrame</code> <p>Population time series for each group of interest.</p> required <code>first_allocation_year</code> <code>int</code> <p>First year that should be used for calculating the allocation. This must be a column in population_ts. See docs/science/parameter-effects.md#allocation_year for how this affects country shares</p> required <code>emission_category</code> <code>str</code> <p>Emission category to include in the output.</p> required <code>preserve_first_allocation_year_shares</code> <code>bool</code> <p>If False (default), shares are calculated at each year from first_allocation_year onwards. If True, shares calculated at the first_allocation_year are preserved across all periods.</p> <code>False</code> <code>group_level</code> <code>str</code> <p>Index level name for grouping (typically 'iso3c'). Default: 'iso3c'</p> <code>'iso3c'</code> <code>unit_level</code> <code>str</code> <p>Index level name for units. Default: 'unit'</p> <code>'unit'</code> <code>ur</code> <code>PlainRegistry</code> <p>Pint unit registry for unit conversions.</p> <code>get_default_unit_registry()</code> <p>Returns:</p> Type Description <code>PathwayAllocationResult</code> <p>Relative shares over time, summing to unity each year.</p> Notes <p>The equal per capita principle treats the atmosphere as a finite shared resource with equal claims per person. It serves as a widely used baseline in climate equity analysis.</p> <p>When to Use</p> <ul> <li>As a baseline to compare against adjusted approaches</li> <li>When transparency and simplicity are priorities</li> <li>As a reference point before applying responsibility or capability adjustments</li> </ul> <p>See docs/science/allocations.md for theoretical grounding and limitations.</p> <p>Examples:</p> Python Console Session<pre><code>&gt;&gt;&gt; from fair_shares.library.utils import create_example_data\n&gt;&gt;&gt; data = create_example_data()\n&gt;&gt;&gt; result = equal_per_capita(\n...     population_ts=data[\"population\"],\n...     first_allocation_year=2020,\n...     emission_category=\"co2-ffi\",\n... )\nConverting units...\n&gt;&gt;&gt; # Check that shares sum to 1.0 at each year\n&gt;&gt;&gt; shares = result.relative_shares_pathway_emissions\n&gt;&gt;&gt; shares_2020 = shares[\"2020\"]\n&gt;&gt;&gt; bool(abs(shares_2020.sum() - 1.0) &lt; 1e-10)\nTrue\n&gt;&gt;&gt; # China and India have similar populations, so similar shares\n&gt;&gt;&gt; bool(shares_2020.loc[\"CHN\"].item() &gt; 0.3)  # China has large population\nTrue\n&gt;&gt;&gt; bool(shares_2020.loc[\"IND\"].item() &gt; 0.3)  # India has large population too\nTrue\n</code></pre> See Also <p>per_capita_adjusted : With responsibility/capability adjustments per_capita_adjusted_gini : With Gini-adjusted GDP</p>"},{"location":"api/allocations/pathways/#per_capita_adjusted","title":"per_capita_adjusted","text":""},{"location":"api/allocations/pathways/#fair_shares.library.allocations.pathways.per_capita.per_capita_adjusted","title":"fair_shares.library.allocations.pathways.per_capita.per_capita_adjusted","text":"Python<pre><code>per_capita_adjusted(\n    population_ts: TimeseriesDataFrame,\n    first_allocation_year: int,\n    emission_category: str,\n    country_actual_emissions_ts: (\n        TimeseriesDataFrame | None\n    ) = None,\n    gdp_ts: TimeseriesDataFrame | None = None,\n    responsibility_weight: float = 0.0,\n    capability_weight: float = 0.0,\n    historical_responsibility_year: int = 1990,\n    responsibility_per_capita: bool = True,\n    responsibility_exponent: float = 1.0,\n    responsibility_functional_form: str = \"asinh\",\n    capability_per_capita: bool = True,\n    capability_exponent: float = 1.0,\n    capability_functional_form: str = \"asinh\",\n    max_deviation_sigma: float | None = 2.0,\n    preserve_first_allocation_year_shares: bool = False,\n    group_level: str = \"iso3c\",\n    unit_level: str = \"unit\",\n    ur: PlainRegistry = get_default_unit_registry(),\n) -&gt; PathwayAllocationResult\n</code></pre> <p>Per capita pathway allocation with responsibility and capability adjustments.</p> <p>Extends equal per capita by incorporating:</p> <ul> <li>Responsibility adjustment: Countries with higher historical emissions     receive smaller allocations</li> <li>Capability adjustment: Countries with higher GDP (per capita or absolute)     receive smaller allocations</li> </ul> Mathematical Foundation <p>Mode 1: Dynamic adjusted shares (preserve_first_allocation_year_shares=False, default)</p> <p>Shares are computed by adjusting population at each year:</p> \\[ A(g, t) = \\frac{P_{\\text{adj}}(g, t)}{\\sum_{g'} P_{\\text{adj}}(g', t)} \\] <p>Where the adjusted population is:</p> \\[ P_{\\text{adj}}(g, t) = P(g, t) \\times R(g) \\times C(g, t) \\] <p>Where:</p> <ul> <li>\\(A(g, t)\\): Allocation share for country \\(g\\) at year \\(t\\)</li> <li>\\(P_{\\text{adj}}(g, t)\\): Adjusted population of country \\(g\\) at year \\(t\\)</li> <li>\\(P(g, t)\\): Actual population of country \\(g\\) at year \\(t\\)</li> <li>\\(R(g)\\): Responsibility adjustment factor (constant over time, equals 1.0 if not used)</li> <li>\\(C(g, t)\\): Capability adjustment factor (time-varying, equals 1.0 if not used)</li> </ul> <p>Mode 2: Preserved adjusted shares (preserve_first_allocation_year_shares=True)</p> <p>Shares calculated at first_allocation_year are broadcast across all years.</p> <p>Responsibility Adjustment</p> <p>The responsibility metric is based on cumulative historical emissions from historical_responsibility_year to first_allocation_year.</p> <p>For per capita responsibility (:code:<code>responsibility_per_capita=True</code>, default):</p> \\[ R(g) = \\left(\\frac{\\sum_{t=t_h}^{t_a} E(g, t)}{\\sum_{t=t_h}^{t_a} P(g, t)}\\right)^{-w_r \\times e_r} \\] <p>Where:</p> <ul> <li>\\(R(g)\\): Responsibility adjustment factor (inverse - higher emissions = lower allocation)</li> <li>\\(E(g, t)\\): Emissions of country \\(g\\) in year \\(t\\)</li> <li>\\(t_h\\): Historical responsibility start year</li> <li>\\(t_a\\): First allocation year</li> <li>\\(w_r\\): Normalized responsibility weight</li> <li>\\(e_r\\): Responsibility exponent</li> </ul> <p>For absolute responsibility (:code:<code>responsibility_per_capita=False</code>):</p> \\[ R(g) = \\left(\\sum_{t=t_h}^{t_a} E(g, t)\\right)^{-w_r \\times e_r} \\] <p>Capability Adjustment</p> <p>The capability metric is based on cumulative GDP per capita from first_allocation_year up to year :math:<code>t</code>.</p> <p>For per capita capability (:code:<code>capability_per_capita=True</code>, default):</p> \\[ C(g, t) = \\left(\\frac{\\sum_{t'=t_a}^{t} \\text{GDP}(g, t')}{\\sum_{t'=t_a}^{t} P(g, t')}\\right)^{-w_c \\times e_c} \\] <p>Where:</p> <ul> <li>\\(C(g, t)\\): Capability adjustment factor (inverse - higher cumulative GDP per capita = lower allocation)</li> <li>\\(\\text{GDP}(g, t')\\): Gross domestic product of country \\(g\\) in year \\(t'\\)</li> <li>\\(w_c\\): Normalized capability weight</li> <li>\\(e_c\\): Capability exponent</li> </ul> <p>For absolute capability (:code:<code>capability_per_capita=False</code>):</p> \\[ C(g, t) = \\left(\\sum_{t'=t_a}^{t} \\text{GDP}(g, t')\\right)^{-w_c \\times e_c} \\] <p>Deviation Constraint</p> <p>When :code:<code>max_deviation_sigma</code> is provided, shares are constrained to prevent extreme deviations from equal per capita. The constraint limits allocations to within :math:<code>\\sigma</code> standard deviations of the equal per capita baseline.</p> <p>Parameters:</p> Name Type Description Default <code>population_ts</code> <code>TimeseriesDataFrame</code> <p>Population time series for per capita calculations.</p> required <code>first_allocation_year</code> <code>int</code> <p>Starting year for the allocation. See docs/science/parameter-effects.md#allocation_year for how this affects country shares</p> required <code>emission_category</code> <code>str</code> <p>The emission category (e.g., 'co2-ffi', 'all-ghg').</p> required <code>country_actual_emissions_ts</code> <code>TimeseriesDataFrame | None</code> <p>Country emissions for responsibility calculation. Required if responsibility_weight &gt; 0.</p> <code>None</code> <code>gdp_ts</code> <code>TimeseriesDataFrame | None</code> <p>GDP time series for capability adjustment. Required if capability_weight &gt; 0.</p> <code>None</code> <code>responsibility_weight</code> <code>float</code> <p>Weight for responsibility adjustment (0-1). Higher historical emissions -&gt; smaller allocation. Must satisfy: responsibility_weight + capability_weight &lt;= 1.0 See docs/science/parameter-effects.md#responsibility_weight for real allocation examples showing how this affects country shares</p> <code>0.0</code> <code>capability_weight</code> <code>float</code> <p>Weight for capability adjustment (0-1). Higher cumulative GDP per capita -&gt; smaller allocation. Must satisfy: responsibility_weight + capability_weight &lt;= 1.0 See docs/science/parameter-effects.md#capability_weight for real allocation examples showing how this affects country shares</p> <code>0.0</code> <code>historical_responsibility_year</code> <code>int</code> <p>First year of responsibility window [historical_responsibility_year, first_allocation_year]. Default: 1990</p> <code>1990</code> <code>responsibility_per_capita</code> <code>bool</code> <p>If True, use per capita emissions for responsibility. Default: True</p> <code>True</code> <code>responsibility_exponent</code> <code>float</code> <p>Exponent for responsibility adjustment calculation. Default: 1.0</p> <code>1.0</code> <code>responsibility_functional_form</code> <code>str</code> <p>Functional form for responsibility adjustment ('asinh', 'power', 'linear'). Default: 'asinh'</p> <code>'asinh'</code> <code>capability_exponent</code> <code>float</code> <p>Exponent for capability adjustment calculation. Default: 1.0</p> <code>1.0</code> <code>capability_functional_form</code> <code>str</code> <p>Functional form for capability adjustment ('asinh', 'power', 'linear'). Default: 'power'</p> <code>'asinh'</code> <code>max_deviation_sigma</code> <code>float | None</code> <p>Maximum allowed deviation from equal per capita baseline. If None, no constraint is applied.</p> <code>2.0</code> <code>preserve_first_allocation_year_shares</code> <code>bool</code> <p>If False (default), shares are calculated at each year. If True, shares calculated at first_allocation_year are preserved across all periods.</p> <code>False</code> <code>group_level</code> <code>str</code> <p>Index level name for grouping (typically 'iso3c'). Default: 'iso3c'</p> <code>'iso3c'</code> <code>unit_level</code> <code>str</code> <p>Index level name for units. Default: 'unit'</p> <code>'unit'</code> <code>ur</code> <code>PlainRegistry</code> <p>Pint unit registry for unit conversions.</p> <code>get_default_unit_registry()</code> <p>Returns:</p> Type Description <code>PathwayAllocationResult</code> <p>Relative shares over time, summing to unity each year.</p> Notes <p>This approach operationalizes Common But Differentiated Responsibilities and Respective Capabilities (CBDR-RC) by combining:</p> <ul> <li>Historical Responsibility: Adjusts allocations based on cumulative   historical emissions</li> <li>Capability: Adjusts based on economic resources and ability to pay</li> </ul> <p>Parameter choices involve normative judgments that should be made transparently:</p> <ul> <li>Choice of start year for historical responsibility</li> <li>Whether to use per capita or absolute metrics</li> <li>Choice of GDP indicator (PPP vs. MER)</li> <li>Transformation of indicators onto allocation scales</li> </ul> <p>See docs/science/allocations.md for theoretical grounding.</p> <p>Examples:</p> Python Console Session<pre><code>&gt;&gt;&gt; from fair_shares.library.utils import create_example_data\n&gt;&gt;&gt; data = create_example_data()\n&gt;&gt;&gt; # Equal weights for responsibility and capability (50/50 split)\n&gt;&gt;&gt; result = per_capita_adjusted(\n...     population_ts=data[\"population\"],\n...     country_actual_emissions_ts=data[\"emissions\"],\n...     gdp_ts=data[\"gdp\"],\n...     first_allocation_year=2020,\n...     emission_category=\"co2-ffi\",\n...     responsibility_weight=0.5,\n...     capability_weight=0.5,\n... )\nConverting units...\n&gt;&gt;&gt; # Check that shares sum to 1.0\n&gt;&gt;&gt; shares = result.relative_shares_pathway_emissions\n&gt;&gt;&gt; shares_2020 = shares[\"2020\"]\n&gt;&gt;&gt; bool(abs(shares_2020.sum() - 1.0) &lt; 1e-10)\nTrue\n&gt;&gt;&gt; # High emitters like USA should have smaller shares than equal per capita\n&gt;&gt;&gt; equal_pc_result = equal_per_capita(\n...     population_ts=data[\"population\"],\n...     first_allocation_year=2020,\n...     emission_category=\"co2-ffi\",\n... )\nConverting units...\n&gt;&gt;&gt; equal_pc_shares = equal_pc_result.relative_shares_pathway_emissions[\"2020\"]\n&gt;&gt;&gt; # USA has lower share with adjustments due to high historical emissions + GDP\n&gt;&gt;&gt; bool(shares_2020.loc[\"USA\"].item() &lt; equal_pc_shares.loc[\"USA\"].item())\nTrue\n</code></pre> See Also <p>equal_per_capita : Without adjustments per_capita_adjusted_gini : With Gini-adjusted GDP</p>"},{"location":"api/allocations/pathways/#per_capita_adjusted_gini","title":"per_capita_adjusted_gini","text":""},{"location":"api/allocations/pathways/#fair_shares.library.allocations.pathways.per_capita.per_capita_adjusted_gini","title":"fair_shares.library.allocations.pathways.per_capita.per_capita_adjusted_gini","text":"Python<pre><code>per_capita_adjusted_gini(\n    population_ts: TimeseriesDataFrame,\n    first_allocation_year: int,\n    emission_category: str,\n    country_actual_emissions_ts: (\n        TimeseriesDataFrame | None\n    ) = None,\n    gdp_ts: TimeseriesDataFrame | None = None,\n    gini_s: DataFrame | None = None,\n    responsibility_weight: float = 0.0,\n    capability_weight: float = 0.0,\n    historical_responsibility_year: int = 1990,\n    responsibility_per_capita: bool = True,\n    responsibility_exponent: float = 1.0,\n    responsibility_functional_form: str = \"asinh\",\n    capability_per_capita: bool = True,\n    capability_exponent: float = 1.0,\n    capability_functional_form: str = \"asinh\",\n    income_floor: float = 7500.0,\n    max_gini_adjustment: float = 0.8,\n    max_deviation_sigma: float | None = 2.0,\n    preserve_first_allocation_year_shares: bool = False,\n    group_level: str = \"iso3c\",\n    unit_level: str = \"unit\",\n    ur: PlainRegistry = get_default_unit_registry(),\n) -&gt; PathwayAllocationResult\n</code></pre> <p>Per capita pathway allocation with responsibility, capability, and Gini adjustments.</p> <p>The most comprehensive variant, incorporating:</p> <ul> <li>Responsibility adjustment: Countries with higher historical emissions     receive smaller allocations</li> <li>Capability adjustment: Countries with higher Gini-adjusted GDP     (per capita or absolute) receive smaller allocations</li> <li>Gini adjustment: GDP is adjusted for income inequality within countries</li> </ul> Mathematical Foundation <p>Similar to :func:<code>per_capita_adjusted</code>, but capability uses Gini-adjusted GDP to account for income inequality within countries.</p> <p>Gini Adjustment Process</p> <p>GDP is adjusted for each country at each year to reflect income inequality:</p> \\[ \\text{GDP}^{\\text{adj}}(g, t) = \\text{GDP}(g, t) \\times (1 - \\text{income-share-floor}) \\] <p>Where:</p> <ul> <li>\\(\\text{GDP}^{\\text{adj}}(g, t)\\): Gini-adjusted GDP of country \\(g\\) in year \\(t\\)</li> <li>\\(\\text{GDP}(g, t)\\): Unadjusted GDP of country \\(g\\) in year \\(t\\)</li> <li>\\(\\text{income-share-floor}\\): Share of income below the income floor threshold</li> </ul> <p>The income share floor is calculated from:</p> <ul> <li>\\(\\text{Gini}(g)\\): Gini coefficient for country \\(g\\) (0 to 1, higher = more inequality)</li> <li>\\(F\\): Income floor parameter (income below this threshold is excluded from capability)</li> <li>\\(\\alpha\\): Maximum Gini adjustment factor (prevents excessive reductions)</li> </ul> <p>Capability Adjustment with Gini-Adjusted GDP</p> <p>For per capita capability (:code:<code>capability_per_capita=True</code>, default):</p> \\[ C(g, t) = \\left(\\frac{\\sum_{t'=t_a}^{t} \\text{GDP}^{\\text{adj}}(g, t')}{\\sum_{t'=t_a}^{t} P(g, t')}\\right)^{-w_c \\times e_c} \\] <p>Where:</p> <ul> <li>\\(C(g, t)\\): Capability adjustment factor using Gini-adjusted GDP</li> <li>\\(\\text{GDP}^{\\text{adj}}(g, t')\\): Gini-adjusted GDP in year \\(t'\\)</li> <li>\\(P(g, t')\\): Population in year \\(t'\\)</li> <li>\\(t_a\\): First allocation year</li> <li>\\(w_c\\): Normalized capability weight</li> <li>\\(e_c\\): Capability exponent</li> </ul> <p>For absolute capability (:code:<code>capability_per_capita=False</code>):</p> \\[ C(g, t) = \\left(\\sum_{t'=t_a}^{t} \\text{GDP}^{\\text{adj}}(g, t')\\right)^{-w_c \\times e_c} \\] <p>Gini Adjustment Effect</p> <p>The Gini adjustment effectively reduces the GDP (and thus capability) of countries with high inequality, giving them larger emission allocations. This reflects that high-inequality countries have less capacity to pay because a larger share of their population has income below the capability threshold.</p> <p>For example, if country A and country B both have GDP per capita of $20,000, but country A has a Gini coefficient of 0.25 (low inequality) and country B has 0.50 (high inequality), country B's adjusted GDP will be lower, resulting in a larger emission allocation.</p> <p>Parameters:</p> Name Type Description Default <code>population_ts</code> <code>TimeseriesDataFrame</code> <p>Population time series for per capita calculations.</p> required <code>first_allocation_year</code> <code>int</code> <p>Starting year for the allocation. See docs/science/parameter-effects.md#allocation_year for how this affects country shares</p> required <code>emission_category</code> <code>str</code> <p>The emission category (e.g., 'co2-ffi', 'all-ghg').</p> required <code>country_actual_emissions_ts</code> <code>TimeseriesDataFrame | None</code> <p>Country emissions for responsibility calculation. Required if responsibility_weight &gt; 0.</p> <code>None</code> <code>gdp_ts</code> <code>TimeseriesDataFrame | None</code> <p>GDP time series for capability adjustment. Required if capability_weight &gt; 0 or gini_s provided.</p> <code>None</code> <code>gini_s</code> <code>DataFrame | None</code> <p>Gini coefficients for GDP inequality adjustment. When provided, GDP is adjusted to reflect income distribution within countries.</p> <code>None</code> <code>responsibility_weight</code> <code>float</code> <p>Weight for responsibility adjustment (0-1). Must satisfy: responsibility_weight + capability_weight &lt;= 1.0</p> <code>0.0</code> <code>capability_weight</code> <code>float</code> <p>Weight for capability adjustment (0-1). Must satisfy: responsibility_weight + capability_weight &lt;= 1.0</p> <code>0.0</code> <code>historical_responsibility_year</code> <code>int</code> <p>First year of responsibility window. Default: 1990</p> <code>1990</code> <code>responsibility_per_capita</code> <code>bool</code> <p>If True, use per capita emissions for responsibility. Default: True</p> <code>True</code> <code>responsibility_exponent</code> <code>float</code> <p>Exponent for responsibility adjustment calculation. Default: 1.0</p> <code>1.0</code> <code>responsibility_functional_form</code> <code>str</code> <p>Functional form for responsibility adjustment. Default: 'asinh'</p> <code>'asinh'</code> <code>capability_exponent</code> <code>float</code> <p>Exponent for capability adjustment calculation. Default: 1.0</p> <code>1.0</code> <code>capability_functional_form</code> <code>str</code> <p>Functional form for capability adjustment. Default: 'power'</p> <code>'asinh'</code> <code>income_floor</code> <code>float</code> <p>Income floor for Gini adjustment (in USD). Income below this threshold is excluded from capability calculations. Default: 7500.0 See docs/science/parameter-effects.md#income_floor for real allocation examples showing how this affects country shares</p> <code>7500.0</code> <code>max_gini_adjustment</code> <code>float</code> <p>Maximum reduction factor from Gini adjustment (0-1). Limits how much inequality can reduce effective GDP. Default: 0.8</p> <code>0.8</code> <code>max_deviation_sigma</code> <code>float | None</code> <p>Maximum allowed deviation from equal per capita baseline. If None, no constraint is applied.</p> <code>2.0</code> <code>preserve_first_allocation_year_shares</code> <code>bool</code> <p>If False (default), shares are calculated at each year. If True, shares calculated at first_allocation_year are preserved across all periods.</p> <code>False</code> <code>group_level</code> <code>str</code> <p>Index level name for grouping (typically 'iso3c'). Default: 'iso3c'</p> <code>'iso3c'</code> <code>unit_level</code> <code>str</code> <p>Index level name for units. Default: 'unit'</p> <code>'unit'</code> <code>ur</code> <code>PlainRegistry</code> <p>Pint unit registry for unit conversions.</p> <code>get_default_unit_registry()</code> <p>Returns:</p> Type Description <code>PathwayAllocationResult</code> <p>Relative shares over time, summing to unity each year.</p> Notes <p>This approach extends capability-based allocation by incorporating intra-national inequality. The Gini adjustment recognizes that GDP per capita may overstate the capability of high-inequality countries, where national income is concentrated among fewer people.</p> <p>When to Use</p> <ul> <li>When capability assessment should reflect actual income distribution</li> <li>When addressing concerns that high-inequality countries may have   overstated capability based on GDP averages</li> <li>For comprehensive allocation incorporating population, historical   responsibility, and inequality-adjusted capability</li> </ul> <p>See docs/science/allocations.md for theoretical grounding.</p> <p>Examples:</p> Python Console Session<pre><code>&gt;&gt;&gt; from fair_shares.library.utils import create_example_data\n&gt;&gt;&gt; data = create_example_data()\n&gt;&gt;&gt; # Equal weights with Gini adjustment\n&gt;&gt;&gt; result = per_capita_adjusted_gini(\n...     population_ts=data[\"population\"],\n...     country_actual_emissions_ts=data[\"emissions\"],\n...     gdp_ts=data[\"gdp\"],\n...     gini_s=data[\"gini\"],\n...     first_allocation_year=2020,\n...     emission_category=\"co2-ffi\",\n...     responsibility_weight=0.5,\n...     capability_weight=0.5,\n... )\nConverting units...\n&gt;&gt;&gt; # Check that shares sum to 1.0\n&gt;&gt;&gt; shares = result.relative_shares_pathway_emissions\n&gt;&gt;&gt; shares_2020 = shares[\"2020\"]\n&gt;&gt;&gt; bool(abs(shares_2020.sum() - 1.0) &lt; 1e-10)\nTrue\n&gt;&gt;&gt; # Verify approach is correctly identified\n&gt;&gt;&gt; result.approach\n'per-capita-adjusted-gini'\n&gt;&gt;&gt; # Verify all countries have valid shares (between 0 and 1)\n&gt;&gt;&gt; bool((shares_2020 &gt;= 0).all() and (shares_2020 &lt;= 1).all())\nTrue\n&gt;&gt;&gt; # Compare to non-Gini version - shares will differ due to inequality adjustment\n&gt;&gt;&gt; result_no_gini = per_capita_adjusted(\n...     population_ts=data[\"population\"],\n...     country_actual_emissions_ts=data[\"emissions\"],\n...     gdp_ts=data[\"gdp\"],\n...     first_allocation_year=2020,\n...     emission_category=\"co2-ffi\",\n...     responsibility_weight=0.5,\n...     capability_weight=0.5,\n... )\nConverting units...\n&gt;&gt;&gt; shares_no_gini = result_no_gini.relative_shares_pathway_emissions[\"2020\"]\n&gt;&gt;&gt; # Gini adjustment changes the allocation pattern\n&gt;&gt;&gt; bool(not shares_2020.equals(shares_no_gini))\nTrue\n</code></pre> See Also <p>equal_per_capita : Without adjustments per_capita_adjusted : Without Gini adjustment</p>"},{"location":"api/allocations/pathways/#convergence-pathways","title":"Convergence Pathways","text":""},{"location":"api/allocations/pathways/#per_capita_convergence","title":"per_capita_convergence","text":""},{"location":"api/allocations/pathways/#fair_shares.library.allocations.pathways.per_capita_convergence.per_capita_convergence","title":"fair_shares.library.allocations.pathways.per_capita_convergence.per_capita_convergence","text":"Python<pre><code>per_capita_convergence(\n    population_ts: TimeseriesDataFrame,\n    country_actual_emissions_ts: TimeseriesDataFrame,\n    first_allocation_year: int,\n    convergence_year: int,\n    emission_category: str,\n    group_level: str = \"iso3c\",\n    unit_level: str = \"unit\",\n    ur: PlainRegistry = get_default_unit_registry(),\n) -&gt; PathwayAllocationResult\n</code></pre> <p>Per capita convergence pathway blending grandfathering and equal per capita.</p> <p>This approach transitions from grandfathering (GF) to equal per capita (EPC) from allocation time, \\(t_{a}\\), to convergence time, \\(t_{conv}\\), using a linear weight \\(M(t)\\). It implements a variant of Contraction and Convergence [GCI 2003], where global emissions contract while per capita emissions converge to equality by a target date.</p> Mathematical Foundation <p>Baseline Shares at Allocation Time</p> <p>Grandfathering and equal per capita shares at allocation time are calculated as:</p> \\[ \\mathrm{GF}(g) = \\frac{E(g, t_{a})}{\\sum_{g'} E(g', t_{a})} \\] \\[ \\mathrm{EPC}(g) = \\frac{P(g, t_{a})}{\\sum_{g'} P(g', t_{a})} \\] <p>Where:</p> <ul> <li>\\(E(g, t_{a})\\): Emissions of country \\(g\\) at first allocation year \\(t_a\\)</li> <li>\\(P(g, t_{a})\\): Population of country \\(g\\) at first allocation year \\(t_a\\)</li> </ul> <p>Time-Dependent Blending Weight</p> <p>The transition weight \\(M(t)\\) controls the blend between grandfathering and equal per capita:</p> <ul> <li>\\(M(t) = 1\\) for \\(t \\le t_{a}\\) (full grandfathering at start)</li> <li>\\(M(t) = \\frac{t_{conv} - t}{t_{conv} - t_{a}}\\) for \\(t_{a} &lt; t &lt; t_{conv}\\)</li> <li>\\(M(t) = 0\\) for \\(t \\ge t_{conv}\\) (full equal per capita at convergence)</li> </ul> <p>Blended Allocation</p> <p>The final allocation blends the two principles:</p> \\[ A(g, t) = M(t) \\cdot \\mathrm{GF}(g) + (1 - M(t)) \\cdot \\mathrm{EPC}(g) \\] <p>Parameters:</p> Name Type Description Default <code>population_ts</code> <code>TimeseriesDataFrame</code> <p>Timeseries of population for each group of interest.</p> required <code>country_actual_emissions_ts</code> <code>TimeseriesDataFrame</code> <p>Timeseries of emissions for each group of interest.</p> required <code>first_allocation_year</code> <code>int</code> <p>First year that should be used for calculating the allocation. This must be a column in both population and emissions.</p> required <code>convergence_year</code> <code>int</code> <p>Year by which allocations fully converge to equal per capita.</p> required <code>emission_category</code> <code>str</code> <p>Emission category to include in the output.</p> required <code>group_level</code> <code>str</code> <p>Level in index specifying group information. Default: 'iso3c'</p> <code>'iso3c'</code> <code>unit_level</code> <code>str</code> <p>Level in index specifying units. Default: 'unit'</p> <code>'unit'</code> <code>ur</code> <code>PlainRegistry</code> <p>The unit registry to use for calculations.</p> <code>get_default_unit_registry()</code> <p>Returns:</p> Type Description <code>PathwayAllocationResult</code> <p>Container with relative shares for pathway emissions allocation. The TimeseriesDataFrame contains all years from first_allocation_year onwards with shares that sum to 1 across groups for the specified emission category.</p> Notes <p>When to Use</p> <ul> <li>Academic comparison with Contraction and Convergence scenarios</li> <li>Exploring sensitivity of allocations to transition period length</li> <li>When a gradual transition from status quo is explicitly desired</li> </ul> <p>Limitations</p> <ul> <li>Does not incorporate historical responsibility for past emissions</li> <li>Does not incorporate capability/ability to pay</li> <li>The grandfathering starting point lacks ethical basis (see referenced docs)</li> </ul> <p>For allocations grounded in CBDR-RC principles, consider using per_capita_adjusted or cumulative_per_capita_convergence approaches.</p> <p>Examples:</p> <p>Calculate per capita convergence allocation transitioning from current emission shares to equal per capita shares over a 30-year period.</p> Python Console Session<pre><code>&gt;&gt;&gt; from fair_shares.library.utils import create_example_data\n&gt;&gt;&gt; data = create_example_data(\n...     countries=[\"USA\", \"CHN\", \"IND\"], years=[2020, 2030, 2050]\n... )\n&gt;&gt;&gt; result = per_capita_convergence(\n...     population_ts=data[\"population\"],\n...     country_actual_emissions_ts=data[\"emissions\"],\n...     first_allocation_year=2020,\n...     convergence_year=2050,\n...     emission_category=\"co2-ffi\",\n... )\n&gt;&gt;&gt; result.approach\n'per-capita-convergence'\n&gt;&gt;&gt; result.parameters[\"convergence_year\"]\n2050\n&gt;&gt;&gt; # Result contains relative shares that blend from current emissions\n&gt;&gt;&gt; # (grandfathering) at 2020 to equal per capita at 2050\n&gt;&gt;&gt; result.relative_shares_pathway_emissions.sum(axis=0).round(3)\n2020    1.000\n2030    1.000\n2050    1.000\ndtype: float64\n</code></pre> See Also <p>per_capita_adjusted : Equal per capita with responsibility/capability adjustments cumulative_per_capita_convergence : Convergence accounting for cumulative emissions</p>"},{"location":"api/allocations/pathways/#cumulative_per_capita_convergence","title":"cumulative_per_capita_convergence","text":""},{"location":"api/allocations/pathways/#fair_shares.library.allocations.pathways.cumulative_per_capita_convergence.cumulative_per_capita_convergence","title":"fair_shares.library.allocations.pathways.cumulative_per_capita_convergence.cumulative_per_capita_convergence","text":"Python<pre><code>cumulative_per_capita_convergence(\n    population_ts: TimeseriesDataFrame,\n    country_actual_emissions_ts: TimeseriesDataFrame,\n    first_allocation_year: int,\n    emission_category: str,\n    world_scenario_emissions_ts: TimeseriesDataFrame,\n    max_deviation_sigma: float | None = 2.0,\n    max_convergence_speed: float = 0.9,\n    strict: bool = True,\n    group_level: str = \"iso3c\",\n    unit_level: str = \"unit\",\n    ur: PlainRegistry = get_default_unit_registry(),\n) -&gt; PathwayAllocationResult\n</code></pre> <p>Pure cumulative per capita convergence allocation without adjustments.</p> <p>Allocates emissions based on cumulative population shares, converging from initial emission shares to cumulative per capita targets over time.</p> Mathematical Foundation <p>Convergence Dynamics</p> <p>The allocation shares evolve through exponential convergence:</p> \\[ A(g, t+1) = A(g, t) + \\lambda \\big(A^{\\infty}(g) - A(g, t)\\big) \\] <p>Where:</p> <ul> <li>\\(A(g, t)\\): Allocation share for country \\(g\\) at year \\(t\\)</li> <li>\\(A^{\\infty}(g)\\): Long-run target share that each year converges toward</li> <li>\\(\\lambda\\): Convergence speed (automatically determined to be minimum feasible)</li> </ul> <p>Initial Shares</p> <p>Initial shares at first_allocation_year are based on actual emissions:</p> \\[ A(g, t_a) = \\frac{E(g, t_a)}{\\sum_{g'} E(g', t_a)} \\] <p>Where:</p> <ul> <li>\\(A(g, t_a)\\): Initial allocation share for country \\(g\\) at first allocation year</li> <li>\\(E(g, t_a)\\): Actual emissions of country \\(g\\) at year \\(t_a\\)</li> <li>\\(t_a\\): First allocation year</li> <li>\\(\\sum_{g'} E(g', t_a)\\): Total world emissions at first allocation year</li> </ul> <p>Cumulative Target Shares</p> <p>The cumulative target shares are based on cumulative population:</p> \\[ T_{\\text{cum}}(g) = \\frac{\\sum_{t \\geq t_a} P(g, t)}{\\sum_{g'} \\sum_{t \\geq t_a} P(g', t)} \\] <p>Where:</p> <ul> <li>\\(T_{\\text{cum}}(g)\\): Cumulative target share for country \\(g\\)</li> <li>\\(P(g, t)\\): Population of country \\(g\\) at year \\(t\\)</li> <li>\\(\\sum_{t \\geq t_a} P(g, t)\\): Cumulative population of country \\(g\\) from allocation year onwards</li> <li>\\(\\sum_{g'} \\sum_{t \\geq t_a} P(g', t)\\): Total cumulative world population from allocation year onwards</li> </ul> <p>Convergence Speed Determination</p> <p>The convergence speed \\(\\lambda\\) is automatically determined to be the minimum speed that ensures cumulative allocations match targets:</p> \\[ \\sum_{t \\geq t_a} w(t) \\, A(g, t) = T_{\\text{cum}}(g) \\] <p>Where:</p> <ul> <li>\\(w(t)\\): Year weight for year \\(t\\), defined as \\(w(t) = \\frac{W(t)}{\\sum_{t' \\geq t_a} W(t')}\\)</li> <li>\\(W(t)\\): World emissions in year \\(t\\) from the scenario pathway</li> </ul> <p>Deviation Constraint</p> <p>When :code:<code>max_deviation_sigma</code> is provided, cumulative target shares are constrained to prevent extreme deviations from equal cumulative per capita:</p> \\[ T_{\\text{equal}}(g) - \\sigma \\, s \\leq T_{\\text{cum}}(g) \\leq T_{\\text{equal}}(g) + \\sigma \\, s \\] <p>Where:</p> <ul> <li>\\(T_{\\text{equal}}(g)\\): Equal cumulative per capita baseline share</li> <li>\\(\\sigma\\): Maximum deviation parameter (e.g., 2.0 standard deviations)</li> <li>\\(s\\): Population-weighted standard deviation of unconstrained cumulative targets</li> </ul> <p>Parameters:</p> Name Type Description Default <code>population_ts</code> <code>TimeseriesDataFrame</code> <p>Population time series for calculating cumulative per capita shares.</p> required <code>country_actual_emissions_ts</code> <code>TimeseriesDataFrame</code> <p>Country emissions for calculating initial shares at first_allocation_year.</p> required <code>world_scenario_emissions_ts</code> <code>TimeseriesDataFrame</code> <p>World emissions pathway defining the time horizon and year weights.</p> required <code>first_allocation_year</code> <code>int</code> <p>Starting year for the allocation.</p> required <code>emission_category</code> <code>str</code> <p>The emission category (e.g., 'co2-ffi', 'all-ghg').</p> required <code>max_deviation_sigma</code> <code>float | None</code> <p>Maximum allowed deviation from equal per capita baseline in terms of population-weighted standard deviations. If provided, constrains each group's share to be within \u00b1max_deviation_sigma standard deviations from the baseline equal per capita share. If None, no constraint is applied.</p> <code>2.0</code> <code>group_level</code> <code>str</code> <p>Index level name for grouping (typically 'iso3c'). Default: 'iso3c'</p> <code>'iso3c'</code> <code>unit_level</code> <code>str</code> <p>Index level name for units. Default: 'unit'</p> <code>'unit'</code> <code>ur</code> <code>PlainRegistry</code> <p>Pint unit registry for unit conversions.</p> <code>get_default_unit_registry()</code> <p>Returns:</p> Type Description <code>PathwayAllocationResult</code> <p>Relative shares over time, summing to unity each year.</p> See Also <p>cumulative_per_capita_convergence_adjusted : With     responsibility/capability adjustments cumulative_per_capita_convergence_adjusted_gini : With Gini-adjusted GDP</p> Notes <p>Theoretical grounding:</p> <p>For theoretical foundations, use cases, and limitations, see:     docs/science/allocations.md#convergence-mechanism-theoretical-foundations</p> <p>For translating the egalitarian tradition (which grounds the equal per capita principle) into pathway allocations, see:     docs/science/principle-to-code.md#convergence-pathway-approaches</p> <p>For CBDR-RC principles (responsibility and capability), use cumulative_per_capita_convergence_adjusted or cumulative_per_capita_convergence_adjusted_gini.</p> <p>Convergence Speed</p> <p>The convergence speed is automatically determined to be the minimum speed that ensures cumulative targets are met, creating the smoothest possible transition path while still achieving equity goals. The <code>strict</code> parameter controls whether an error is raised if exact targets cannot be achieved.</p> <p>Examples:</p> <p>Basic usage with default parameters:</p> Python Console Session<pre><code>&gt;&gt;&gt; from fair_shares.library.utils import create_example_data\n&gt;&gt;&gt; from fair_shares.library.allocations.pathways import (\n...     cumulative_per_capita_convergence,\n... )\n&gt;&gt;&gt; # Create example data\n&gt;&gt;&gt; data = create_example_data(\n...     countries=[\"USA\", \"CHN\", \"IND\"], years=[2020, 2030, 2050]\n... )\n&gt;&gt;&gt; # Run allocation with strict=False for limited time horizon\n&gt;&gt;&gt; result = cumulative_per_capita_convergence(\n...     population_ts=data[\"population\"],\n...     country_actual_emissions_ts=data[\"emissions\"],\n...     world_scenario_emissions_ts=data[\"world_emissions\"],\n...     first_allocation_year=2020,\n...     emission_category=\"co2-ffi\",\n...     strict=False,  # Accept approximate targets with limited data\n... )\nConverting units...\n&gt;&gt;&gt; # Check approach is correct\n&gt;&gt;&gt; result.approach\n'cumulative-per-capita-convergence'\n&gt;&gt;&gt; # Shares sum to 1.0 at each year\n&gt;&gt;&gt; shares = result.relative_shares_pathway_emissions\n&gt;&gt;&gt; bool(abs(shares[\"2020\"].sum() - 1.0) &lt; 1e-10)\nTrue\n</code></pre> <p>Adjust convergence behavior with strict=False for approximate targets:</p> Python Console Session<pre><code>&gt;&gt;&gt; result_approx = cumulative_per_capita_convergence(\n...     population_ts=data[\"population\"],\n...     country_actual_emissions_ts=data[\"emissions\"],\n...     world_scenario_emissions_ts=data[\"world_emissions\"],\n...     first_allocation_year=2020,\n...     emission_category=\"co2-ffi\",\n...     strict=False,  # Accept approximate targets\n...     max_convergence_speed=0.5,  # Slower, smoother convergence\n... )\nConverting units...\n&gt;&gt;&gt; # Check for warnings about deviations\n&gt;&gt;&gt; if result_approx.country_warnings:\n...     print(\"Some targets approximate:\", result_approx.country_warnings)\n</code></pre> <p>Remove deviation constraints for unconstrained targets:</p> Python Console Session<pre><code>&gt;&gt;&gt; result_unconstrained = cumulative_per_capita_convergence(\n...     population_ts=data[\"population\"],\n...     country_actual_emissions_ts=data[\"emissions\"],\n...     world_scenario_emissions_ts=data[\"world_emissions\"],\n...     first_allocation_year=2020,\n...     emission_category=\"co2-ffi\",\n...     max_deviation_sigma=None,  # No constraints on target shares\n...     strict=False,  # Needed for limited data\n... )\nConverting units...\n</code></pre>"},{"location":"api/allocations/pathways/#cumulative_per_capita_convergence_adjusted","title":"cumulative_per_capita_convergence_adjusted","text":""},{"location":"api/allocations/pathways/#fair_shares.library.allocations.pathways.cumulative_per_capita_convergence.cumulative_per_capita_convergence_adjusted","title":"fair_shares.library.allocations.pathways.cumulative_per_capita_convergence.cumulative_per_capita_convergence_adjusted","text":"Python<pre><code>cumulative_per_capita_convergence_adjusted(\n    population_ts: TimeseriesDataFrame,\n    country_actual_emissions_ts: TimeseriesDataFrame,\n    first_allocation_year: int,\n    emission_category: str,\n    world_scenario_emissions_ts: TimeseriesDataFrame,\n    gdp_ts: TimeseriesDataFrame | None = None,\n    responsibility_weight: float = 0.0,\n    capability_weight: float = 0.0,\n    historical_responsibility_year: int = 1990,\n    responsibility_per_capita: bool = True,\n    responsibility_exponent: float = 1.0,\n    responsibility_functional_form: str = \"asinh\",\n    capability_per_capita: bool = True,\n    capability_exponent: float = 1.0,\n    capability_functional_form: str = \"asinh\",\n    max_deviation_sigma: float | None = 2.0,\n    max_convergence_speed: float = 0.9,\n    strict: bool = True,\n    group_level: str = \"iso3c\",\n    unit_level: str = \"unit\",\n    ur: PlainRegistry = get_default_unit_registry(),\n) -&gt; PathwayAllocationResult\n</code></pre> <p>Cumulative per capita convergence with responsibility and capability adjustments.</p> <p>Extends cumulative per capita convergence by incorporating:</p> <ul> <li>Responsibility adjustment: Countries with higher historical emissions     receive smaller allocations</li> <li>Capability adjustment: Countries with higher GDP receive smaller allocations</li> </ul> Mathematical Foundation <p>Convergence Dynamics</p> <p>The allocation shares evolve through exponential convergence (same as base approach):</p> \\[ A(g, t+1) = A(g, t) + \\lambda \\big(A^{\\infty}(g) - A(g, t)\\big) \\] <p>Where:</p> <ul> <li>\\(A(g, t)\\): Allocation share for country \\(g\\) at year \\(t\\)</li> <li>\\(A^{\\infty}(g)\\): Long-run target share</li> <li>\\(\\lambda\\): Convergence speed (automatically determined)</li> </ul> <p>Initial shares at first_allocation_year are based on actual emissions.</p> <p>Cumulative Target Shares with Adjustments</p> <p>Target shares are computed by adjusting cumulative population for historical responsibility and economic capability:</p> \\[ T_{\\text{cum}}(g) = \\frac{P_{\\text{adj}}(g)}{\\sum_{g'} P_{\\text{adj}}(g')} \\] <p>Where the adjusted population is:</p> \\[ P_{\\text{adj}}(g) = P_{\\text{cum}}(g) \\times R(g) \\times C(g) \\] <p>Where:</p> <ul> <li>\\(T_{\\text{cum}}(g)\\): Cumulative target share for country \\(g\\)</li> <li>\\(P_{\\text{adj}}(g)\\): Adjusted cumulative population</li> <li>\\(P_{\\text{cum}}(g) = \\sum_{t \\geq t_a} P(g, t)\\): Cumulative population from allocation year onwards</li> <li>\\(R(g)\\): Responsibility adjustment factor (equals 1.0 if not used)</li> <li>\\(C(g)\\): Capability adjustment factor (equals 1.0 if not used)</li> </ul> <p>Responsibility Adjustment</p> <p>The responsibility metric is based on cumulative historical emissions from historical_responsibility_year to first_allocation_year.</p> <p>For per capita responsibility (:code:<code>responsibility_per_capita=True</code>, default):</p> \\[ R(g) = \\left(\\frac{\\sum_{t=t_h}^{t_a} E(g, t)}{\\sum_{t=t_h}^{t_a} P(g, t)}\\right)^{-w_r \\times e_r} \\] <p>Where:</p> <ul> <li>\\(R(g)\\): Responsibility adjustment factor (inverse - higher emissions = lower allocation)</li> <li>\\(E(g, t)\\): Emissions of country \\(g\\) in year \\(t\\)</li> <li>\\(t_h\\): Historical responsibility start year</li> <li>\\(t_a\\): First allocation year</li> <li>\\(w_r\\): Normalized responsibility weight</li> <li>\\(e_r\\): Responsibility exponent</li> </ul> <p>For absolute responsibility (:code:<code>responsibility_per_capita=False</code>):</p> \\[ R(g) = \\left(\\sum_{t=t_h}^{t_a} E(g, t)\\right)^{-w_r \\times e_r} \\] <p>Capability Adjustment</p> <p>The capability metric is based on cumulative GDP from first_allocation_year onwards.</p> <p>For per capita capability (:code:<code>capability_per_capita=True</code>, default):</p> \\[ C(g) = \\left(\\frac{\\sum_{t \\geq t_a} \\text{GDP}(g, t)}{\\sum_{t \\geq t_a} P(g, t)}\\right)^{-w_c \\times e_c} \\] <p>Where:</p> <ul> <li>\\(C(g)\\): Capability adjustment factor (inverse - higher cumulative GDP per capita = lower allocation)</li> <li>\\(\\text{GDP}(g, t)\\): Gross domestic product of country \\(g\\) in year \\(t\\)</li> <li>\\(w_c\\): Normalized capability weight</li> <li>\\(e_c\\): Capability exponent</li> </ul> <p>For absolute capability (:code:<code>capability_per_capita=False</code>):</p> \\[ C(g) = \\left(\\sum_{t \\geq t_a} \\text{GDP}(g, t)\\right)^{-w_c \\times e_c} \\] <p>Deviation Constraint</p> <p>When :code:<code>max_deviation_sigma</code> is provided, adjusted cumulative target shares are constrained to prevent extreme deviations from equal cumulative per capita.</p> <p>Parameters:</p> Name Type Description Default <code>population_ts</code> <code>TimeseriesDataFrame</code> <p>Population time series for per capita calculations and responsibility adjustment.</p> required <code>country_actual_emissions_ts</code> <code>TimeseriesDataFrame</code> <p>Country emissions for initial shares and responsibility calculation.</p> required <code>world_scenario_emissions_ts</code> <code>TimeseriesDataFrame</code> <p>World emissions pathway defining time horizon and year weights.</p> required <code>first_allocation_year</code> <code>int</code> <p>Starting year for the allocation.</p> required <code>emission_category</code> <code>str</code> <p>The emission category (e.g., 'co2-ffi', 'all-ghg').</p> required <code>gdp_ts</code> <code>TimeseriesDataFrame | None</code> <p>GDP time series for capability adjustment. Required if capability_weight &gt; 0.</p> <code>None</code> <code>responsibility_weight</code> <code>float</code> <p>Weight for responsibility adjustment (0-1). Higher historical emissions -&gt; smaller allocation. Must satisfy: responsibility_weight + capability_weight &lt;= 1.0</p> <code>0.0</code> <code>capability_weight</code> <code>float</code> <p>Weight for capability adjustment (0-1). Higher GDP -&gt; smaller allocation. Requires gdp_ts. Must satisfy: responsibility_weight + capability_weight &lt;= 1.0</p> <code>0.0</code> <code>historical_responsibility_year</code> <code>int</code> <p>First year of responsibility window [historical_responsibility_year, first_allocation_year]. Default: 1990</p> <code>1990</code> <code>responsibility_per_capita</code> <code>bool</code> <p>If True, use per capita emissions for responsibility. Default: True</p> <code>True</code> <code>responsibility_exponent</code> <code>float</code> <p>Exponent for responsibility adjustment calculation. Default: 1.0</p> <code>1.0</code> <code>responsibility_functional_form</code> <code>str</code> <p>Functional form for responsibility adjustment ('asinh', 'power', 'linear'). Default: 'asinh'</p> <code>'asinh'</code> <code>capability_per_capita</code> <code>bool</code> <p>If True, use per capita GDP for capability. Default: True</p> <code>True</code> <code>capability_exponent</code> <code>float</code> <p>Exponent for capability adjustment calculation. Default: 1.0</p> <code>1.0</code> <code>capability_functional_form</code> <code>str</code> <p>Functional form for capability adjustment ('asinh', 'power', 'linear'). Default: 'asinh'</p> <code>'asinh'</code> <code>max_deviation_sigma</code> <code>float | None</code> <p>Maximum allowed deviation from equal per capita baseline in terms of population-weighted standard deviations. If None, no constraint is applied.</p> <code>2.0</code> <code>max_convergence_speed</code> <code>float</code> <p>Maximum allowed convergence speed (0 to 1.0). Lower values create smoother pathways but may become infeasible. Default: 0.9</p> <code>0.9</code> <code>strict</code> <code>bool</code> <p>If True (default), raise error for infeasible convergence. If False, use nearest feasible solution with warnings.</p> <code>True</code> <code>group_level</code> <code>str</code> <p>Index level name for grouping (typically 'iso3c'). Default: 'iso3c'</p> <code>'iso3c'</code> <code>unit_level</code> <code>str</code> <p>Index level name for units. Default: 'unit'</p> <code>'unit'</code> <code>ur</code> <code>PlainRegistry</code> <p>Pint unit registry for unit conversions.</p> <code>get_default_unit_registry()</code> <p>Returns:</p> Type Description <code>PathwayAllocationResult</code> <p>Relative shares over time, summing to unity each year.</p> See Also <p>cumulative_per_capita_convergence : Without adjustments cumulative_per_capita_convergence_adjusted_gini : With Gini-adjusted GDP</p> Notes <p>Theoretical grounding:</p> <p>For theoretical foundations and CBDR-RC principles, see:     docs/science/allocations.md#convergence-mechanism-theoretical-foundations     docs/science/allocations.md#4-common-but-differentiated-responsibilities-cbdr-rc</p> <p>For translating equity principles into pathway allocations, see:     docs/science/principle-to-code.md#convergence-pathway-approaches     docs/science/principle-to-code.md#cbdr-rc</p> <p>This approach incorporates historical responsibility and capability adjustments to operationalize Common But Differentiated Responsibilities and Respective Capabilities (CBDR-RC). Higher past emissions and higher GDP -&gt; smaller allocation.</p> <p>Examples:</p> <p>Basic usage with equal responsibility and capability weights:</p> Python Console Session<pre><code>&gt;&gt;&gt; from fair_shares.library.utils import create_example_data\n&gt;&gt;&gt; from fair_shares.library.allocations.pathways import (\n...     cumulative_per_capita_convergence_adjusted,\n... )\n&gt;&gt;&gt; # Create example data\n&gt;&gt;&gt; data = create_example_data(\n...     countries=[\"USA\", \"CHN\", \"IND\"], years=[2020, 2030, 2050]\n... )\n&gt;&gt;&gt; # Run allocation with adjustments and strict=False for limited data\n&gt;&gt;&gt; result = cumulative_per_capita_convergence_adjusted(\n...     population_ts=data[\"population\"],\n...     country_actual_emissions_ts=data[\"emissions\"],\n...     world_scenario_emissions_ts=data[\"world_emissions\"],\n...     gdp_ts=data[\"gdp\"],\n...     first_allocation_year=2020,\n...     emission_category=\"co2-ffi\",\n...     responsibility_weight=0.5,  # 50% adjustment for historical emissions\n...     capability_weight=0.5,  # 50% adjustment for GDP\n...     strict=False,  # Accept approximate targets with limited data\n... )\nConverting units...\n&gt;&gt;&gt; # Check results - high emitters get less than pure per-capita\n&gt;&gt;&gt; result.approach\n'cumulative-per-capita-convergence-adjusted'\n&gt;&gt;&gt; # Shares sum to 1.0 at each year\n&gt;&gt;&gt; shares = result.relative_shares_pathway_emissions\n&gt;&gt;&gt; bool(abs(shares[\"2020\"].sum() - 1.0) &lt; 1e-10)\nTrue\n</code></pre> <p>Adjust convergence speed for smoother pathways:</p> Python Console Session<pre><code>&gt;&gt;&gt; result_smooth = cumulative_per_capita_convergence_adjusted(\n...     population_ts=data[\"population\"],\n...     country_actual_emissions_ts=data[\"emissions\"],\n...     world_scenario_emissions_ts=data[\"world_emissions\"],\n...     gdp_ts=data[\"gdp\"],\n...     first_allocation_year=2020,\n...     emission_category=\"co2-ffi\",\n...     responsibility_weight=0.3,\n...     capability_weight=0.3,\n...     max_convergence_speed=0.5,\n...     strict=False,\n... )\nConverting units...\n&gt;&gt;&gt; # Check for warnings if targets couldn't be met exactly\n&gt;&gt;&gt; if result_smooth.country_warnings:\n...     print(\"Approximate targets:\", result_smooth.country_warnings)\n</code></pre> <p>Emphasize responsibility over capability:</p> Python Console Session<pre><code>&gt;&gt;&gt; result_responsibility = cumulative_per_capita_convergence_adjusted(\n...     population_ts=data[\"population\"],\n...     country_actual_emissions_ts=data[\"emissions\"],\n...     world_scenario_emissions_ts=data[\"world_emissions\"],\n...     gdp_ts=data[\"gdp\"],\n...     first_allocation_year=2020,\n...     emission_category=\"co2-ffi\",\n...     responsibility_weight=0.7,\n...     capability_weight=0.3,\n...     strict=False,\n... )\nConverting units...\n&gt;&gt;&gt; # Historical emitters penalized more than in equal-weight case\n&gt;&gt;&gt; result_responsibility.parameters[\"responsibility_weight\"]\n0.7\n</code></pre>"},{"location":"api/allocations/pathways/#cumulative_per_capita_convergence_adjusted_gini","title":"cumulative_per_capita_convergence_adjusted_gini","text":""},{"location":"api/allocations/pathways/#fair_shares.library.allocations.pathways.cumulative_per_capita_convergence.cumulative_per_capita_convergence_adjusted_gini","title":"fair_shares.library.allocations.pathways.cumulative_per_capita_convergence.cumulative_per_capita_convergence_adjusted_gini","text":"Python<pre><code>cumulative_per_capita_convergence_adjusted_gini(\n    population_ts: TimeseriesDataFrame,\n    country_actual_emissions_ts: TimeseriesDataFrame,\n    first_allocation_year: int,\n    emission_category: str,\n    world_scenario_emissions_ts: TimeseriesDataFrame,\n    gdp_ts: TimeseriesDataFrame | None = None,\n    gini_s: DataFrame | None = None,\n    responsibility_weight: float = 0.0,\n    capability_weight: float = 0.0,\n    historical_responsibility_year: int = 1990,\n    responsibility_per_capita: bool = True,\n    responsibility_exponent: float = 1.0,\n    responsibility_functional_form: str = \"asinh\",\n    capability_per_capita: bool = True,\n    capability_exponent: float = 1.0,\n    capability_functional_form: str = \"asinh\",\n    income_floor: float = 7500.0,\n    max_gini_adjustment: float = 0.8,\n    max_deviation_sigma: float | None = 2.0,\n    max_convergence_speed: float = 0.9,\n    strict: bool = True,\n    group_level: str = \"iso3c\",\n    unit_level: str = \"unit\",\n    ur: PlainRegistry = get_default_unit_registry(),\n) -&gt; PathwayAllocationResult\n</code></pre> <p>Cumulative per capita convergence with Gini-adjusted GDP and full adjustments.</p> <p>The most comprehensive variant, incorporating:</p> <ul> <li>Responsibility adjustment: Countries with higher historical emissions   receive smaller allocations</li> <li>Capability adjustment: Countries with higher GDP receive smaller allocations</li> <li>Gini adjustment: GDP is adjusted for income inequality within countries</li> </ul> Mathematical Foundation <p>Convergence Dynamics</p> <p>The allocation shares evolve through exponential convergence (same as base approach):</p> \\[ A(g, t+1) = A(g, t) + \\lambda \\big(A^{\\infty}(g) - A(g, t)\\big) \\] <p>Where:</p> <ul> <li>\\(A(g, t)\\): Allocation share for country \\(g\\) at year \\(t\\)</li> <li>\\(A^{\\infty}(g)\\): Long-run target share</li> <li>\\(\\lambda\\): Convergence speed (automatically determined)</li> </ul> <p>Initial shares at first_allocation_year are based on actual emissions.</p> <p>Cumulative Target Shares with Adjustments</p> <p>Target shares are computed by adjusting cumulative population for historical responsibility and Gini-adjusted economic capability:</p> \\[ T_{\\text{cum}}(g) = \\frac{P_{\\text{adj}}(g)}{\\sum_{g'} P_{\\text{adj}}(g')} \\] <p>Where the adjusted population is:</p> \\[ P_{\\text{adj}}(g) = P_{\\text{cum}}(g) \\times R(g) \\times C_{\\text{Gini}}(g) \\] <p>Where:</p> <ul> <li>\\(T_{\\text{cum}}(g)\\): Cumulative target share for country \\(g\\)</li> <li>\\(P_{\\text{adj}}(g)\\): Adjusted cumulative population</li> <li>\\(P_{\\text{cum}}(g) = \\sum_{t \\geq t_a} P(g, t)\\): Cumulative population from allocation year onwards</li> <li>\\(R(g)\\): Responsibility adjustment factor (equals 1.0 if not used)</li> <li>\\(C_{\\text{Gini}}(g)\\): Gini-adjusted capability factor (equals 1.0 if not used)</li> </ul> <p>Gini Adjustment Process</p> <p>GDP is adjusted for within-country income inequality:</p> \\[ \\text{GDP}^{\\text{adj}}(g, t) = \\text{GDP}(g, t) \\times (1 - \\text{income-share-floor}) \\] <p>Where the income share floor is calculated from the Gini coefficient and income floor parameters. The adjustment reduces GDP for high-inequality countries, reflecting that their wealth is concentrated among fewer people.</p> <p>Responsibility Adjustment</p> <p>Identical to adjusted convergence (see that function for details).</p> <p>For per capita responsibility (:code:<code>responsibility_per_capita=True</code>, default):</p> \\[ R(g) = \\left(\\frac{\\sum_{t=t_h}^{t_a} E(g, t)}{\\sum_{t=t_h}^{t_a} P(g, t)}\\right)^{-w_r \\times e_r} \\] <p>Where:</p> <ul> <li>\\(E(g, t)\\): Emissions of country \\(g\\) in year \\(t\\)</li> <li>\\(t_h\\): Historical responsibility start year</li> <li>\\(t_a\\): First allocation year</li> <li>\\(w_r\\): Normalized responsibility weight</li> <li>\\(e_r\\): Responsibility exponent</li> </ul> <p>Capability Adjustment with Gini-Adjusted GDP</p> <p>The capability metric uses Gini-adjusted GDP to account for income inequality.</p> <p>For per capita capability (:code:<code>capability_per_capita=True</code>, default):</p> \\[ C_{\\text{Gini}}(g) = \\left(\\frac{\\sum_{t \\geq t_a} \\text{GDP}^{\\text{adj}}(g, t)}{\\sum_{t \\geq t_a} P(g, t)}\\right)^{-w_c \\times e_c} \\] <p>Where:</p> <ul> <li>\\(C_{\\text{Gini}}(g)\\): Gini-adjusted capability factor (inverse - higher adjusted GDP = lower allocation)</li> <li>\\(\\text{GDP}^{\\text{adj}}(g, t)\\): Gini-adjusted GDP in year \\(t\\)</li> <li>\\(w_c\\): Normalized capability weight</li> <li>\\(e_c\\): Capability exponent</li> </ul> <p>For absolute capability (:code:<code>capability_per_capita=False</code>):</p> \\[ C_{\\text{Gini}}(g) = \\left(\\sum_{t \\geq t_a} \\text{GDP}^{\\text{adj}}(g, t)\\right)^{-w_c \\times e_c} \\] <p>Gini Adjustment Effect</p> <p>The Gini adjustment effectively reduces the GDP (and thus capability) of countries with high inequality, giving them larger emission allocations. This reflects that high-inequality countries have less capacity to pay because a larger share of their population has income below the capability threshold.</p> <p>For example, if country A and country B both have cumulative GDP per capita of $500,000, but country A has a Gini coefficient of 0.25 (low inequality) and country B has 0.50 (high inequality), country B's adjusted GDP will be lower, resulting in a larger emission allocation.</p> <p>Deviation Constraint</p> <p>When :code:<code>max_deviation_sigma</code> is provided, adjusted cumulative target shares are constrained to prevent extreme deviations from equal cumulative per capita.</p> <p>Parameters:</p> Name Type Description Default <code>population_ts</code> <code>TimeseriesDataFrame</code> <p>Population time series for per capita calculations and responsibility adjustment.</p> required <code>country_actual_emissions_ts</code> <code>TimeseriesDataFrame</code> <p>Country emissions for initial shares and responsibility calculation.</p> required <code>world_scenario_emissions_ts</code> <code>TimeseriesDataFrame</code> <p>World emissions pathway defining time horizon and year weights.</p> required <code>first_allocation_year</code> <code>int</code> <p>Starting year for the allocation.</p> required <code>emission_category</code> <code>str</code> <p>The emission category (e.g., 'co2-ffi', 'all-ghg').</p> required <code>gdp_ts</code> <code>TimeseriesDataFrame | None</code> <p>GDP time series for capability adjustment. Required if capability_weight &gt; 0 or gini_s provided.</p> <code>None</code> <code>gini_s</code> <code>DataFrame | None</code> <p>Gini coefficients for GDP inequality adjustment. When provided, GDP is adjusted to reflect income distribution within countries.</p> <code>None</code> <code>responsibility_weight</code> <code>float</code> <p>Weight for responsibility adjustment (0-1). Higher historical emissions -&gt; smaller allocation. Must satisfy: responsibility_weight + capability_weight &lt;= 1.0</p> <code>0.0</code> <code>capability_weight</code> <code>float</code> <p>Weight for capability adjustment (0-1). Higher GDP -&gt; smaller allocation. Requires gdp_ts. Must satisfy: responsibility_weight + capability_weight &lt;= 1.0</p> <code>0.0</code> <code>historical_responsibility_year</code> <code>int</code> <p>First year of responsibility window [historical_responsibility_year, first_allocation_year]. Default: 1990</p> <code>1990</code> <code>responsibility_per_capita</code> <code>bool</code> <p>If True, use per capita emissions for responsibility. Default: True</p> <code>True</code> <code>responsibility_exponent</code> <code>float</code> <p>Exponent for responsibility adjustment calculation. Default: 1.0</p> <code>1.0</code> <code>responsibility_functional_form</code> <code>str</code> <p>Functional form for responsibility adjustment ('asinh', 'power', 'linear'). Default: 'asinh'</p> <code>'asinh'</code> <code>capability_per_capita</code> <code>bool</code> <p>If True, use per capita GDP for capability. Default: True</p> <code>True</code> <code>capability_exponent</code> <code>float</code> <p>Exponent for capability adjustment calculation. Default: 1.0</p> <code>1.0</code> <code>capability_functional_form</code> <code>str</code> <p>Functional form for capability adjustment ('asinh', 'power', 'linear'). Default: 'asinh'</p> <code>'asinh'</code> <code>income_floor</code> <code>float</code> <p>Income floor for Gini adjustment (in USD). Income below this threshold is excluded from capability calculations. Default: 7500.0</p> <code>7500.0</code> <code>max_gini_adjustment</code> <code>float</code> <p>Maximum reduction factor from Gini adjustment (0-1). Limits how much inequality can reduce effective GDP. Default: 0.8</p> <code>0.8</code> <code>max_deviation_sigma</code> <code>float | None</code> <p>Maximum allowed deviation from equal per capita baseline in terms of population-weighted standard deviations. If None, no constraint is applied.</p> <code>2.0</code> <code>max_convergence_speed</code> <code>float</code> <p>Maximum allowed convergence speed (0 to 1.0). Lower values create smoother pathways but may become infeasible. Default: 0.9</p> <code>0.9</code> <code>strict</code> <code>bool</code> <p>If True (default), raise error for infeasible convergence. If False, use nearest feasible solution with warnings.</p> <code>True</code> <code>group_level</code> <code>str</code> <p>Index level name for grouping (typically 'iso3c'). Default: 'iso3c'</p> <code>'iso3c'</code> <code>unit_level</code> <code>str</code> <p>Index level name for units. Default: 'unit'</p> <code>'unit'</code> <code>ur</code> <code>PlainRegistry</code> <p>Pint unit registry for unit conversions.</p> <code>get_default_unit_registry()</code> <p>Returns:</p> Type Description <code>PathwayAllocationResult</code> <p>Relative shares over time, summing to unity each year.</p> See Also <p>cumulative_per_capita_convergence : Without adjustments cumulative_per_capita_convergence_adjusted : Without Gini adjustment</p> Notes <p>Theoretical grounding:</p> <p>For theoretical foundations, intra-national equity, and Gini adjustment rationale, see:     docs/science/allocations.md#convergence-mechanism-theoretical-foundations     docs/science/allocations.md#gini-adjustment-for-within-country-inequality</p> <p>For translating equity principles into pathway allocations, see:     docs/science/principle-to-code.md#convergence-pathway-approaches     docs/science/principle-to-code.md#subsistence-protection</p> <p>This approach extends the adjusted convergence method by incorporating Gini-adjusted GDP to account for income inequality within countries. The <code>income_floor</code> parameter implements the subsistence vs. luxury emissions distinction. High-inequality countries have reduced effective capability.</p> <p>Examples:</p> <p>Basic usage with Gini-adjusted GDP:</p> Python Console Session<pre><code>&gt;&gt;&gt; from fair_shares.library.utils import create_example_data\n&gt;&gt;&gt; from fair_shares.library.allocations.pathways import (\n...     cumulative_per_capita_convergence_adjusted_gini,\n... )\n&gt;&gt;&gt; # Create example data\n&gt;&gt;&gt; data = create_example_data(\n...     countries=[\"USA\", \"CHN\", \"BRA\"], years=[2020, 2030, 2050]\n... )\n&gt;&gt;&gt; # Run allocation with Gini adjustment\n&gt;&gt;&gt; result = cumulative_per_capita_convergence_adjusted_gini(\n...     population_ts=data[\"population\"],\n...     country_actual_emissions_ts=data[\"emissions\"],\n...     world_scenario_emissions_ts=data[\"world_emissions\"],\n...     gdp_ts=data[\"gdp\"],\n...     gini_s=data[\"gini\"],\n...     first_allocation_year=2020,\n...     emission_category=\"co2-ffi\",\n...     responsibility_weight=0.5,  # 50% adjustment for historical emissions\n...     capability_weight=0.5,  # 50% adjustment for Gini-adjusted GDP\n... )\nConverting units...\n&gt;&gt;&gt; # Check results - Gini adjustment included\n&gt;&gt;&gt; result.approach\n'cumulative-per-capita-convergence-gini-adjusted'\n</code></pre> <p>Adjust Gini parameters to control inequality weighting:</p> Python Console Session<pre><code>&gt;&gt;&gt; # Custom Gini parameters\n&gt;&gt;&gt; result_custom_gini = (\n...     cumulative_per_capita_convergence_adjusted_gini(\n...         population_ts=data[\"population\"],\n...         country_actual_emissions_ts=data[\"emissions\"],\n...         world_scenario_emissions_ts=data[\"world_emissions\"],\n...         gdp_ts=data[\"gdp\"],\n...         gini_s=data[\"gini\"],\n...         first_allocation_year=2020,\n...         emission_category=\"co2-ffi\",\n...         responsibility_weight=0.3,\n...         capability_weight=0.3,\n...         income_floor=5000.0,  # Lower income floor\n...         max_gini_adjustment=0.9,  # Allow stronger inequality adjustment\n...         max_convergence_speed=0.5,  # Slower convergence\n...         strict=False,  # Accept approximate targets if exact infeasible\n...     )\n... )\nConverting units...\n&gt;&gt;&gt; # Countries with high inequality get more generous allocations\n&gt;&gt;&gt; result_custom_gini.approach\n'cumulative-per-capita-convergence-gini-adjusted'\n</code></pre>"},{"location":"api/allocations/pathways/#see-also","title":"See Also","text":"<ul> <li>Budget Allocations: Fixed cumulative budgets</li> <li>Scientific Documentation: Allocation Approaches: Theoretical foundations</li> <li>country-fair-shares Guide: Conceptual overview</li> </ul>"},{"location":"api/config/models/","title":"Configuration Models","text":"<p>Pydantic models for validating and managing configuration.</p>"},{"location":"api/config/models/#overview","title":"Overview","text":"<p>The fair-shares library uses Pydantic models to validate configuration files. These models ensure type safety and provide clear error messages when configuration is invalid.</p>"},{"location":"api/config/models/#data-sources-configuration","title":"Data Sources Configuration","text":""},{"location":"api/config/models/#datasourcesconfig","title":"DataSourcesConfig","text":""},{"location":"api/config/models/#fair_shares.library.config.models.DataSourcesConfig","title":"fair_shares.library.config.models.DataSourcesConfig","text":"<p>               Bases: <code>BaseModel</code></p> <p>Top-level configuration for all data sources.</p>"},{"location":"api/config/models/#fair_shares.library.config.models.DataSourcesConfig.emission_category","title":"emission_category  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>emission_category: Literal[\n    \"co2-ffi\", \"all-ghg\", \"all-ghg-ex-co2-lulucf\"\n] = Field(\n    ...,\n    description=\"Emission category for this configuration\",\n)\n</code></pre>"},{"location":"api/config/models/#fair_shares.library.config.models.DataSourcesConfig.emissions","title":"emissions  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>emissions: dict[str, EmissionsSourceConfig] = Field(\n    ..., description=\"Available emissions data sources\"\n)\n</code></pre>"},{"location":"api/config/models/#fair_shares.library.config.models.DataSourcesConfig.gdp","title":"gdp  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>gdp: dict[str, GDPSourceConfig] = Field(\n    ..., description=\"Available GDP data sources\"\n)\n</code></pre>"},{"location":"api/config/models/#fair_shares.library.config.models.DataSourcesConfig.population","title":"population  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>population: dict[str, PopulationSourceConfig] = Field(\n    ..., description=\"Available population data sources\"\n)\n</code></pre>"},{"location":"api/config/models/#fair_shares.library.config.models.DataSourcesConfig.gini","title":"gini  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>gini: dict[str, GiniSourceConfig] = Field(\n    ..., description=\"Available Gini data sources\"\n)\n</code></pre>"},{"location":"api/config/models/#fair_shares.library.config.models.DataSourcesConfig.targets","title":"targets  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>targets: dict[str, TargetSourceConfig] = Field(\n    ...,\n    description=\"Available target sources (AR6 scenarios, RCBs)\",\n)\n</code></pre>"},{"location":"api/config/models/#fair_shares.library.config.models.DataSourcesConfig.general","title":"general  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>general: GeneralConfig = Field(\n    ..., description=\"General configuration data\"\n)\n</code></pre>"},{"location":"api/config/models/#fair_shares.library.config.models.DataSourcesConfig.active_emissions_source","title":"active_emissions_source  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>active_emissions_source: str | None = Field(\n    None, description=\"Active emissions data source\"\n)\n</code></pre>"},{"location":"api/config/models/#fair_shares.library.config.models.DataSourcesConfig.active_gdp_source","title":"active_gdp_source  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>active_gdp_source: str | None = Field(\n    None, description=\"Active GDP data source\"\n)\n</code></pre>"},{"location":"api/config/models/#fair_shares.library.config.models.DataSourcesConfig.active_population_source","title":"active_population_source  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>active_population_source: str | None = Field(\n    None, description=\"Active population data source\"\n)\n</code></pre>"},{"location":"api/config/models/#fair_shares.library.config.models.DataSourcesConfig.active_gini_source","title":"active_gini_source  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>active_gini_source: str | None = Field(\n    None, description=\"Active Gini data source\"\n)\n</code></pre>"},{"location":"api/config/models/#fair_shares.library.config.models.DataSourcesConfig.active_target_source","title":"active_target_source  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>active_target_source: str | None = Field(\n    None,\n    description=\"Active target source (AR6 scenarios or RCBs)\",\n)\n</code></pre>"},{"location":"api/config/models/#fair_shares.library.config.models.DataSourcesConfig.harmonisation_year","title":"harmonisation_year  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>harmonisation_year: int | None = Field(\n    None, description=\"Year for global harmonisation\"\n)\n</code></pre>"},{"location":"api/config/models/#fair_shares.library.config.models.DataSourcesConfig.rcb_generator","title":"rcb_generator  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>rcb_generator: str | None = Field(\n    None,\n    description=\"RCB pathway generator (only used for RCB-pathways target)\",\n)\n</code></pre>"},{"location":"api/config/models/#fair_shares.library.config.models.DataSourcesConfig.validate_active_sources","title":"validate_active_sources","text":"Python<pre><code>validate_active_sources() -&gt; DataSourcesConfig\n</code></pre> <p>Validate that active sources exist in available sources.</p>"},{"location":"api/config/models/#fair_shares.library.config.models.DataSourcesConfig.validate_emission_category","title":"validate_emission_category","text":"Python<pre><code>validate_emission_category() -&gt; DataSourcesConfig\n</code></pre> <p>Validate that emission category is available in emissions source.</p>"},{"location":"api/config/models/#individual-data-source-configurations","title":"Individual Data Source Configurations","text":""},{"location":"api/config/models/#emissionssourceconfig","title":"EmissionsSourceConfig","text":""},{"location":"api/config/models/#fair_shares.library.config.models.EmissionsSourceConfig","title":"fair_shares.library.config.models.EmissionsSourceConfig","text":"<p>               Bases: <code>BaseModel</code></p> <p>Configuration for emissions data source.</p>"},{"location":"api/config/models/#populationsourceconfig","title":"PopulationSourceConfig","text":""},{"location":"api/config/models/#fair_shares.library.config.models.PopulationSourceConfig","title":"fair_shares.library.config.models.PopulationSourceConfig","text":"<p>               Bases: <code>BaseModel</code></p> <p>Configuration for population data source.</p>"},{"location":"api/config/models/#gdpsourceconfig","title":"GDPSourceConfig","text":""},{"location":"api/config/models/#fair_shares.library.config.models.GDPSourceConfig","title":"fair_shares.library.config.models.GDPSourceConfig","text":"<p>               Bases: <code>BaseModel</code></p> <p>Configuration for GDP data source.</p>"},{"location":"api/config/models/#ginisourceconfig","title":"GiniSourceConfig","text":""},{"location":"api/config/models/#fair_shares.library.config.models.GiniSourceConfig","title":"fair_shares.library.config.models.GiniSourceConfig","text":"<p>               Bases: <code>BaseModel</code></p> <p>Configuration for Gini data source.</p>"},{"location":"api/config/models/#see-also","title":"See Also","text":"<ul> <li>country-fair-shares Guide: Choose and configure allocations</li> <li>Developer Guide: Adding Data Sources: Available data sources</li> </ul>"},{"location":"api/utils/adjustments/","title":"Adjustment Functions","text":"<p>Functions for calculating responsibility, capability, and Gini adjustments.</p>"},{"location":"api/utils/adjustments/#relative-adjustments","title":"Relative Adjustments","text":""},{"location":"api/utils/adjustments/#calculate_relative_adjustment","title":"calculate_relative_adjustment","text":""},{"location":"api/utils/adjustments/#fair_shares.library.utils.calculate_relative_adjustment","title":"fair_shares.library.utils.calculate_relative_adjustment","text":"Python<pre><code>calculate_relative_adjustment(\n    values: TimeseriesDataFrame | Series,\n    functional_form: str = \"power\",\n    exponent: float = 1.0,\n    inverse: bool = True,\n) -&gt; TimeseriesDataFrame | Series\n</code></pre> <p>Calculate relative adjustment factors for allocations.</p> <p>Applies a transformation to input values (e.g., GDP per capita, cumulative emissions) to produce adjustment factors. See docs/science/allocations.md for theoretical grounding.</p> <p>Parameters:</p> Name Type Description Default <code>values</code> <code>TimeseriesDataFrame | Series</code> <p>Input values (GDP per capita, cumulative emissions, etc.)</p> required <code>functional_form</code> <code>str</code> <p>Transformation to apply: \"asinh\" or \"power\"</p> <code>'power'</code> <code>exponent</code> <code>float</code> <p>Exponent for the transformation</p> <code>1.0</code> <code>inverse</code> <code>bool</code> <p>If True (default), higher values -&gt; lower relative adjustment factor. If False, higher values -&gt; higher relative adjustment factor.</p> <code>True</code> <p>Returns:</p> Type Description <code>Adjustment factors with same structure as input</code> Notes <p>Negative or NaN values are clamped to 1.0 before transformation to avoid numerical issues and ensure valid results for all inputs.</p>"},{"location":"api/utils/adjustments/#gini-adjustments","title":"Gini Adjustments","text":""},{"location":"api/utils/adjustments/#apply_gini_adjustment","title":"apply_gini_adjustment","text":""},{"location":"api/utils/adjustments/#fair_shares.library.utils.apply_gini_adjustment","title":"fair_shares.library.utils.apply_gini_adjustment","text":"Python<pre><code>apply_gini_adjustment(\n    gdp_data: TimeseriesDataFrame | Series,\n    population_data: TimeseriesDataFrame | Series,\n    gini_lookup: dict[str, float],\n    income_floor: float,\n    max_gini_adjustment: float,\n    group_level: str = \"iso3c\",\n) -&gt; TimeseriesDataFrame | Series\n</code></pre> <p>Apply Gini adjustment to GDP data for all groups.</p> <p>Parameters:</p> Name Type Description Default <code>gdp_data</code> <code>TimeseriesDataFrame | Series</code> <p>GDP data (DataFrame or Series)</p> required <code>population_data</code> <code>TimeseriesDataFrame | Series</code> <p>Population data (DataFrame or Series)</p> required <code>gini_lookup</code> <code>dict[str, float]</code> <p>Dictionary mapping country codes to Gini coefficients</p> required <code>income_floor</code> <code>float</code> <p>Income floor value</p> required <code>max_gini_adjustment</code> <code>float</code> <p>Maximum adjustment allowed as proportion of total GDP</p> required <code>group_level</code> <code>str</code> <p>Level name for grouping (typically \"iso3c\")</p> <code>'iso3c'</code> <p>Returns:</p> Type Description <code>Gini-adjusted GDP data with same structure as input</code>"},{"location":"api/utils/adjustments/#create_gini_lookup_dict","title":"create_gini_lookup_dict","text":""},{"location":"api/utils/adjustments/#fair_shares.library.utils.create_gini_lookup_dict","title":"fair_shares.library.utils.create_gini_lookup_dict","text":"Python<pre><code>create_gini_lookup_dict(\n    gini_data_df: TimeseriesDataFrame,\n) -&gt; dict[str, float]\n</code></pre> <p>Create a simple lookup dict for Gini coefficients.</p> <p>Assumes the common case: - Index: MultiIndex with level 'iso3c' (and possibly 'unit') - Column: 'gini'</p> <p>Falls back to using 'iso3c' as a column if not found in the index.</p> <p>Parameters:</p> Name Type Description Default <code>gini_data_df</code> <code>TimeseriesDataFrame</code> <p>DataFrame containing Gini coefficient data</p> required <p>Returns:</p> Type Description <code>Dictionary mapping country codes to Gini coefficients</code>"},{"location":"api/utils/adjustments/#deviation-constraints","title":"Deviation Constraints","text":""},{"location":"api/utils/adjustments/#apply_deviation_constraint","title":"apply_deviation_constraint","text":""},{"location":"api/utils/adjustments/#fair_shares.library.utils.apply_deviation_constraint","title":"fair_shares.library.utils.apply_deviation_constraint","text":"Python<pre><code>apply_deviation_constraint(\n    shares: TimeseriesDataFrame,\n    population: TimeseriesDataFrame,\n    max_deviation_sigma: float,\n    group_level: str,\n) -&gt; TimeseriesDataFrame\n</code></pre> <p>Apply maximum deviation constraint from equal per capita baseline.</p> <p>Constrains allocation shares to within a specified number of standard deviations from equal per capita distribution. See docs/science/allocations.md for theoretical basis.</p> <p>Parameters:</p> Name Type Description Default <code>shares</code> <code>TimeseriesDataFrame</code> <p>Current allocation shares</p> required <code>population</code> <code>TimeseriesDataFrame</code> <p>Population data</p> required <code>max_deviation_sigma</code> <code>float</code> <p>Maximum allowed deviation in standard deviations</p> required <code>group_level</code> <code>str</code> <p>Level name for grouping (typically \"iso3c\")</p> required <p>Returns:</p> Type Description <code>Constrained allocation shares</code>"},{"location":"api/utils/adjustments/#see-also","title":"See Also","text":"<ul> <li>Core Utilities: Data manipulation functions</li> <li>Budget Allocations: Functions that use these adjustments</li> <li>Pathway Allocations: Functions that use these adjustments</li> </ul>"},{"location":"api/utils/core/","title":"Core Utilities","text":"<p>Core utility functions for data manipulation, unit conversion, and common operations.</p>"},{"location":"api/utils/core/#data-filtering","title":"Data Filtering","text":""},{"location":"api/utils/core/#filter_time_columns","title":"filter_time_columns","text":""},{"location":"api/utils/core/#fair_shares.library.utils.filter_time_columns","title":"fair_shares.library.utils.filter_time_columns","text":"Python<pre><code>filter_time_columns(\n    df: TimeseriesDataFrame, allocation_time: int\n) -&gt; TimeseriesDataFrame\n</code></pre> <p>Filter DataFrame to include only numeric columns &gt;= allocation_time.</p>"},{"location":"api/utils/core/#ensure_string_year_columns","title":"ensure_string_year_columns","text":""},{"location":"api/utils/core/#fair_shares.library.utils.ensure_string_year_columns","title":"fair_shares.library.utils.ensure_string_year_columns","text":"Python<pre><code>ensure_string_year_columns(\n    df: TimeseriesDataFrame, *, inplace: bool = False\n) -&gt; TimeseriesDataFrame\n</code></pre> <p>Coerce numeric-looking year column labels to strings.</p> <p>This is used to deal with TimeseriesDataFrames that have year columns often stored as ints or other types. We want to coerce these to strings so that merges are not problematic.</p> <p>Parameters:</p> Name Type Description Default <code>df</code> <code>TimeseriesDataFrame</code> <p>TimeseriesDataFrame that may contain year columns stored as ints or other types.</p> required <code>inplace</code> <code>bool</code> <p>If <code>True</code>, rename the columns on <code>df</code> and return it. If <code>False</code> (default), return a TimeseriesDataFrame with renamed columns and leave <code>df</code> untouched.</p> <code>False</code> <p>Returns:</p> Type Description <code>TimeseriesDataFrame</code> <p>TimeseriesDataFrame whose year columns are strings. The returned object is <code>df</code> when <code>inplace</code> is <code>True</code>; otherwise it is a renamed copy.</p>"},{"location":"api/utils/core/#unit-handling","title":"Unit Handling","text":""},{"location":"api/utils/core/#set_single_unit","title":"set_single_unit","text":""},{"location":"api/utils/core/#fair_shares.library.utils.set_single_unit","title":"fair_shares.library.utils.set_single_unit","text":"Python<pre><code>set_single_unit(\n    df: TimeseriesDataFrame,\n    unit_level: str,\n    ur: PlainRegistry = None,\n) -&gt; TimeseriesDataFrame\n</code></pre> <p>Convert DataFrame to have a single unit by converting all units to the first unit.</p> <p>Parameters:</p> Name Type Description Default <code>df</code> <code>TimeseriesDataFrame</code> <p>DataFrame to convert to single unit</p> required <code>unit_level</code> <code>str</code> <p>Name of the index level containing units</p> required <code>ur</code> <code>PlainRegistry</code> <p>Unit registry to use for conversions (defaults to openscm-units registry)</p> <code>None</code> <p>Returns:</p> Type Description <code>TimeseriesDataFrame</code> <p>DataFrame with all data converted to the first unit found</p> <p>Raises:</p> Type Description <code>DataProcessingError</code> <p>If the DataFrame has no units</p>"},{"location":"api/utils/core/#get_default_unit_registry","title":"get_default_unit_registry","text":""},{"location":"api/utils/core/#fair_shares.library.utils.get_default_unit_registry","title":"fair_shares.library.utils.get_default_unit_registry  <code>cached</code>","text":"Python<pre><code>get_default_unit_registry() -&gt; PlainRegistry\n</code></pre> <p>Get the default unit registry to use throughout the codebase.</p> <p>This registry is configured with climate-specific units and contexts needed for fair share allocation calculations. It includes: - Magnitude units (thousand, million, billion) - Emission units (kt, Mt, CO2e, gigagram) - Annual conversion contexts - AR6GWP100 context for greenhouse gas equivalencies</p> <p>This is the standard unit registry used by default in all allocation functions and unit conversion utilities. Custom registries can be supplied directly to individual functions if needed.</p> <p>Returns:</p> Type Description <code>PlainRegistry</code> <p>Configured unit registry with climate-specific units and contexts</p> <p>Raises:</p> Type Description <code>MissingOptionalDependencyError</code> <p><code>openscm_units</code> is not installed</p>"},{"location":"api/utils/core/#index-operations","title":"Index Operations","text":""},{"location":"api/utils/core/#groupby_except_robust","title":"groupby_except_robust","text":""},{"location":"api/utils/core/#fair_shares.library.utils.groupby_except_robust","title":"fair_shares.library.utils.groupby_except_robust","text":"Python<pre><code>groupby_except_robust(\n    data: TimeseriesDataFrame | Series, group_level: str\n) -&gt; TimeseriesDataFrame | Series\n</code></pre> <p>Robust groupby that handles both MultiIndex and single-level index cases.</p> <p>For MultiIndex: uses groupby_except to group by all levels except group_level For single-level index: uses simple sum() across rows</p> <p>Parameters:</p> Name Type Description Default <code>data</code> <code>TimeseriesDataFrame | Series</code> <p>DataFrame or Series to group</p> required <code>group_level</code> <code>str</code> <p>Level name to exclude from grouping (typically \"iso3c\")</p> required <p>Returns:</p> Type Description <code>Grouped data with totals calculated appropriately for the index structure</code>"},{"location":"api/utils/core/#see-also","title":"See Also","text":"<ul> <li>Adjustments: Adjustment calculation functions</li> <li>Validation: Input validation utilities</li> </ul>"},{"location":"api/utils/data/","title":"Data Processing Utilities","text":"<p>Functions for processing and transforming input datasets.</p>"},{"location":"api/utils/data/#convergence-data-processing","title":"Convergence Data Processing","text":""},{"location":"api/utils/data/#process_emissions_data","title":"process_emissions_data","text":""},{"location":"api/utils/data/#fair_shares.library.utils.data.convergence.process_emissions_data","title":"fair_shares.library.utils.data.convergence.process_emissions_data","text":"Python<pre><code>process_emissions_data(\n    country_actual_emissions_ts: TimeseriesDataFrame,\n    first_allocation_year: int,\n    emission_category: str,\n    group_level: str,\n    unit_level: str,\n    ur: PlainRegistry,\n) -&gt; tuple[\n    DataFrame, DataFrame, dict[int, str | int | float], str\n]\n</code></pre> <p>Process country emissions data and extract initial shares.</p> <p>Parameters:</p> Name Type Description Default <code>country_actual_emissions_ts</code> <code>TimeseriesDataFrame</code> <p>Raw country emissions data.</p> required <code>first_allocation_year</code> <code>int</code> <p>Year to start allocation.</p> required <code>emission_category</code> <code>str</code> <p>Emission category to analyze.</p> required <code>group_level</code> <code>str</code> <p>Index level for grouping (e.g., 'iso3c').</p> required <code>unit_level</code> <code>str</code> <p>Index level for units.</p> required <code>ur</code> <code>PlainRegistry</code> <p>Unit registry.</p> required <p>Returns:</p> Type Description <code>tuple</code> <p>(emissions_full_numeric, emissions_countries_full, year_to_label, start_column)</p>"},{"location":"api/utils/data/#calculate_initial_shares","title":"calculate_initial_shares","text":""},{"location":"api/utils/data/#fair_shares.library.utils.data.convergence.calculate_initial_shares","title":"fair_shares.library.utils.data.convergence.calculate_initial_shares","text":"Python<pre><code>calculate_initial_shares(\n    emissions_countries_full: DataFrame,\n    start_column: str,\n    group_level: str,\n) -&gt; tuple[Series, float]\n</code></pre> <p>Calculate initial emission shares from actual emissions at start year.</p> <p>Parameters:</p> Name Type Description Default <code>emissions_countries_full</code> <code>DataFrame</code> <p>Country emissions data (World rows already filtered out).</p> required <code>start_column</code> <code>str</code> <p>Column label for first allocation year.</p> required <code>group_level</code> <code>str</code> <p>Index level for grouping.</p> required <p>Returns:</p> Type Description <code>tuple</code> <p>(country_totals, country_sum) where country_totals is Series of emissions by country and country_sum is the total.</p>"},{"location":"api/utils/data/#process_world_scenario_data","title":"process_world_scenario_data","text":""},{"location":"api/utils/data/#fair_shares.library.utils.data.convergence.process_world_scenario_data","title":"fair_shares.library.utils.data.convergence.process_world_scenario_data","text":"Python<pre><code>process_world_scenario_data(\n    world_scenario_emissions_ts: TimeseriesDataFrame,\n    first_allocation_year: int,\n    group_level: str,\n    unit_level: str,\n    ur: PlainRegistry,\n) -&gt; tuple[\n    DataFrame,\n    Series,\n    list[str],\n    dict[int, str | int | float],\n    str,\n    float,\n]\n</code></pre> <p>Process world scenario emissions and calculate year fractions.</p> <p>Parameters:</p> Name Type Description Default <code>world_scenario_emissions_ts</code> <code>TimeseriesDataFrame</code> <p>World emissions pathway.</p> required <code>first_allocation_year</code> <code>int</code> <p>Year to start allocation.</p> required <code>group_level</code> <code>str</code> <p>Index level for grouping.</p> required <code>unit_level</code> <code>str</code> <p>Index level for units.</p> required <code>ur</code> <code>PlainRegistry</code> <p>Unit registry.</p> required <p>Returns:</p> Type Description <code>tuple</code> <p>(emissions_world, year_fraction_of_cumulative_emissions, sorted_columns,  world_year_to_label, world_start_column, world_total)</p>"},{"location":"api/utils/data/#process_population_data","title":"process_population_data","text":""},{"location":"api/utils/data/#fair_shares.library.utils.data.convergence.process_population_data","title":"fair_shares.library.utils.data.convergence.process_population_data","text":"Python<pre><code>process_population_data(\n    population_ts: TimeseriesDataFrame,\n    first_allocation_year: int,\n    group_level: str,\n    unit_level: str,\n    ur: PlainRegistry,\n) -&gt; Series\n</code></pre> <p>Process population data and calculate cumulative population by group.</p> <p>Parameters:</p> Name Type Description Default <code>population_ts</code> <code>TimeseriesDataFrame</code> <p>Population time series.</p> required <code>first_allocation_year</code> <code>int</code> <p>Year to start allocation.</p> required <code>group_level</code> <code>str</code> <p>Index level for grouping.</p> required <code>unit_level</code> <code>str</code> <p>Index level for units.</p> required <code>ur</code> <code>PlainRegistry</code> <p>Unit registry.</p> required <p>Returns:</p> Type Description <code>Series</code> <p>Cumulative population by group.</p>"},{"location":"api/utils/data/#build_result_dataframe","title":"build_result_dataframe","text":""},{"location":"api/utils/data/#fair_shares.library.utils.data.convergence.build_result_dataframe","title":"fair_shares.library.utils.data.convergence.build_result_dataframe","text":"Python<pre><code>build_result_dataframe(\n    shares_by_group: DataFrame,\n    emissions_countries_index: Index,\n    world_time_columns: list[str],\n    group_level: str,\n    unit_level: str,\n) -&gt; DataFrame\n</code></pre> <p>Build final result DataFrame with proper index structure.</p> <p>Parameters:</p> Name Type Description Default <code>shares_by_group</code> <code>DataFrame</code> <p>Calculated shares indexed by group.</p> required <code>emissions_countries_index</code> <code>Index</code> <p>Original emissions index for alignment.</p> required <code>world_time_columns</code> <code>list[str]</code> <p>Year columns from world scenario.</p> required <code>group_level</code> <code>str</code> <p>Index level for grouping.</p> required <code>unit_level</code> <code>str</code> <p>Index level for units.</p> required <p>Returns:</p> Type Description <code>DataFrame</code> <p>Result DataFrame with proper multi-index structure.</p>"},{"location":"api/utils/data/#see-also","title":"See Also","text":"<ul> <li>Core Utilities: General data manipulation functions</li> <li>Math Utilities: Convergence solver and adjustments</li> </ul>"},{"location":"api/utils/math/","title":"Mathematical Utilities","text":"<p>Mathematical functions for allocation calculations.</p>"},{"location":"api/utils/math/#convergence-solver","title":"Convergence Solver","text":""},{"location":"api/utils/math/#find_minimum_convergence_speed","title":"find_minimum_convergence_speed","text":""},{"location":"api/utils/math/#fair_shares.library.utils.math.convergence.find_minimum_convergence_speed","title":"fair_shares.library.utils.math.convergence.find_minimum_convergence_speed","text":"Python<pre><code>find_minimum_convergence_speed(\n    sorted_columns: list,\n    start_column: str | int | float,\n    year_fraction_of_cumulative_emissions: Series,\n    initial_shares: Series,\n    target_cumulative_shares: Series,\n    diagnostic_params: dict | None = None,\n    strict: bool = True,\n    max_convergence_speed: float = 0.9,\n) -&gt; tuple[\n    float, Series, dict[str, float] | None, Series | None\n]\n</code></pre> <p>Find the minimum convergence_speed that produces valid target cumulative shares.</p> <p>Uses binary search between 0.001 and max_convergence_speed.</p> <p>Parameters:</p> Name Type Description Default <code>sorted_columns</code> <code>list</code> <p>Year columns in sorted order.</p> required <code>start_column</code> <code>str | int | float</code> <p>Column label for first allocation year.</p> required <code>year_fraction_of_cumulative_emissions</code> <code>Series</code> <p>Fraction of cumulative emissions in each year.</p> required <code>initial_shares</code> <code>Series</code> <p>Initial emission shares at start year.</p> required <code>target_cumulative_shares</code> <code>Series</code> <p>Target cumulative shares to achieve.</p> required <code>diagnostic_params</code> <code>dict | None</code> <p>Parameters for error messages (approach name, years, weights).</p> <code>None</code> <code>strict</code> <code>bool</code> <p>If True (default), raise AllocationError when exact targets cannot be achieved. If False, accept approximate targets and generate warnings showing deviations.</p> <code>True</code> <code>max_convergence_speed</code> <code>float</code> <p>Maximum allowed convergence speed (0 to 1.0). Default 0.9. Lower values create smoother pathways. When targets cannot be achieved within this speed, strict=False will generate warnings.</p> <code>0.9</code> <p>Returns:</p> Type Description <code>tuple[float, Series, dict[str, float] | None, Series | None]</code> <ul> <li>Convergence speed (0.001 to max_convergence_speed)</li> <li>Long-run shares</li> <li>Adjustment warnings dict: Maps iso3c -&gt; (achieved/target) ratio.   None if exact targets achieved or strict=True raised error.</li> <li>Achieved cumulative shares (may differ from targets if speed limited).   None if exact targets achieved or strict=True raised error.</li> </ul>"},{"location":"api/utils/math/#validate_convergence_speed","title":"validate_convergence_speed","text":""},{"location":"api/utils/math/#fair_shares.library.utils.math.convergence.validate_convergence_speed","title":"fair_shares.library.utils.math.convergence.validate_convergence_speed","text":"Python<pre><code>validate_convergence_speed(\n    convergence_speed: float,\n    sorted_columns: list,\n    start_column: str | int | float,\n    year_fraction_of_cumulative_emissions: Series,\n    initial_shares: Series,\n    target_cumulative_shares: Series,\n) -&gt; tuple[bool, Series | None]\n</code></pre> <p>Validate that a convergence_speed produces valid shares hitting cumulative targets.</p> <p>We need yearly shares to transition from initial_shares (yearly share for starting year) to eventually satisfy target_cumulative_shares (cumulative sum of yearly shares of emissions over all years for each country).</p> <p>So the constraint is that the cumulative sum of yearly shares of emissions over all years must equal the cumulative target shares for each country:</p> Text Only<pre><code>sum_t [year_fraction_of_cumulative_emissions(t) * yearly_share(t)]\n    = target_cumulative_shares\n</code></pre> <p>where:     - year_fraction_of_cumulative_emissions(t): fraction of total cumulative         world emissions that occur in year t for each country (sums to 1)     - yearly_share(t): each country's yearly allocation share in year t (sums to 1)     - target_cumulative_shares: cumulative target (sum of yearly shares of emissions         over all years for each country, sums to 1)</p> <p>Since we want to converge, rather than jump instantly, we model this using an exponential decay where each year's share moves toward a long_run_shares value:</p> Text Only<pre><code>yearly_share(t+1) = yearly_share(t) + speed * (long_run_shares\n    - yearly_share(t))\n</code></pre> <p>where:     - speed: convergence rate (0 = no change, 1 = instant jump)     - long_run_shares: asymptotic year share that each year converges         toward (not cumulative - this is a single asymptotic year value)     - initial_shares: yearly share for the starting year (year 0)</p> <p>By using the exponential decay convergence function we reduce the problem from N unknowns to 1 unknown (long_run_shares). We know initial_shares, convergence_speed (which determines how fast initial_shares decay as (1-speed)^t), and target_cumulative_shares. So, we can calculate how much of the cumulative target shares comes from initial_shares (w = total_initial_contribution, accounting for their decaying contribution to cumulative target shares over time). The rest (1-w) must come from long_run_shares, so we solve: long_run_shares = (target_cumulative_shares - initial_shares*w) / (1-w).</p> <p>The convergence speed is valid only if long_run_shares are all in [0, 1] (each country's share is valid). Note: if initial_shares and target_cumulative_shares both sum to 1, then long_run_shares automatically sums to 1 (mathematically guaranteed), so we only need to check individual bounds. The intuition for the [0, 1] bound is that if long_run_shares are not in [0, 1], then the speed is invalid because it would require impossible destinations (negative or &gt;100%) to compensate, which would occur over the finite time horizon we care about.</p> <p>The caller uses this function to find the minimum valid speed: the smoothest transition that still achieves cumulative targets.</p> <p>Parameters:</p> Name Type Description Default <code>convergence_speed</code> <code>float</code> <p>The convergence speed to validate (0 to 1).</p> required <code>sorted_columns</code> <code>list</code> <p>Year columns in sorted order.</p> required <code>start_column</code> <code>str | int | float</code> <p>Column label for first allocation year.</p> required <code>year_fraction_of_cumulative_emissions</code> <code>Series</code> <p>Fraction of cumulative emissions in each year (sums to 1).</p> required <code>initial_shares</code> <code>Series</code> <p>Initial emission shares at start year.</p> required <code>target_cumulative_shares</code> <code>Series</code> <p>Target cumulative shares to achieve.</p> required <p>Returns:</p> Type Description <code>tuple[bool, Series | None]</code> <p>(is_valid, long_run_shares) where: - is_valid: boolean indicating whether the speed is valid - long_run_shares: yearly share value that satisfies the cumulative constraint     where long_run_shares is not used anywhere but just reported.</p>"},{"location":"api/utils/math/#adjustment-calculations","title":"Adjustment Calculations","text":""},{"location":"api/utils/math/#calculate_responsibility_adjustment_data","title":"calculate_responsibility_adjustment_data","text":""},{"location":"api/utils/math/#fair_shares.library.utils.math.adjustments.calculate_responsibility_adjustment_data","title":"fair_shares.library.utils.math.adjustments.calculate_responsibility_adjustment_data","text":"Python<pre><code>calculate_responsibility_adjustment_data(\n    country_actual_emissions_ts: TimeseriesDataFrame,\n    population_ts: TimeseriesDataFrame,\n    historical_responsibility_year: int,\n    allocation_year: int,\n    responsibility_per_capita: bool,\n    group_level: str,\n    unit_level: str,\n    ur: PlainRegistry,\n) -&gt; Series\n</code></pre> <p>Calculate historical responsibility data for allocation.</p> <p>Returns cumulative emissions (or per capita emissions) from historical_responsibility_year up to (but not including) allocation_year.</p> <p>Responsibility window: [historical_responsibility_year, allocation_year - 1].</p> <p>This function is used by both budget and pathway allocations.</p> <p>Parameters:</p> Name Type Description Default <code>country_actual_emissions_ts</code> <code>TimeseriesDataFrame</code> <p>Historical emissions timeseries data</p> required <code>population_ts</code> <code>TimeseriesDataFrame</code> <p>Population timeseries data</p> required <code>historical_responsibility_year</code> <code>int</code> <p>Start year of responsibility window (inclusive)</p> required <code>allocation_year</code> <code>int</code> <p>End year of responsibility window (exclusive). For budgets: the allocation year itself. For pathways: the first allocation year.</p> required <code>responsibility_per_capita</code> <code>bool</code> <p>If True, divide cumulative emissions by cumulative population</p> required <code>group_level</code> <code>str</code> <p>Index level name for country/region grouping</p> required <code>unit_level</code> <code>str</code> <p>Index level name for units</p> required <code>ur</code> <code>PlainRegistry</code> <p>Pint unit registry</p> required <p>Returns:</p> Type Description <code>Series</code> <p>Historical responsibility metric by country/region. Units: emissions (or emissions per capita) depending on responsibility_per_capita.</p> <p>Raises:</p> Type Description <code>AllocationError</code> <p>If no years found in responsibility window, no country data found, zero population encountered (when per capita), or responsibility sums to non-positive.</p> See Also <p>docs/science/allocations.md : Theoretical basis for historical responsibility</p>"},{"location":"api/utils/math/#calculate_capability_adjustment_data","title":"calculate_capability_adjustment_data","text":""},{"location":"api/utils/math/#fair_shares.library.utils.math.adjustments.calculate_capability_adjustment_data","title":"fair_shares.library.utils.math.adjustments.calculate_capability_adjustment_data","text":"Python<pre><code>calculate_capability_adjustment_data(\n    population_ts: TimeseriesDataFrame,\n    gdp_ts: TimeseriesDataFrame,\n    first_allocation_year: int,\n    capability_per_capita: bool,\n    group_level: str,\n    unit_level: str,\n    ur: PlainRegistry,\n    gini_s: DataFrame | None = None,\n    income_floor: float = 0.0,\n    max_gini_adjustment: float = 0.8,\n) -&gt; Series\n</code></pre> <p>Calculate capability data (cumulative GDP or GDP per capita).</p> <p>Returns the raw capability data, NOT an adjustment factor. The caller applies the inverse to reduce allocations for higher capability.</p> <p>Capability window: from first_allocation_year onwards.</p> <p>Parameters:</p> Name Type Description Default <code>population_ts</code> <code>TimeseriesDataFrame</code> <p>Population timeseries data</p> required <code>gdp_ts</code> <code>TimeseriesDataFrame</code> <p>GDP timeseries data</p> required <code>first_allocation_year</code> <code>int</code> <p>First year of capability window</p> required <code>capability_per_capita</code> <code>bool</code> <p>If True, divide cumulative GDP by cumulative population</p> required <code>group_level</code> <code>str</code> <p>Index level name for country/region grouping</p> required <code>unit_level</code> <code>str</code> <p>Index level name for units</p> required <code>ur</code> <code>PlainRegistry</code> <p>Pint unit registry</p> required <code>gini_s</code> <code>DataFrame | None</code> <p>Optional Gini coefficient data for inequality adjustment. When provided, GDP is adjusted to reflect income distribution.</p> <code>None</code> <code>income_floor</code> <code>float</code> <p>Income floor for Gini adjustment (in GDP units). Default: 0.0</p> <code>0.0</code> <code>max_gini_adjustment</code> <code>float</code> <p>Maximum reduction factor from Gini adjustment (0-1). Default: 0.8</p> <code>0.8</code> <p>Returns:</p> Type Description <code>Series</code> <p>Capability metric by country/region (cumulative GDP or GDP per capita).</p> <p>Raises:</p> Type Description <code>AllocationError</code> <p>If no common years between population and GDP, or capability sums to non-positive.</p> See Also <p>calculate_responsibility_adjustment_data_convergence : For responsibility adjustments docs/science/allocations.md : Theoretical basis for capability adjustment</p>"},{"location":"api/utils/math/#see-also","title":"See Also","text":"<ul> <li>Data Utilities: Data processing for convergence</li> <li>Convergence Validation: Convergence validation</li> </ul>"},{"location":"api/utils/validation/","title":"Validation Utilities","text":"<p>Pydantic validation models and utility functions for ensuring data integrity.</p>"},{"location":"api/utils/validation/#validation-models","title":"Validation Models","text":""},{"location":"api/utils/validation/#allocationinputs","title":"AllocationInputs","text":""},{"location":"api/utils/validation/#fair_shares.library.validation.models.AllocationInputs","title":"fair_shares.library.validation.models.AllocationInputs","text":"<p>               Bases: <code>BaseModel</code></p> <p>Validates all input data before allocation runs.</p> <p>This model encapsulates input validation that was previously scattered across decorators and function bodies. It validates:</p> <ul> <li>Data structure (index, columns)</li> <li>Value constraints (positive values, Gini in [0,1])</li> <li>Year coverage (required years exist)</li> <li>Data completeness (no nulls in required fields)</li> </ul> <p>Examples:</p> Python Console Session<pre><code>&gt;&gt;&gt; inputs = AllocationInputs(\n...     population_ts=pop_df,\n...     gdp_ts=gdp_df,\n...     first_allocation_year=2020,\n... )\n&gt;&gt;&gt; # Validation runs automatically on model creation\n&gt;&gt;&gt; # Will raise ValidationError if data is invalid\n</code></pre>"},{"location":"api/utils/validation/#fair_shares.library.validation.models.AllocationInputs.validate_population","title":"validate_population  <code>classmethod</code>","text":"Python<pre><code>validate_population(\n    v: TimeseriesDataFrame,\n) -&gt; TimeseriesDataFrame\n</code></pre> <p>Validate population data structure and values.</p>"},{"location":"api/utils/validation/#fair_shares.library.validation.models.AllocationInputs.validate_gdp","title":"validate_gdp  <code>classmethod</code>","text":"Python<pre><code>validate_gdp(\n    v: TimeseriesDataFrame | None,\n) -&gt; TimeseriesDataFrame | None\n</code></pre> <p>Validate GDP data structure and values (if provided).</p>"},{"location":"api/utils/validation/#fair_shares.library.validation.models.AllocationInputs.validate_gini","title":"validate_gini  <code>classmethod</code>","text":"Python<pre><code>validate_gini(v: DataFrame | None) -&gt; DataFrame | None\n</code></pre> <p>Validate Gini data structure and range (if provided).</p>"},{"location":"api/utils/validation/#fair_shares.library.validation.models.AllocationInputs.validate_country_emissions","title":"validate_country_emissions  <code>classmethod</code>","text":"Python<pre><code>validate_country_emissions(\n    v: TimeseriesDataFrame | None,\n) -&gt; TimeseriesDataFrame | None\n</code></pre> <p>Validate country emissions data structure and columns (if provided).</p>"},{"location":"api/utils/validation/#fair_shares.library.validation.models.AllocationInputs.validate_world_emissions","title":"validate_world_emissions  <code>classmethod</code>","text":"Python<pre><code>validate_world_emissions(\n    v: TimeseriesDataFrame | None,\n) -&gt; TimeseriesDataFrame | None\n</code></pre> <p>Validate world scenario emissions has MultiIndex with 'unit' (if provided).</p>"},{"location":"api/utils/validation/#fair_shares.library.validation.models.AllocationInputs.validate_year_coverage","title":"validate_year_coverage","text":"Python<pre><code>validate_year_coverage() -&gt; AllocationInputs\n</code></pre> <p>Ensure required years exist in all provided data.</p> <p>All datasets must cover the allocation period from first_allocation_year to last_allocation_year.</p>"},{"location":"api/utils/validation/#fair_shares.library.validation.models.AllocationInputs.validate_gini_year_in_bounds","title":"validate_gini_year_in_bounds","text":"Python<pre><code>validate_gini_year_in_bounds() -&gt; AllocationInputs\n</code></pre> <p>Validate that Gini reference year is reasonable.</p> <p>Gini data is typically only available for recent historical periods.</p>"},{"location":"api/utils/validation/#allocationoutputs","title":"AllocationOutputs","text":""},{"location":"api/utils/validation/#fair_shares.library.validation.models.AllocationOutputs","title":"fair_shares.library.validation.models.AllocationOutputs","text":"<p>               Bases: <code>BaseModel</code></p> <p>Validates allocation output data after allocation runs.</p> <p>This model ensures allocation outputs are mathematically valid and complete:</p> <ul> <li>Shares sum to 1.0 for each year (within numerical tolerance)</li> <li>No null values in shares (unless expected post-net-zero)</li> <li>Data structure is consistent with input requirements</li> </ul> <p>Examples:</p> Python Console Session<pre><code>&gt;&gt;&gt; outputs = AllocationOutputs(\n...     shares=shares_df,\n...     dataset_name=\"Equal Per Capita Shares\",\n... )\n&gt;&gt;&gt; # Validation runs automatically on model creation\n&gt;&gt;&gt; # Will raise ValidationError if shares invalid\n</code></pre> Python Console Session<pre><code>&gt;&gt;&gt; # Allow post-net-zero NaN values\n&gt;&gt;&gt; outputs = AllocationOutputs(\n...     shares=shares_df,\n...     dataset_name=\"Pathway Shares\",\n...     first_year=2020,\n...     reference_data=world_pathway_df,  # NaN pattern template\n... )\n</code></pre>"},{"location":"api/utils/validation/#fair_shares.library.validation.models.AllocationOutputs.validate_shares_sum","title":"validate_shares_sum","text":"Python<pre><code>validate_shares_sum() -&gt; AllocationOutputs\n</code></pre> <p>Validate that shares sum to 1.0 for each year.</p> <p>Uses the tolerance parameter for floating point comparison. Years containing NaN values are skipped (e.g., post-net-zero periods).</p>"},{"location":"api/utils/validation/#fair_shares.library.validation.models.AllocationOutputs.validate_no_unexpected_nulls","title":"validate_no_unexpected_nulls","text":"Python<pre><code>validate_no_unexpected_nulls() -&gt; AllocationOutputs\n</code></pre> <p>Validate that there are no unexpected null values in shares.</p> <p>If reference_data is provided, NaN values in shares are allowed if they match the NaN pattern in reference_data (e.g., for post-net-zero pathway years where global emissions are zero).</p>"},{"location":"api/utils/validation/#see-also","title":"See Also","text":"<ul> <li>Budget Allocations: Functions that use validation</li> <li>Pathway Allocations: Functions that use validation</li> </ul>"},{"location":"api/validation/convergence/","title":"Convergence Validation","text":"<p>Validation functions specific to convergence pathway allocations.</p>"},{"location":"api/validation/convergence/#weight-validation","title":"Weight Validation","text":""},{"location":"api/validation/convergence/#validate_weights","title":"validate_weights","text":""},{"location":"api/validation/convergence/#fair_shares.library.validation.convergence.validate_weights","title":"fair_shares.library.validation.convergence.validate_weights","text":"Python<pre><code>validate_weights(\n    responsibility_weight: float, capability_weight: float\n) -&gt; None\n</code></pre> <p>Validate that adjustment weights are non-negative and sum to &lt;= 1.0.</p> <p>Parameters:</p> Name Type Description Default <code>responsibility_weight</code> <code>float</code> <p>Weight for responsibility adjustment (historical emissions).</p> required <code>capability_weight</code> <code>float</code> <p>Weight for capability adjustment (GDP-based).</p> required <p>Raises:</p> Type Description <code>AllocationError</code> <p>If weights are negative or sum exceeds 1.0.</p>"},{"location":"api/validation/convergence/#validate_adjustment_data_requirements","title":"validate_adjustment_data_requirements","text":""},{"location":"api/validation/convergence/#fair_shares.library.validation.convergence.validate_adjustment_data_requirements","title":"fair_shares.library.validation.convergence.validate_adjustment_data_requirements","text":"Python<pre><code>validate_adjustment_data_requirements(\n    capability_weight: float,\n    gdp_ts: TimeseriesDataFrame | None,\n    gini_s: DataFrame | None,\n) -&gt; None\n</code></pre> <p>Validate that required data is provided when adjustment weights are used.</p> <p>Parameters:</p> Name Type Description Default <code>capability_weight</code> <code>float</code> <p>Weight for capability adjustment.</p> required <code>gdp_ts</code> <code>TimeseriesDataFrame | None</code> <p>GDP data (required if capability_weight &gt; 0 or gini_s provided).</p> required <code>gini_s</code> <code>DataFrame | None</code> <p>Gini coefficient data (requires gdp_ts if provided).</p> required <p>Raises:</p> Type Description <code>AllocationError</code> <p>If required data is missing for requested adjustments.</p>"},{"location":"api/validation/convergence/#data-validation","title":"Data Validation","text":""},{"location":"api/validation/convergence/#validate_emissions_data","title":"validate_emissions_data","text":""},{"location":"api/validation/convergence/#fair_shares.library.validation.convergence.validate_emissions_data","title":"fair_shares.library.validation.convergence.validate_emissions_data","text":"Python<pre><code>validate_emissions_data(\n    emissions_numeric: DataFrame,\n    emission_category: str,\n    group_level: str,\n) -&gt; None\n</code></pre> <p>Validate emissions data structure and content.</p> <p>Parameters:</p> Name Type Description Default <code>emissions_numeric</code> <code>DataFrame</code> <p>Emissions data after unit processing.</p> required <code>emission_category</code> <code>str</code> <p>The emission category being analyzed.</p> required <code>group_level</code> <code>str</code> <p>Index level for country grouping (e.g., 'iso3c').</p> required <p>Raises:</p> Type Description <code>AllocationError</code> <p>If emissions data is empty, missing required index, or contains no countries.</p>"},{"location":"api/validation/convergence/#validate_country_data_present","title":"validate_country_data_present","text":""},{"location":"api/validation/convergence/#fair_shares.library.validation.convergence.validate_country_data_present","title":"fair_shares.library.validation.convergence.validate_country_data_present","text":"Python<pre><code>validate_country_data_present(\n    emissions_countries: DataFrame, group_level: str\n) -&gt; None\n</code></pre> <p>Validate that emissions data contains country-level data, not just World totals.</p> <p>Parameters:</p> Name Type Description Default <code>emissions_countries</code> <code>DataFrame</code> <p>Emissions data after filtering out World rows.</p> required <code>group_level</code> <code>str</code> <p>Index level for country grouping (e.g., 'iso3c').</p> required <p>Raises:</p> Type Description <code>AllocationError</code> <p>If no country data is found (only World totals present).</p>"},{"location":"api/validation/convergence/#validate_year_in_data","title":"validate_year_in_data","text":""},{"location":"api/validation/convergence/#fair_shares.library.validation.convergence.validate_year_in_data","title":"fair_shares.library.validation.convergence.validate_year_in_data","text":"Python<pre><code>validate_year_in_data(\n    year: int,\n    year_to_label: dict[int, str | int | float],\n    dataset_name: str,\n    available_columns: list[str],\n) -&gt; None\n</code></pre> <p>Validate that a required year is present in the dataset.</p> <p>Parameters:</p> Name Type Description Default <code>year</code> <code>int</code> <p>Required year.</p> required <code>year_to_label</code> <code>dict[int, str | int | float]</code> <p>Mapping from integer years to column labels.</p> required <code>dataset_name</code> <code>str</code> <p>Name of dataset for error message (e.g., \"country emissions\").</p> required <code>available_columns</code> <code>list[str]</code> <p>Available column labels in dataset.</p> required <p>Raises:</p> Type Description <code>AllocationError</code> <p>If the required year is not found in the dataset.</p>"},{"location":"api/validation/convergence/#validate_world_emissions_present","title":"validate_world_emissions_present","text":""},{"location":"api/validation/convergence/#fair_shares.library.validation.convergence.validate_world_emissions_present","title":"fair_shares.library.validation.convergence.validate_world_emissions_present","text":"Python<pre><code>validate_world_emissions_present(\n    world_numeric: DataFrame,\n) -&gt; None\n</code></pre> <p>Validate that world scenario emissions data is not empty.</p> <p>Parameters:</p> Name Type Description Default <code>world_numeric</code> <code>DataFrame</code> <p>World scenario emissions after processing.</p> required <p>Raises:</p> Type Description <code>AllocationError</code> <p>If world emissions data is empty.</p>"},{"location":"api/validation/convergence/#validate_country_world_consistency","title":"validate_country_world_consistency","text":""},{"location":"api/validation/convergence/#fair_shares.library.validation.convergence.validate_country_world_consistency","title":"fair_shares.library.validation.convergence.validate_country_world_consistency","text":"Python<pre><code>validate_country_world_consistency(\n    country_sum: float,\n    world_total: float,\n    first_allocation_year: int,\n    tolerance: float = 1e-06,\n) -&gt; None\n</code></pre> <p>Validate that country emissions sum to world total at allocation start year.</p> <p>Parameters:</p> Name Type Description Default <code>country_sum</code> <code>float</code> <p>Sum of all country emissions at start year.</p> required <code>world_total</code> <code>float</code> <p>World total emissions at start year.</p> required <code>first_allocation_year</code> <code>int</code> <p>Year when allocation begins.</p> required <code>tolerance</code> <code>float</code> <p>Absolute tolerance for comparison (default: 1e-6).</p> <code>1e-06</code> <p>Raises:</p> Type Description <code>AllocationError</code> <p>If country and world totals don't match within tolerance.</p>"},{"location":"api/validation/convergence/#convergence-calculation-validation","title":"Convergence Calculation Validation","text":""},{"location":"api/validation/convergence/#validate_sufficient_time_horizon","title":"validate_sufficient_time_horizon","text":""},{"location":"api/validation/convergence/#fair_shares.library.validation.convergence.validate_sufficient_time_horizon","title":"fair_shares.library.validation.convergence.validate_sufficient_time_horizon","text":"Python<pre><code>validate_sufficient_time_horizon(\n    sorted_columns: list[str],\n    start_column: str,\n    first_allocation_year: int,\n) -&gt; None\n</code></pre> <p>Validate that there are enough years after start for convergence.</p> <p>Parameters:</p> Name Type Description Default <code>sorted_columns</code> <code>list[str]</code> <p>Sorted list of year column labels.</p> required <code>start_column</code> <code>str</code> <p>Column label for first allocation year.</p> required <code>first_allocation_year</code> <code>int</code> <p>Year when allocation begins.</p> required <p>Raises:</p> Type Description <code>AllocationError</code> <p>If no years exist after the first allocation year.</p>"},{"location":"api/validation/convergence/#validate_share_calculation","title":"validate_share_calculation","text":""},{"location":"api/validation/convergence/#fair_shares.library.validation.convergence.validate_share_calculation","title":"fair_shares.library.validation.convergence.validate_share_calculation","text":"Python<pre><code>validate_share_calculation(\n    shares: Series | DataFrame, step_description: str\n) -&gt; None\n</code></pre> <p>Validate that calculated shares are valid (not NaN, positive sum).</p> <p>Parameters:</p> Name Type Description Default <code>shares</code> <code>Series | DataFrame</code> <p>Calculated shares to validate.</p> required <code>step_description</code> <code>str</code> <p>Description of calculation step for error message.</p> required <p>Raises:</p> Type Description <code>AllocationError</code> <p>If shares contain NaN or sum to invalid total.</p>"},{"location":"api/validation/convergence/#validate_world_weights_aligned","title":"validate_world_weights_aligned","text":""},{"location":"api/validation/convergence/#fair_shares.library.validation.convergence.validate_world_weights_aligned","title":"fair_shares.library.validation.convergence.validate_world_weights_aligned","text":"Python<pre><code>validate_world_weights_aligned(\n    year_fractions: Series, required_columns: Index\n) -&gt; None\n</code></pre> <p>Validate that world weight fractions are available for all required years.</p> <p>Parameters:</p> Name Type Description Default <code>year_fractions</code> <code>Series</code> <p>Year-based weight fractions (reindexed to required_columns).</p> required <code>required_columns</code> <code>Index</code> <p>Required year columns.</p> required <p>Raises:</p> Type Description <code>AllocationError</code> <p>If any required years are missing from world weights.</p>"},{"location":"api/validation/convergence/#see-also","title":"See Also","text":"<ul> <li>Math Utilities: Convergence solver</li> <li>Data Utilities: Data processing</li> </ul>"},{"location":"dev-guide/","title":"Developer Guide","text":"<p>This guide explains the fair-shares architecture and how to extend the library.</p>"},{"location":"dev-guide/#architecture-overview","title":"Architecture Overview","text":"<pre><code>graph TB\n    subgraph Input\n        DS[Data Sources&lt;br/&gt;conf/data_sources/]\n        RAW[Raw Data&lt;br/&gt;data/]\n    end\n\n    subgraph Pipeline\n        PP[Preprocessing&lt;br/&gt;notebooks/1xx]\n        SM[Snakemake&lt;br/&gt;workflow/]\n    end\n\n    subgraph Library\n        AL[Allocations&lt;br/&gt;allocations/]\n        UT[Utilities&lt;br/&gt;utils/]\n        CF[Config&lt;br/&gt;config/]\n    end\n\n    subgraph Output\n        RES[Results&lt;br/&gt;output/]\n    end\n\n    DS --&gt; PP\n    RAW --&gt; PP\n    PP --&gt; SM\n    SM --&gt; AL\n    AL --&gt; RES\n    UT --&gt; AL\n    CF --&gt; AL</code></pre>"},{"location":"dev-guide/#key-modules","title":"Key Modules","text":"Module Location Responsibility Allocations <code>src/fair_shares/library/allocations/</code> Core allocation functions Utilities <code>src/fair_shares/library/utils/</code> Data manipulation, adjustments Config <code>src/fair_shares/library/config/</code> Pydantic models Preprocessing <code>notebooks/1xx_*.py</code> Data pipeline notebooks"},{"location":"dev-guide/#allocations-module","title":"Allocations Module","text":""},{"location":"dev-guide/#structure","title":"Structure","text":"Text Only<pre><code>allocations/\n\u251c\u2500\u2500 __init__.py\n\u251c\u2500\u2500 budgets/\n\u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u2514\u2500\u2500 per_capita.py      # Budget allocation functions\n\u251c\u2500\u2500 pathways/\n\u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u251c\u2500\u2500 per_capita.py      # Pathway allocation functions\n\u2502   \u251c\u2500\u2500 per_capita_convergence.py\n\u2502   \u2514\u2500\u2500 cumulative_per_capita_convergence.py\n\u251c\u2500\u2500 results/               # Result dataclasses\n\u251c\u2500\u2500 core.py               # Shared logic\n\u251c\u2500\u2500 manager.py            # AllocationManager\n\u2514\u2500\u2500 registry.py           # Approach name \u2192 function mapping\n</code></pre>"},{"location":"dev-guide/#entry-points","title":"Entry Points","text":"<p>Direct function calls:</p> Python<pre><code>from fair_shares.library.allocations.budgets import equal_per_capita_budget\n\nresult = equal_per_capita_budget(\n    population_ts=population_df,\n    allocation_year=2020,\n    emission_category=\"co2-ffi\",\n)\n</code></pre> <p>AllocationManager (high-level):</p> Python<pre><code>from fair_shares.library.allocations import AllocationManager\n\nmanager = AllocationManager()\nresults = manager.run_parameter_grid(\n    allocations_config=config,\n    population_ts=population_df,\n    # ...\n)\n</code></pre>"},{"location":"dev-guide/#result-types","title":"Result Types","text":"Type Module Description <code>BudgetAllocationResult</code> <code>allocations.results</code> Single cumulative allocation <code>PathwayAllocationResult</code> <code>allocations.results</code> Time-varying annual allocations <p><code>BudgetAllocationResult</code> contains <code>relative_shares_cumulative_emission</code>; <code>PathwayAllocationResult</code> contains <code>relative_shares_pathway_emissions</code>. Both sum to 1.0 and provide methods to compute absolute emissions.</p>"},{"location":"dev-guide/#adding-new-functionality","title":"Adding New Functionality","text":"<ul> <li>Adding Allocation Approaches - New equity principles</li> <li>Adding Data Sources - New datasets</li> </ul>"},{"location":"dev-guide/#conventions","title":"Conventions","text":""},{"location":"dev-guide/#year-columns-as-strings","title":"Year Columns as Strings","text":"<p>Critical: Year columns must be strings, not integers.</p> Python<pre><code># Correct\ndf[\"2020\"]\n\n# Incorrect\ndf[2020]\n</code></pre> <p>Always call <code>ensure_string_year_columns(df)</code> after loading data.</p>"},{"location":"dev-guide/#kebab-vs-snake-case","title":"Kebab vs Snake Case","text":"Context Style Example Config/approach names kebab-case <code>equal-per-capita-budget</code> Python identifiers snake_case <code>equal_per_capita_budget</code>"},{"location":"dev-guide/#index-structure","title":"Index Structure","text":"<p>DataFrames use MultiIndex with standard levels:</p> Data Type Index Levels Emissions <code>iso3c</code>, <code>unit</code>, <code>emission-category</code> GDP/Population <code>iso3c</code>, <code>unit</code> Gini <code>iso3c</code>, <code>unit</code>"},{"location":"dev-guide/#testing","title":"Testing","text":"Bash<pre><code># Run all tests\nuv run pytest tests/\n\n# Run specific test module\nuv run pytest tests/unit/allocations/\n\n# Run with coverage\nuv run pytest --cov=fair_shares tests/\n</code></pre>"},{"location":"dev-guide/#code-quality","title":"Code Quality","text":"Bash<pre><code># Lint\nuv run ruff check src/ tests/\n\n# Format\nuv run ruff format src/ tests/\n</code></pre>"},{"location":"dev-guide/#documentation-workflow","title":"Documentation Workflow","text":""},{"location":"dev-guide/#checking-documentation-consistency","title":"Checking Documentation Consistency","text":"<p>Use <code>tools/docs-sync-check.py</code> to validate documentation is in sync with code:</p> Bash<pre><code># Run all validation checks\nuv run python tools/docs-sync-check.py\n\n# Suppress warnings (only show errors)\nuv run python tools/docs-sync-check.py --quiet\n\n# Show progress for each check\nuv run python tools/docs-sync-check.py --verbose\n</code></pre> <p>What it checks:</p> Check Purpose Registry coverage All approaches in <code>registry.py</code> have API docs and catalog entries Example syntax Python code blocks in docs parse without syntax errors Parameter consistency Parameters in code match those documented in <code>allocations.md</code> Cross-references Internal markdown links resolve to existing files and anchors <p>Exit codes:</p> <ul> <li><code>0</code> - No errors (warnings may be present)</li> <li><code>1</code> - One or more errors found</li> <li><code>2</code> - Invalid command-line arguments</li> </ul> <p>Best practices:</p> <ul> <li>Run before committing documentation changes</li> <li>Address errors immediately (broken links, invalid syntax)</li> <li>Review warnings to identify documentation gaps</li> </ul> <p>False positives: The script automatically skips:</p> <ul> <li>Documentation examples with GOOD/BAD or CORRECT/WRONG markers (intentionally incomplete)</li> <li>Docstring section examples (showing docstring structure)</li> <li>DataFrame representations and tabular data</li> <li>Code blocks with ellipsis (<code>...</code>) or <code>TODO</code> comments</li> </ul>"},{"location":"dev-guide/#see-also","title":"See Also","text":"<ul> <li>API Reference - Function documentation</li> <li>Scientific Documentation - Theoretical foundations</li> </ul>"},{"location":"dev-guide/adding-approaches/","title":"Adding Allocation Approaches","text":"<p>This guide explains how to add new allocation approaches to fair-shares.</p>"},{"location":"dev-guide/adding-approaches/#overview","title":"Overview","text":"<p>Allocation approaches live in two directories:</p> Type Location Output Budget <code>allocations/budgets/</code> Single cumulative allocation Pathway <code>allocations/pathways/</code> Time-varying annual allocations <p>Each approach is registered in <code>allocations/registry.py</code>.</p> <p>Essential Resources:</p> <ul> <li>Docstring Template - Required structure for all allocation approach docstrings</li> <li>Testing Checklist - Pre-merge validation checklist for new approaches</li> </ul>"},{"location":"dev-guide/adding-approaches/#before-you-begin-the-principles-first-requirement","title":"Before You Begin: The Principles-First Requirement","text":"<p>Every allocation approach in fair-shares operationalizes specific equity principles. Before writing code, you must be able to answer:</p> <ol> <li> <p>What equity principle(s) does this approach implement?    (e.g., equal rights to atmosphere, CBDR-RC, capability, subsistence protection)</p> </li> <li> <p>What value judgments are embedded in the approach?    (e.g., start date for historical responsibility, income thresholds)</p> </li> <li> <p>How does it relate to existing approaches?    (Is it a variant? A new principle? A combination?)</p> </li> </ol> <p>If you cannot answer these questions, read Principle-to-Code Workflow before proceeding.</p> <p>Why Equity Grounding Matters</p> <p>This is not optional. Allocation approaches without clear principled foundations cannot be properly documented, tested, or explained to users.</p> <p>Climate equity is inherently normative \u2014 every allocation approach embeds value judgments about fairness, responsibility, and capability. Without explicit grounding in equity principles:</p> <ul> <li>Users cannot make informed choices \u2014 They need to understand what values each approach represents</li> <li>Documentation becomes incomplete \u2014 The Docstring Template requires citing academic sources and explaining normative choices</li> <li>Testing becomes arbitrary \u2014 How do you validate behavior without knowing what the approach should do?</li> <li>Maintenance becomes impossible \u2014 Future contributors cannot understand intent or make principled modifications</li> </ul> <p>The fair-shares project exists to operationalize climate equity principles transparently. Approaches that hide their value judgments undermine this core mission.</p>"},{"location":"dev-guide/adding-approaches/#contribution-workflow","title":"Contribution Workflow","text":"<p>Follow this workflow when adding a new allocation approach:</p> <pre><code>flowchart TD\n    A[Identify Principles] --&gt; B[Design Approach]\n    B --&gt; C[Write Docstring FIRST]\n    C --&gt; D[Implement Function]\n    D --&gt; E[Add Tests]\n    E --&gt; F[Register in Registry]\n    F --&gt; G[Document in Science Docs]\n\n    C --&gt; C1{Docstring Complete?}\n    C1 --&gt;|No| C2[Add: Equity Grounding&lt;br/&gt;Mathematical Foundation&lt;br/&gt;Parameter Effects&lt;br/&gt;Examples]\n    C2 --&gt; C\n    C1 --&gt;|Yes| D\n\n    E --&gt; E1{Tests Pass?}\n    E1 --&gt;|No| E2[Fix Implementation]\n    E2 --&gt; E\n    E1 --&gt;|Yes| F\n\n    style C fill:#ffeb3b\n    style C1 fill:#fff59d\n    style C2 fill:#fff59d</code></pre> <p>Key principles:</p> <ol> <li>Docstring before implementation - Writing the docstring first forces you to clarify the equity grounding, mathematical foundation, and parameter effects before coding</li> <li>Tests validate behavior - Tests should verify both correctness and that parameters have expected effects</li> <li>Registration makes it discoverable - Until registered, the approach cannot be used via the high-level API</li> </ol>"},{"location":"dev-guide/adding-approaches/#step-1-understand-the-pattern","title":"Step 1: Understand the Pattern","text":""},{"location":"dev-guide/adding-approaches/#function-signature","title":"Function Signature","text":"<p>All allocation functions follow a consistent pattern:</p> Python<pre><code>def my_new_budget(\n    # Required data\n    population_ts: TimeseriesDataFrame,\n    allocation_year: int,\n    emission_category: str,\n    # Optional data (for adjustments)\n    country_actual_emissions_ts: TimeseriesDataFrame | None = None,\n    gdp_ts: TimeseriesDataFrame | None = None,\n    # Parameters specific to this approach\n    my_parameter: float = 0.5,\n    # Common parameters\n    group_level: str = \"iso3c\",\n    unit_level: str = \"unit\",\n) -&gt; BudgetAllocationResult:\n    \"\"\"Docstring with academic context.\"\"\"\n    ...\n</code></pre>"},{"location":"dev-guide/adding-approaches/#required-return-type","title":"Required Return Type","text":"<ul> <li>Budget approaches: <code>BudgetAllocationResult</code></li> <li>Pathway approaches: <code>PathwayAllocationResult</code></li> </ul> <p>Both are dataclasses in <code>allocations/results/</code>.</p>"},{"location":"dev-guide/adding-approaches/#step-2-implement-the-function","title":"Step 2: Implement the Function","text":""},{"location":"dev-guide/adding-approaches/#budget-example","title":"Budget Example","text":"<p>Create a new file or add to existing module in <code>allocations/budgets/</code>:</p> Python<pre><code>\"\"\"My new allocation approach.\"\"\"\n\nfrom fair_shares.library.allocations.results import BudgetAllocationResult\nfrom fair_shares.library.validation.models import AllocationInputs, AllocationOutputs\n\n\ndef my_new_budget(\n    population_ts,\n    allocation_year: int,\n    emission_category: str,\n    my_parameter: float = 0.5,\n    group_level: str = \"iso3c\",\n    unit_level: str = \"unit\",\n) -&gt; BudgetAllocationResult:\n    \"\"\"\n    Allocate budget using my new approach.\n\n    This approach does X based on principle Y from Author (Year).\n\n    Parameters\n    ----------\n    population_ts : TimeseriesDataFrame\n        Population data with MultiIndex (iso3c, unit)\n    allocation_year : int\n        Year when allocation begins\n    emission_category : str\n        Emission category being allocated\n    my_parameter : float, default 0.5\n        Controls strength of adjustment\n\n    Returns\n    -------\n    BudgetAllocationResult\n        Contains relative_shares_cumulative_emission\n\n    See Also\n    --------\n    docs/science/allocations.md : Theoretical grounding\n    \"\"\"\n    # Validate inputs\n    AllocationInputs(\n        population_ts=population_ts,\n        first_allocation_year=allocation_year,\n        last_allocation_year=allocation_year,\n    )\n\n    # Calculate shares (must sum to 1)\n    # ... your implementation ...\n\n    relative_shares = calculate_shares(population_ts, allocation_year, my_parameter)\n\n    # Validate outputs\n    AllocationOutputs(\n        shares=relative_shares,\n        dataset_name=\"my-new-budget allocation\",\n    )\n\n    # Return result\n    return BudgetAllocationResult(\n        approach=\"my-new-budget\",\n        relative_shares_cumulative_emission=relative_shares,\n        parameters={\n            \"allocation_year\": allocation_year,\n            \"my_parameter\": my_parameter,\n        },\n    )\n</code></pre>"},{"location":"dev-guide/adding-approaches/#key-implementation-details","title":"Key Implementation Details","text":"<ol> <li>Validate inputs using <code>AllocationInputs</code> Pydantic model</li> <li>Shares must sum to 1 for each group (e.g., climate-assessment, quantile)</li> <li>Validate outputs using <code>AllocationOutputs</code> model</li> <li>Document thoroughly with academic citations (see Docstring Template for required structure)</li> </ol>"},{"location":"dev-guide/adding-approaches/#step-3-export-the-function","title":"Step 3: Export the Function","text":"<p>Add to the module's <code>__init__.py</code>:</p> Python<pre><code># allocations/budgets/__init__.py\nfrom fair_shares.library.allocations.budgets.my_module import my_new_budget\n\n__all__ = [\n    \"equal_per_capita_budget\",\n    \"per_capita_adjusted_budget\",\n    \"per_capita_adjusted_gini_budget\",\n    \"my_new_budget\",  # Add here\n]\n</code></pre>"},{"location":"dev-guide/adding-approaches/#step-4-register-the-approach","title":"Step 4: Register the Approach","text":"<p>Add to <code>allocations/registry.py</code>:</p> Python<pre><code>from fair_shares.library.allocations.budgets import (\n    # ... existing imports ...\n    my_new_budget,\n)\n\ndef get_allocation_functions() -&gt; dict[str, Callable[..., Any]]:\n    return {\n        # ... existing approaches ...\n        \"my-new-budget\": my_new_budget,\n    }\n</code></pre>"},{"location":"dev-guide/adding-approaches/#step-5-add-tests","title":"Step 5: Add Tests","text":"<p>Create tests in <code>tests/unit/allocations/</code>:</p> Python<pre><code>from fair_shares.library.utils import create_example_data\n\n\ndef test_my_new_budget_basic():\n    \"\"\"Test basic functionality.\"\"\"\n    data = create_example_data()\n    result = my_new_budget(\n        population_ts=data[\"population\"],\n        allocation_year=2020,\n        emission_category=\"co2-ffi\",\n    )\n\n    # Shares sum to 1\n    shares = result.relative_shares_cumulative_emission[\"2020\"]\n    assert abs(shares.sum() - 1.0) &lt; 1e-10\n\n    # Result type\n    assert result.approach == \"my-new-budget\"\n\n\ndef test_my_new_budget_parameter_effect():\n    \"\"\"Test that parameter has expected effect.\"\"\"\n    data = create_example_data()\n    result_low = my_new_budget(\n        population_ts=data[\"population\"],\n        allocation_year=2020,\n        emission_category=\"co2-ffi\",\n        my_parameter=0.0,\n    )\n    result_high = my_new_budget(\n        population_ts=data[\"population\"],\n        allocation_year=2020,\n        emission_category=\"co2-ffi\",\n        my_parameter=1.0,\n    )\n\n    # Verify parameter affects results as expected\n    assert result_low.approach == \"my-new-budget\"\n    assert result_high.approach == \"my-new-budget\"\n</code></pre> <p>Before merging, complete all validation steps in the Testing Checklist.</p>"},{"location":"dev-guide/adding-approaches/#step-6-document","title":"Step 6: Document","text":"<ol> <li>Docstring - Follow the comprehensive structure in Docstring Template</li> <li>Include Mathematical Foundation with LaTeX equations</li> <li>Document all parameters with cross-references to parameter-effects.md</li> <li>Add Notes section with theoretical grounding and normative choices</li> <li>Provide working Examples using <code>create_example_data()</code></li> <li>Science docs - Add to <code>docs/science/allocations.md</code> if introducing new principle</li> <li>API docs - Will auto-generate from docstrings via mkdocstrings</li> </ol>"},{"location":"dev-guide/adding-approaches/#existing-implementations-as-examples","title":"Existing Implementations as Examples","text":"Approach File Good Example Of <code>equal_per_capita_budget</code> <code>budgets/per_capita.py</code> Simple budget allocation <code>per_capita_adjusted_budget</code> <code>budgets/per_capita.py</code> Multiple adjustments <code>cumulative_per_capita_convergence</code> <code>pathways/cumulative_per_capita_convergence.py</code> Complex pathway allocation"},{"location":"dev-guide/adding-approaches/#common-utilities","title":"Common Utilities","text":"Utility Purpose <code>filter_time_columns()</code> Extract year columns from DataFrame <code>calculate_relative_adjustment()</code> Compute responsibility/capability adjustments <code>apply_deviation_constraint()</code> Limit extreme allocations <code>validate_weight_constraints()</code> Check weights sum correctly <p>See Utils API for full documentation.</p>"},{"location":"dev-guide/adding-data-sources/","title":"Adding Data Sources","text":"<p>This guide explains how to add new data sources to fair-shares.</p>"},{"location":"dev-guide/adding-data-sources/#overview","title":"Overview","text":"<p>Data sources are configured in <code>conf/data_sources/data_sources_unified.yaml</code> and processed through preprocessing notebooks in the <code>notebooks/1xx_*.py</code> series.</p>"},{"location":"dev-guide/adding-data-sources/#data-types","title":"Data Types","text":"Type Purpose Current Sources <code>emissions</code> Historical emissions PRIMAP-hist <code>gdp</code> Economic capability World Bank WDI, IMF <code>population</code> Per capita calculations UN/OWID <code>gini</code> Within-country inequality UNU-WIDER, WID <code>targets</code> Global constraints AR6 scenarios, RCBs"},{"location":"dev-guide/adding-data-sources/#step-1-add-raw-data","title":"Step 1: Add Raw Data","text":"<p>Place your data files in the appropriate subdirectory:</p> Text Only<pre><code>data/\n\u251c\u2500\u2500 emissions/\n\u2502   \u2514\u2500\u2500 my-source-YYYY/\n\u2502       \u2514\u2500\u2500 raw_data_file.csv\n\u251c\u2500\u2500 gdp/\n\u2502   \u2514\u2500\u2500 my-source-YYYY/\n\u251c\u2500\u2500 population/\n\u251c\u2500\u2500 gini/\n\u251c\u2500\u2500 scenarios/\n\u2514\u2500\u2500 rcbs/\n</code></pre> <p>Use the naming convention <code>{source}-{year}/</code> for versioning.</p>"},{"location":"dev-guide/adding-data-sources/#step-2-configure-the-source","title":"Step 2: Configure the Source","text":"<p>Add an entry to <code>conf/data_sources/data_sources_unified.yaml</code>:</p> YAML<pre><code># Example: Adding a new emissions source\nemissions:\n  primap-202503:\n    # ... existing source ...\n\n  my-source-2026: # New source\n    path: \"data/emissions/my-source-2026/emissions_data.csv\"\n    data_parameters:\n      available_categories:\n        - co2-ffi\n        - all-ghg\n      world_key: \"WORLD\" # How the source identifies global totals\n      scenario: \"HISTCR\" # Historical scenario identifier\n</code></pre>"},{"location":"dev-guide/adding-data-sources/#common-configuration-parameters","title":"Common Configuration Parameters","text":"Parameter Purpose <code>path</code> Relative path to data file <code>available_categories</code> Which emission categories this source provides <code>world_key</code> String used to identify global totals in the data"},{"location":"dev-guide/adding-data-sources/#step-3-create-preprocessing-notebook","title":"Step 3: Create Preprocessing Notebook","text":"<p>Create a preprocessing notebook in the <code>1xx</code> series:</p> Text Only<pre><code>notebooks/\n\u251c\u2500\u2500 101_data_preprocess_emiss_primap-202503.py       # Existing\n\u251c\u2500\u2500 102_data_preprocess_gdp_wdi-2025.py              # Existing\n\u251c\u2500\u2500 103_data_preprocess_population_un-owid-2025.py   # Existing\n\u251c\u2500\u2500 1xx_data_preprocess_my_source.py                 # New notebook\n</code></pre>"},{"location":"dev-guide/adding-data-sources/#preprocessing-pattern","title":"Preprocessing Pattern","text":"Python<pre><code>\"\"\"\nPreprocess my-source-2026 data.\n\nInput: Raw data file\nOutput: Standardized DataFrame with proper index structure\n\"\"\"\n\nimport pandas as pd\nfrom pyprojroot import here\n\n# Load raw data\nraw_path = here() / \"data/emissions/my-source-2026/emissions_data.csv\"\ndf = pd.read_csv(raw_path)\n\n# Standardize country codes to ISO3c\ndf[\"iso3c\"] = convert_to_iso3c(df[\"country_column\"])\n\n# Set standard index\ndf = df.set_index([\"iso3c\", \"unit\", \"emission-category\"])\n\n# Ensure year columns are strings\nfrom fair_shares.library.utils import ensure_string_year_columns\ndf = ensure_string_year_columns(df)\n\n# Add World row if missing\nif \"World\" not in df.index.get_level_values(\"iso3c\"):\n    world_row = df.groupby([\"unit\", \"emission-category\"]).sum()\n    world_row[\"iso3c\"] = \"World\"\n    df = pd.concat([df, world_row.set_index(\"iso3c\", append=True)])\n\n# Save processed data\noutput_path = here() / \"data/processed/my-source-2026/emissions.csv\"\noutput_path.parent.mkdir(parents=True, exist_ok=True)\ndf.to_csv(output_path)\n</code></pre>"},{"location":"dev-guide/adding-data-sources/#step-4-index-structure-requirements","title":"Step 4: Index Structure Requirements","text":"<p>All data must follow standardized MultiIndex structures:</p>"},{"location":"dev-guide/adding-data-sources/#emissions","title":"Emissions","text":"Python<pre><code># Index: iso3c, unit, emission-category\n# Columns: year columns as strings (\"1990\", \"2000\", ...)\ndf.index.names == [\"iso3c\", \"unit\", \"emission-category\"]\n</code></pre>"},{"location":"dev-guide/adding-data-sources/#gdp-population","title":"GDP / Population","text":"Python<pre><code># Index: iso3c, unit\n# Columns: year columns as strings\ndf.index.names == [\"iso3c\", \"unit\"]\n</code></pre>"},{"location":"dev-guide/adding-data-sources/#gini-stationary","title":"Gini (Stationary)","text":"Python<pre><code># Index: iso3c, unit\n# Columns: \"gini\" (single value, not time-varying)\ndf.index.names == [\"iso3c\", \"unit\"]\ndf.columns == [\"gini\"]\n</code></pre>"},{"location":"dev-guide/adding-data-sources/#step-5-integrate-with-pipeline","title":"Step 5: Integrate with Pipeline","text":"<p>The Snakemake workflow automatically picks up sources from the configuration. Ensure your preprocessing notebook:</p> <ol> <li>Reads from the path specified in the config</li> <li>Outputs to the standard processed data location</li> <li>Uses consistent index structures</li> </ol>"},{"location":"dev-guide/adding-data-sources/#step-6-test","title":"Step 6: Test","text":"<ol> <li>Run preprocessing notebook - Verify it completes without errors</li> <li>Run allocation with new source - Use in 301 notebook</li> <li>Check results - Verify country coverage and data ranges</li> </ol> Python<pre><code># In 301 notebook:\nactive_sources = {\n    \"target\": \"rcbs\",\n    \"emissions\": \"my-source-2026\",  # Use new source\n    \"gdp\": \"wdi-2025\",\n    \"population\": \"un-owid-2025\",\n    \"gini\": \"unu-wider-2025\",\n}\n</code></pre>"},{"location":"dev-guide/adding-data-sources/#validation-requirements","title":"Validation Requirements","text":"<p>New data sources should:</p> <ol> <li>Cover expected countries - At minimum, major emitters</li> <li>Include World total - Required for validation</li> <li>Use standard units - Mt CO2e for emissions, persons for population</li> <li>Handle missing values - Document any gaps</li> </ol>"},{"location":"dev-guide/adding-data-sources/#existing-notebooks-as-examples","title":"Existing Notebooks as Examples","text":"Notebook Data Type Good Example Of <code>101_data_preprocess_emiss_primap-202503.py</code> Emissions NetCDF processing, category mapping <code>102_data_preprocess_gdp_wdi-2025.py</code> GDP CSV processing, country code mapping <code>103_data_preprocess_population_un-owid-2025.py</code> Population Combining historical and projected data"},{"location":"dev-guide/adding-data-sources/#see-also","title":"See Also","text":"<ul> <li>Data Sources Config: <code>conf/data_sources/data_sources_unified.yaml</code> in the repository</li> <li>Validation Utilities - Data validation functions</li> </ul>"},{"location":"dev-guide/docs-links/","title":"Documentation Links","text":"<p>This project uses a centralized system for managing documentation links, making it easy to update URLs when documentation moves or is reorganized.</p>"},{"location":"dev-guide/docs-links/#system-overview","title":"System Overview","text":"<p>Central configuration: <code>src/fair_shares/library/config/urls.py</code> Update script: <code>scripts/update_docs_links.py</code> Placeholder pattern: <code>{DOCS_ROOT}/path/to/page/</code></p>"},{"location":"dev-guide/docs-links/#usage-patterns","title":"Usage Patterns","text":""},{"location":"dev-guide/docs-links/#in-python-code-and-docstrings","title":"In Python Code and Docstrings","text":"<p>Use the <code>docs_url()</code> function for dynamic link generation:</p> Python<pre><code>from fair_shares.library.config.urls import docs_url, DOCS_URLS\n\n# Generate a docs URL\nurl = docs_url(\"science/allocations\")\n# Returns: \"https://setupelz.github.io/fair-shares/science/allocations/\"\n\n# Use pre-defined URLs\nscience_url = DOCS_URLS[\"science\"][\"allocations\"]\n</code></pre>"},{"location":"dev-guide/docs-links/#in-notebooks-and-markdown","title":"In Notebooks and Markdown","text":"<p>Use the <code>{DOCS_ROOT}</code> placeholder pattern:</p> Markdown<pre><code>See [Allocation Approaches](https://setupelz.github.io/fair-shares/science/allocations/) for details.\n[IAMC guide](https://setupelz.github.io/fair-shares/user-guide/iamc-regional-fair-shares/#format)\n</code></pre> <p>Important: Use trailing slashes and no <code>.md</code> extension (MkDocs convention).</p>"},{"location":"dev-guide/docs-links/#managing-links","title":"Managing Links","text":""},{"location":"dev-guide/docs-links/#when-documentation-url-changes","title":"When Documentation URL Changes","text":"<ol> <li>Update <code>DOCS_BASE_URL</code> in <code>src/fair_shares/library/config/urls.py</code></li> <li>All Python code automatically uses the new URL</li> <li>For notebooks/markdown, no changes needed (placeholders remain)</li> </ol>"},{"location":"dev-guide/docs-links/#converting-links","title":"Converting Links","text":"<p>The <code>scripts/update_docs_links.py</code> script handles bulk link conversions:</p> Bash<pre><code># Convert relative links to placeholders (one-time setup)\npython scripts/update_docs_links.py --to-placeholder\n\n# Expand placeholders to URLs (for distribution)\npython scripts/update_docs_links.py --expand\n\n# Collapse URLs back to placeholders (for development)\npython scripts/update_docs_links.py --collapse\n\n# Preview changes without modifying files\npython scripts/update_docs_links.py --collapse --dry-run\n</code></pre>"},{"location":"dev-guide/docs-links/#workflow","title":"Workflow","text":"<p>During development: Keep links as <code>{DOCS_ROOT}</code> placeholders in notebooks and markdown.</p> <p>Before distribution: Optionally expand placeholders to full URLs if needed for platforms that don't support custom processing.</p>"},{"location":"dev-guide/docs-links/#environment-variable-override","title":"Environment Variable Override","text":"<p>Override the documentation URL at runtime:</p> Bash<pre><code>export FAIR_SHARES_DOCS_URL=\"https://custom-domain.com/docs\"\npython scripts/update_docs_links.py --expand\n</code></pre> <p>This is useful for:</p> <ul> <li>Testing documentation on staging servers</li> <li>Custom documentation deployments</li> <li>Local documentation preview</li> </ul>"},{"location":"dev-guide/docs-links/#link-format-guidelines","title":"Link Format Guidelines","text":""},{"location":"dev-guide/docs-links/#correct","title":"Correct","text":"Markdown<pre><code>[Page](https://setupelz.github.io/fair-shares/science/allocations/)\n[With anchor](https://setupelz.github.io/fair-shares/quickstart/#installation)\n</code></pre>"},{"location":"dev-guide/docs-links/#incorrect","title":"Incorrect","text":"Markdown<pre><code>[Missing slash](https://setupelz.github.io/fair-shares/science/allocations)\n[Has .md](https://setupelz.github.io/fair-shares/science/allocations.md/)\n[Relative](../docs/science/allocations/)\n</code></pre>"},{"location":"dev-guide/docs-links/#implementation-details","title":"Implementation Details","text":""},{"location":"dev-guide/docs-links/#why-placeholders","title":"Why Placeholders?","text":"<ol> <li>Maintainability: Change URL once, affects all links</li> <li>Portability: Move docs to new domain without updating every file</li> <li>Clarity: Clear that links reference project documentation</li> <li>Flexibility: Support multiple deployment targets</li> </ol>"},{"location":"dev-guide/docs-links/#pattern-recognition","title":"Pattern Recognition","text":"<p>The update script recognizes:</p> <ul> <li>Placeholders: <code>{DOCS_ROOT}/path/</code></li> <li>Full URLs: <code>https://setupelz.github.io/fair-shares/path/</code></li> <li>Relative: <code>../docs/path/</code> or <code>docs/path/</code></li> </ul>"},{"location":"dev-guide/docs-links/#file-coverage","title":"File Coverage","text":"<p>The script updates:</p> <ul> <li><code>notebooks/*.py</code> - All Jupytext notebook sources</li> <li><code>src/**/*.py</code> - Python source code and docstrings</li> <li><code>README.md</code> - Project documentation</li> </ul> <p>Excluded:</p> <ul> <li><code>.ipynb</code> files (generated from <code>.py</code> via <code>make sync-ipynb</code>)</li> <li>Binary files</li> <li>The update script itself</li> </ul>"},{"location":"dev-guide/docstring-template/","title":"Docstring Template for Allocation Approaches","text":"<p>This template ensures consistent, comprehensive documentation for all allocation approaches in Fair Shares.</p>"},{"location":"dev-guide/docstring-template/#complete-template","title":"Complete Template","text":"Python<pre><code>def my_new_allocation(\n    population_ts: TimeseriesDataFrame,\n    allocation_year: int,  # or first_allocation_year for pathways\n    emission_category: str,\n    # ... additional parameters\n    group_level: str = \"iso3c\",\n    unit_level: str = \"unit\",\n    ur: pint.facets.PlainRegistry = get_default_unit_registry(),\n) -&gt; BudgetAllocationResult:  # or PathwayAllocationResult\n    r\"\"\"\n    Short one-line summary of what this approach does.\n\n    Longer description providing context on when to use this approach and\n    what equity principles it operationalizes. This should help users choose\n    between approaches based on their normative commitments.\n\n    Equity Principles Operationalized\n    ----------------------------------\n\n    [Describe which equity principles this approach implements and how. Consider\n    principles like equal rights to atmosphere, CBDR-RC, capability, historical\n    responsibility, etc. Check docs/science/climate-equity-concepts.md and\n    docs/science/allocations.md for existing principles. If this approach doesn't\n    align with documented principles, suggest adding new ones to the conceptual\n    framework.\n\n    Include the key normative choice - what value judgment does this approach make?\n    Link to relevant sections in docs/science/principle-to-code.md.]\n\n    Mathematical Foundation\n    -----------------------\n\n    The allocation is calculated as:\n\n    $$\n    A(g) = \\frac{\\text{metric}(g)}{\\sum_{g'} \\text{metric}(g')}\n    $$\n\n    Where:\n\n    - $A(g)$: Budget/pathway share allocated to country $g$\n    - $\\text{metric}(g)$: The metric used for allocation (e.g., population,\n      adjusted population, historical emissions)\n    - $\\sum_{g'} \\text{metric}(g')$: Sum of metric across all countries\n\n    [For complex approaches, provide additional mathematical detail showing\n    how adjustments are calculated. Use LaTeX notation for equations.]\n\n    Parameters\n    ----------\n    population_ts : TimeseriesDataFrame\n        Timeseries of population for each country with MultiIndex (iso3c, unit).\n        Required for all per capita approaches.\n    allocation_year : int\n        [For budget approaches] Year from which to start calculating allocations.\n        Earlier years account for more historical emissions.\n        See docs/science/parameter-effects.md#allocation_year for how this\n        affects country shares.\n    first_allocation_year : int\n        [For pathway approaches] First year of the allocation period.\n        See docs/science/parameter-effects.md#first_allocation_year.\n    last_allocation_year : int\n        [For pathway approaches] Last year of the allocation period.\n    emission_category : str\n        Emission category to include in the output (e.g., \"co2-ffi\", \"kyoto-ghg\").\n    responsibility_weight : float, optional\n        Weight for historical responsibility adjustment (0.0 to 1.0).\n        Higher values reduce allocation for countries with higher historical emissions.\n        See docs/science/parameter-effects.md#responsibility_weight.\n    capability_weight : float, optional\n        Weight for economic capability adjustment (0.0 to 1.0).\n        Higher values reduce allocation for wealthier countries.\n        See docs/science/parameter-effects.md#capability_weight.\n    income_floor : float, optional\n        Income level (USD/capita/year) below which no capability adjustment\n        is applied. Protects subsistence emissions.\n        See docs/science/parameter-effects.md#income_floor.\n    [... other parameters with types, descriptions, and cross-references]\n    group_level : str, default=\"iso3c\"\n        Level in the index which specifies country/group information.\n    unit_level : str, default=\"unit\"\n        Level in the index which specifies the unit of each timeseries.\n    ur : pint.facets.PlainRegistry, optional\n        The unit registry to use for calculations.\n\n    Returns\n    -------\n    BudgetAllocationResult or PathwayAllocationResult\n        Container with allocation results. Contains:\n\n        - `approach`: Name of approach used (kebab-case string)\n        - `relative_shares_cumulative_emission`: DataFrame with country shares\n          (sums to 1.0 for each year/emission category)\n        - `parameters`: Dict of all parameters used in calculation\n        - [Pathway only] `allocation_pathways_by_country`: Year-by-year emissions\n\n    Notes\n    -----\n    **Theoretical grounding:**\n\n    This approach operationalizes [PRINCIPLE NAME] by [MECHANISM].\n\n    See docs/science/allocations.md#[section-anchor] for detailed theoretical\n    discussion, limitations, and academic citations.\n\n    For translating this principle into code, see\n    docs/science/principle-to-code.md#[principle-section] for implementation\n    patterns.\n\n    **Normative choices embedded in this approach:**\n\n    - **[Choice 1]**: [What is chosen and why it matters]\n      - *Implication*: [How this affects allocations, which countries benefit/lose]\n    - **[Choice 2]**: [Description]\n      - *Implication*: [Impact on equity outcomes]\n\n    [Include any other implementation notes, edge cases, or important behaviors]\n\n    Examples\n    --------\n    Basic usage with minimal parameters:\n\n    &gt;&gt;&gt; from fair_shares.library.allocations.budgets import my_new_allocation\n    &gt;&gt;&gt; from fair_shares.library.utils import create_example_data\n    &gt;&gt;&gt; data = create_example_data()\n    &gt;&gt;&gt; result = my_new_allocation(  # doctest: +ELLIPSIS\n    ...     population_ts=data[\"population\"],\n    ...     allocation_year=2020,\n    ...     emission_category=\"co2-ffi\",\n    ... )\n    Converting units...\n    &gt;&gt;&gt; result.approach\n    'my-new-allocation'\n    &gt;&gt;&gt; # Verify shares sum to 1.0\n    &gt;&gt;&gt; shares = result.relative_shares_cumulative_emission\n    &gt;&gt;&gt; bool(abs(shares[\"2020\"].sum() - 1.0) &lt; 1e-10)\n    True\n\n    [For approaches with adjustments, show examples with different parameter values:]\n\n    With historical responsibility adjustment:\n\n    &gt;&gt;&gt; result_with_responsibility = my_new_allocation(  # doctest: +ELLIPSIS\n    ...     population_ts=data[\"population\"],\n    ...     allocation_year=2020,\n    ...     emission_category=\"co2-ffi\",\n    ...     country_actual_emissions_ts=data[\"emissions\"],\n    ...     responsibility_weight=0.5,\n    ...     historical_responsibility_year=1990,\n    ... )\n    Converting units...\n    &gt;&gt;&gt; # Countries with high historical emissions get lower shares\n    &gt;&gt;&gt; result_with_responsibility.approach\n    'my-new-allocation'\n\n    See Also\n    --------\n    related_function : Brief description of relationship\n    docs/science/allocations.md#relevant-section : Design rationale and theory\n    docs/science/principle-to-code.md#principle : Implementation guidance\n    docs/user-guide/approach-catalog.md : Complete approach comparison\n    \"\"\"\n    # Implementation\n    pass\n</code></pre>"},{"location":"dev-guide/docstring-template/#required-sections","title":"Required Sections","text":"<p>All allocation approach docstrings must include:</p> <ol> <li>Summary: One-line description at the top</li> <li>Description: Longer paragraph on when to use this approach</li> <li>Equity Principles Operationalized: List of equity principles this approach implements with brief explanations and academic citations</li> <li>Mathematical Foundation: LaTeX equations showing the core allocation formula</li> <li>Parameters: All parameters with types, descriptions, and cross-references to parameter-effects.md</li> <li>Returns: Clear description of result object structure</li> <li>Notes:</li> <li>Theoretical grounding with links to allocations.md</li> <li>Link to principle-to-code.md for implementation patterns</li> <li>Normative choices section listing value judgments</li> <li>Examples: At least one working example using <code>create_example_data()</code></li> <li>See Also: Cross-references to related functions and documentation</li> </ol>"},{"location":"dev-guide/docstring-template/#best-practices","title":"Best Practices","text":""},{"location":"dev-guide/docstring-template/#equity-principles-operationalized","title":"Equity Principles Operationalized","text":"<p>This section makes the normative foundations of your approach explicit. Think about:</p> <ul> <li>Which equity principles does this approach align with? (Check docs/science/climate-equity-concepts.md)</li> <li>How does the implementation operationalize these principles?</li> <li>What is the central normative choice or value judgment?</li> <li>Does this fit within existing principles in docs/science/, or should we add new ones?</li> </ul> <p>Write this section in your own words - there's no required format. The goal is understanding the equity grounding, not filling in a template.</p> <p>Good example:</p> Python<pre><code>r\"\"\"\nEquity Principles Operationalized\n----------------------------------\n\nThis approach implements the principle of equal rights to the atmosphere (grounded\nin the egalitarian ethical tradition) by giving all people equal entitlements to\natmospheric space, operationalized via per capita allocation at the allocation year.\nIt can also account for historical responsibility (earlier allocation years include\nmore cumulative emissions, following the \"polluter pays\" principle from Caney 2010)\nand capability (GDP-based adjustments when `capability_weight &gt; 0`, following\nH\u00f6hne et al. 2014).\n\nThe key normative choice is treating population at a single point in time as the\nbasis for equal entitlements, rather than using projected or historical population.\n\nSee docs/science/principle-to-code.md#egalitarianism and\ndocs/science/climate-equity-concepts.md#equal-per-capita.\n\"\"\"\n</code></pre> <p>Bad example:</p> Python<pre><code>r\"\"\"\nEquity Principles Operationalized\n----------------------------------\n\nUses standard allocation methodology based on population.\n\"\"\"\n</code></pre> <p>(Doesn't identify principles, explain how they're operationalized, or surface normative choices.)</p>"},{"location":"dev-guide/docstring-template/#mathematical-foundation","title":"Mathematical Foundation","text":"<ul> <li>Use raw string (<code>r\"\"\"</code>) for LaTeX equations</li> <li>Define all variables used in equations</li> <li>For complex approaches, break down the calculation into steps</li> <li>Show both the main allocation formula and any adjustment formulas</li> </ul>"},{"location":"dev-guide/docstring-template/#parameters","title":"Parameters","text":"<ul> <li>Always include cross-reference to <code>parameter-effects.md</code> for key parameters</li> <li>For adjustment weights, note the direction of effect (e.g., \"higher values reduce allocation for...\")</li> <li>Include valid ranges (e.g., \"0.0 to 1.0\")</li> <li>Specify defaults where applicable</li> </ul>"},{"location":"dev-guide/docstring-template/#normative-choices","title":"Normative Choices","text":"<p>Be explicit about value judgments embedded in the approach:</p> <ul> <li>Good: \"Allocating based on current population treats all people as equal regardless of when they were born\"</li> <li> <p>Implication: \"Countries with growing populations receive larger future allocations\"</p> </li> <li> <p>Bad: \"Uses population\" (doesn't surface the normative choice or implications)</p> </li> </ul>"},{"location":"dev-guide/docstring-template/#examples","title":"Examples","text":"<p>CRITICAL: All examples must demonstrate realistic usage with DataFrame-based data structures. Never use scalar-only examples.</p>"},{"location":"dev-guide/docstring-template/#requirements","title":"Requirements","text":"<ol> <li>Use <code>create_example_data()</code> for non-IAMC work:</li> </ol> Python Console Session<pre><code>&gt;&gt;&gt; from fair_shares.library.utils import create_example_data\n&gt;&gt;&gt; data = create_example_data()\n&gt;&gt;&gt; result = calculate_equal_per_capita(data, budget=1000.0)\n</code></pre> <ol> <li>Reference IAMC example file for pathway-based work:</li> </ol> Python Console Session<pre><code># Example IAMC data columns: model, scenario, region, variable, unit, 1990, 1995, ..., 2100\n# Reference: data/scenarios/iamc_example/iamc_reporting_example.xlsx\n&gt;&gt;&gt; iamc_data = load_example_iamc()\n&gt;&gt;&gt; result = generate_pathway_from_iamc(\n...     iamc_data,\n...     model=\"SSP_SSP2_v6.3_ES\",\n...     scenario=\"ECPC-2015-800Gt\"\n... )\n</code></pre> <ol> <li>NEVER use scalar-only examples:</li> </ol> Python Console Session<pre><code># BAD - scalar only\n&gt;&gt;&gt; calculate_equal_per_capita(100, budget=1000)\n\n# GOOD - realistic DataFrame\n&gt;&gt;&gt; data = create_example_data()\n&gt;&gt;&gt; calculate_equal_per_capita(data, budget=1000.0)\n</code></pre>"},{"location":"dev-guide/docstring-template/#best-practices_1","title":"Best Practices","text":"<ul> <li>All examples must be executable (use <code># doctest: +ELLIPSIS</code> for non-deterministic output)</li> <li>Use <code>create_example_data()</code> for consistent test data</li> <li>Show verification that shares sum to 1.0</li> <li>For approaches with many parameters, show multiple examples with different configurations</li> <li>Include comments explaining what the example demonstrates</li> <li>For IAMC examples, explicitly reference column structure (model, scenario, region, variable, unit, year columns)</li> </ul>"},{"location":"dev-guide/docstring-template/#cross-references","title":"Cross-References","text":"<p>Link to:</p> <ul> <li>Parameter effects (<code>docs/science/parameter-effects.md#parameter_name</code>) for each key parameter</li> <li>Theoretical grounding (<code>docs/science/allocations.md#section</code>) for academic context</li> <li>Principle-to-code (<code>docs/science/principle-to-code.md#principle</code>) for implementation guidance</li> <li>Related approaches in See Also section</li> <li>Approach catalog (<code>docs/user-guide/approach-catalog.md</code>) for comparison</li> </ul>"},{"location":"dev-guide/docstring-template/#anti-patterns-to-avoid","title":"Anti-Patterns to Avoid","text":"<p>Don't hide normative choices behind technical jargon:</p> Python<pre><code>Notes\n-----\nUses standard convergence methodology.\n</code></pre> <p>Do make value judgments explicit:</p> Python<pre><code>Notes\n-----\n**Normative choices:**\n\n- **Grandfathering**: Allocates future emissions based on current shares\n  - *Implication*: Countries with high current emissions receive larger\n    future allocations, which lacks ethical basis per CBDR-RC principles.\n</code></pre> <p>Don't omit the mathematical foundation:</p> Python<pre><code>\"\"\"Allocates emissions based on population and other factors.\"\"\"\n</code></pre> <p>Do show the complete formula:</p> Python<pre><code>r\"\"\"\nMathematical Foundation\n-----------------------\n\n$$\nA(g) = \\frac{P(g, t_a)}{\\sum_{g'} P(g', t_a)} \\times (1 - R(g) \\times w_R)\n$$\n\nWhere $R(g)$ is the responsibility adjustment...\n</code></pre> <p>Don't use placeholder examples:</p> Python<pre><code>Examples\n--------\n&gt;&gt;&gt; result = my_function(data)\n&gt;&gt;&gt; # TODO: Add example output\n</code></pre> <p>Do provide working, verified examples:</p> Python<pre><code>Examples\n--------\n&gt;&gt;&gt; from fair_shares.library.utils import create_example_data\n&gt;&gt;&gt; data = create_example_data()\n&gt;&gt;&gt; result = my_function(  # doctest: +ELLIPSIS\n...     population_ts=data[\"population\"],\n...     allocation_year=2020,\n... )\nConverting units...\n&gt;&gt;&gt; bool(abs(result.relative_shares_cumulative_emission[\"2020\"].sum() - 1.0) &lt; 1e-10)\nTrue\n</code></pre>"},{"location":"dev-guide/docstring-template/#validation","title":"Validation","text":"<p>Before committing, verify:</p> <ol> <li>All sections present (use checklist from <code>testing-checklist.md</code>)</li> <li>\"Equity Principles Operationalized\" section lists specific principles with citations</li> <li>LaTeX equations render correctly in generated docs</li> <li>All examples execute without errors: <code>uv run pytest --doctest-modules src/</code></li> <li>Cross-references link to existing documentation sections</li> <li>Parameter types match function signature</li> <li>Normative choices section identifies at least one value judgment</li> </ol>"},{"location":"dev-guide/docstring-template/#see-also","title":"See Also","text":"<ul> <li>Testing Checklist \u2014 Pre-merge validation steps</li> <li>Adding New Approaches \u2014 Complete workflow for new allocations</li> <li>Parameter Effects Reference \u2014 Parameter documentation to link to</li> <li>Principle-to-Code Guide \u2014 Implementation patterns for equity principles</li> </ul>"},{"location":"dev-guide/testing-checklist/","title":"Testing Checklist for New Allocation Approaches","text":"<p>This checklist ensures new allocation approaches are thoroughly validated before merging. Complete all sections before creating a pull request.</p>"},{"location":"dev-guide/testing-checklist/#pre-merge-checklist","title":"Pre-Merge Checklist","text":""},{"location":"dev-guide/testing-checklist/#unit-tests","title":"Unit Tests","text":"<p>Verify the fundamental behavior of your allocation approach:</p> <ul> <li> Shares sum to 1.0: All test cases verify <code>abs(result.relative_shares_cumulative_emission.sum() - 1.0) &lt; 1e-10</code></li> <li> Correct approach name: <code>result.approach</code> matches the kebab-case registry name</li> <li> Parameters stored correctly: <code>result.parameters</code> dict contains all input parameters</li> <li> Zero weight produces no adjustment: For approaches with adjustment weights (e.g., <code>responsibility_weight</code>, <code>capability_weight</code>), verify that weight=0 produces unadjusted allocations</li> <li> Extreme parameter values handled gracefully: Test boundary cases (e.g., <code>allocation_year</code> at dataset edges, weights at 0.0 and 1.0)</li> <li> Edge cases: Empty datasets, single-country scenarios, missing data handled appropriately</li> </ul> <p>Example test pattern:</p> Python<pre><code>def test_my_new_allocation_shares_sum_to_one():\n    data = create_example_data()\n    result = my_new_allocation(\n        population_ts=data[\"population\"],\n        allocation_year=2020,\n        emission_category=\"co2-ffi\",\n    )\n    assert abs(result.relative_shares_cumulative_emission[\"2020\"].sum() - 1.0) &lt; 1e-10\n</code></pre>"},{"location":"dev-guide/testing-checklist/#integration-tests","title":"Integration Tests","text":"<p>Verify the approach works with the broader system:</p> <ul> <li> Works with AllocationManager: Approach can be run via <code>AllocationManager.run_allocation()</code></li> <li> Handles real PRIMAP data: Runs successfully with actual historical emissions data (not just test data)</li> <li> Handles missing countries gracefully: Works when some countries lack population/GDP/emissions data</li> <li> Year range validation: Handles edge cases like <code>allocation_year</code> before/after data availability</li> <li> Multi-category support: Works with different emission categories (co2-ffi, kyoto-ghg, etc.)</li> </ul> <p>Example integration test pattern:</p> Python<pre><code>def test_my_new_allocation_with_example_data():\n    from fair_shares.library.utils import create_example_data\n    data = create_example_data()\n    result = my_new_allocation(\n        population_ts=data[\"population\"],\n        country_actual_emissions_ts=data[\"emissions\"],\n        allocation_year=2020,\n        emission_category=\"co2-ffi\",\n    )\n    assert result.approach == \"my-new-allocation\"\n</code></pre>"},{"location":"dev-guide/testing-checklist/#documentation","title":"Documentation","text":"<p>Ensure comprehensive documentation following the docstring template:</p> <ul> <li> Docstring follows template: See docstring-template.md for required sections</li> <li> Mathematical Foundation section: Includes LaTeX equations defining the allocation formula</li> <li> All variables defined: LaTeX equations define all symbols used (e.g., \\(A(g)\\), \\(P(g, t)\\))</li> <li> Parameter descriptions complete: Each parameter documented with type, description, valid range, and cross-reference to parameter-effects.md</li> <li> Example code runs without errors: All docstring examples execute successfully with <code>uv run pytest --doctest-modules src/</code></li> <li> Notes section includes normative choices: At least one value judgment explicitly stated with implications</li> <li> See Also section: Cross-references to related approaches, allocations.md, principle-to-code.md</li> </ul>"},{"location":"dev-guide/testing-checklist/#equity-grounding","title":"Equity Grounding","text":"<p>All allocation approaches MUST explicitly document their equity principles foundation:</p> <ul> <li> Equity Principles Operationalized section present: Docstring includes dedicated section after Description</li> <li> Specific principles identified: Lists which equity principles are implemented (e.g., equal per capita / equal atmospheric rights, historical responsibility, capability, CBDR-RC)</li> <li> Operationalization explained: Describes HOW each principle is implemented in the code (not just \"uses principle X\")</li> <li> Academic citations included: References climate equity literature grounding these principles (e.g., Caney 2010, H\u00f6hne et al. 2014)</li> <li> Key normative choice identified: States the central value judgment the approach makes</li> <li> Links to conceptual resources: Cross-references to <code>docs/science/principle-to-code.md#[principle]</code> and <code>docs/science/climate-equity-concepts.md#[concept]</code></li> <li> Normative choices enumerated: Notes section lists specific value judgments with implications for which countries benefit/lose</li> <li> Critiqued approaches flagged: If the approach includes grandfathering elements (allocating based on current emission shares), BAU deviation framing (treating deviation from business-as-usual as a cost), or small share justifications, these are clearly documented as debated in the literature (see Approaches Debated in the Literature)</li> </ul> <p>Why equity grounding matters:</p> <p>This project makes normative choices visible rather than hiding them behind technical defaults. Every allocation approach embeds value judgments about fairness, responsibility, and entitlement. Making these explicit:</p> <ul> <li>Enables users to choose approaches aligned with their principles</li> <li>Prevents \"neutral-looking\" defaults from masking ethical positions</li> <li>Grounds implementation in climate equity scholarship</li> <li>Maintains consistency with CBDR-RC (Common But Differentiated Responsibilities and Respective Capabilities)</li> </ul> <p>Required docstring sections:</p> <ol> <li>Summary (one line)</li> <li>Description (when to use this approach)</li> <li>Mathematical Foundation (LaTeX equations)</li> <li>Parameters (with cross-references)</li> <li>Returns (result object structure)</li> <li>Notes (theoretical grounding + normative choices)</li> <li>Examples (at least one working example)</li> <li>See Also (cross-references)</li> </ol>"},{"location":"dev-guide/testing-checklist/#registry","title":"Registry","text":"<p>Ensure the approach is properly registered:</p> <ul> <li> Added to registry.py: Approach listed in the dict returned by <code>get_allocation_functions()</code></li> <li> Kebab-case name follows convention: Name uses lowercase with hyphens (e.g., <code>my-new-allocation</code>)</li> <li> Type detection works: <code>is_budget_approach()</code> or <code>is_pathway_approach()</code> returns correct boolean</li> <li> Docstring summary matches: First line of docstring matches registry description</li> <li> Import statement correct: Function imported from correct module path</li> </ul> <p>Example registry entry:</p> Python<pre><code>def get_allocation_functions() -&gt; dict[str, Callable[..., Any]]:\n    return {\n        # ... existing approaches ...\n        \"my-new-allocation\": my_new_allocation,\n    }\n</code></pre>"},{"location":"dev-guide/testing-checklist/#code-quality","title":"Code Quality","text":"<p>Follow project conventions and best practices:</p> <ul> <li> Type hints on all parameters: Function signature includes type annotations</li> <li> Follows existing patterns: Code structure matches similar approaches in codebase</li> <li> No hardcoded values: Magic numbers replaced with named constants or parameters</li> <li> Error messages are clear: Validation errors explain what's wrong and how to fix it</li> <li> Performance considerations: No unnecessary loops or redundant calculations</li> </ul>"},{"location":"dev-guide/testing-checklist/#cross-references","title":"Cross-References","text":"<p>Verify documentation links are correct:</p> <ul> <li> Parameter effects cross-references work: Links to <code>docs/science/parameter-effects.md#parameter_name</code> resolve correctly</li> <li> Allocations.md anchor exists: Reference to <code>docs/science/allocations.md#section</code> points to valid section</li> <li> Principle-to-code reference valid: Link to <code>docs/science/principle-to-code.md#principle</code> exists</li> <li> API docs will generate correctly: Docstring format compatible with mkdocs/mkdocstrings</li> </ul>"},{"location":"dev-guide/testing-checklist/#quick-validation-commands","title":"Quick Validation Commands","text":"<p>Run these commands before creating a pull request:</p> Bash<pre><code># Run unit and integration tests\nuv run pytest tests/ -v\n\n# Run docstring examples\nuv run pytest --doctest-modules src/fair_shares/library/allocations/\n\n# Check type hints\nuv run mypy src/fair_shares/library/allocations/\n\n# Lint code\nuv run ruff check src/ tests/\nuv run ruff format src/ tests/\n\n# Build documentation to verify no broken links\nuv run mkdocs build --strict\n\n# Optional: Run documentation sync check (if available)\nuv run python tools/docs-sync-check.py\n</code></pre>"},{"location":"dev-guide/testing-checklist/#common-issues","title":"Common Issues","text":""},{"location":"dev-guide/testing-checklist/#shares-dont-sum-to-10","title":"Shares Don't Sum to 1.0","text":"<p>Symptom: Test fails with <code>AssertionError: shares sum to X, not 1.0</code></p> <p>Solutions:</p> <ul> <li>Check for division by zero when metric sum is zero</li> <li>Ensure all countries are included in normalization step</li> <li>Verify no NaN values in intermediate calculations</li> <li>Use <code>ensure_string_year_columns()</code> on input dataframes</li> </ul>"},{"location":"dev-guide/testing-checklist/#docstring-examples-fail","title":"Docstring Examples Fail","text":"<p>Symptom: <code>pytest --doctest-modules</code> reports failures</p> <p>Solutions:</p> <ul> <li>Add <code># doctest: +ELLIPSIS</code> for non-deterministic output (e.g., unit conversion messages)</li> <li>Use <code>create_example_data()</code> instead of hardcoded data</li> <li>Verify example code matches current API signatures</li> <li>Check that imports in examples are correct</li> </ul>"},{"location":"dev-guide/testing-checklist/#missing-parameter-cross-references","title":"Missing Parameter Cross-References","text":"<p>Symptom: Documentation build warnings about broken links</p> <p>Solutions:</p> <ul> <li>Ensure <code>parameter-effects.md</code> has anchor for each parameter (e.g., <code>## allocation_year</code>)</li> <li>Use exact anchor names in cross-references</li> <li>Verify <code>allocations.md</code> section exists before linking</li> <li>Check <code>principle-to-code.md</code> has the referenced principle section</li> </ul>"},{"location":"dev-guide/testing-checklist/#see-also","title":"See Also","text":"<ul> <li>Docstring Template \u2014 Required docstring structure</li> <li>Adding New Approaches \u2014 Complete workflow for new allocations</li> <li>Parameter Effects Reference \u2014 Parameter documentation</li> <li>Principle-to-Code Guide \u2014 Implementation patterns</li> <li>Allocations Overview \u2014 Theoretical grounding</li> </ul>"},{"location":"science/","title":"Scientific Documentation","text":"<p>Scope</p> <p>This draws on ~30 climate equity papers -- a working subset, not comprehensive. Corrections and expansions welcome. See References.</p>"},{"location":"science/#in-this-section","title":"In This Section","text":"<ul> <li>Allocation Approaches -- Design, parameters, and rationale for each approach</li> <li>Climate Equity Concepts -- Ethical traditions and foundational principles</li> <li>From Principle to Code -- How equity principles translate to implementation choices</li> <li>Parameter Effects -- How parameter choices affect allocations, with real data examples</li> <li>Other Operations -- RCB pathway generation, net-negative handling, harmonization</li> <li>Glossary -- Terminology</li> <li>References -- Bibliography</li> </ul>"},{"location":"science/allocations/","title":"Allocation Approaches","text":"<p>Design and parameters for allocation approaches in fair-shares.</p> <p>For underlying principles, see Climate Equity Concepts. For mathematical formulations, see the API Reference for budgets and pathways.</p>","boost":2},{"location":"science/allocations/#overview","title":"Overview","text":"<p>Allocation approaches distribute emissions among countries based on equity principles. fair-shares implements two categories:</p> Category Question Answered Output Budget What is each country's fair share of a cumulative remaining emissions budget? Single allocation per country Pathway What is each country's fair share of emissions each future year? Time-varying annual allocations <p>All allocation approaches ensure shares sum to 1 in each year and ensure complete global coverage.</p>","boost":2},{"location":"science/allocations/#budget-vs-pathway-choosing-based-on-your-needs","title":"Budget vs Pathway: Choosing Based on Your Needs","text":"<p>In brief: Both produce the same cumulative allocations. Choose based on whether you need year-by-year breakdowns.</p> <p>Why they're equivalent: For emission pathways that never go negative (emissions always \u22650), the cumulative sum of annual allocations equals the budget allocation. fair-shares ensures this by design.</p> Technical note: The net-negative emissions exception <p>The equivalence holds only for pathways with positive-only emissions. IPCC AR6 overshoot scenarios include net-negative emissions in later decades (CO2 removal). This creates a challenge:</p> <ul> <li>AR6 budgets work fine \u2014 they capture cumulative totals that already account for net-negative emissions</li> <li>AR6 pathways present ambiguity \u2014 how to allocate negative values while maintaining proportional fairness?</li> </ul> <p>fair-shares does not alter AR6 pathways. Instead, it sets post-net-zero emissions to NaN and reports unallocated quantities as a warning. Users must decide how to handle net-negative portions separately.</p> <p>Converting RCBs to pathways: Use <code>generate_rcb_pathway_scenarios()</code> to convert any budget to a temporal breakdown (e.g., exponential decay over years). See Other Operations: RCB Pathway Generation.</p>","boost":2},{"location":"science/allocations/#target-source-options","title":"Target Source Options","text":"<p>fair-shares supports three target sources for allocation calculations:</p> Target Type Use When Output <code>rcbs</code> Budget Calculating cumulative national budget allocations Single value per country <code>ar6</code> Pathway Allocating annual emissions following AR6 scenarios Time series of annual values <code>rcb-pathways</code> Hybrid Using budget approaches but need year-by-year pathways Budget allocated, then to annual path","boost":2},{"location":"science/allocations/#rcb-to-pathway-conversion","title":"RCB-to-Pathway Conversion","text":"<p>The <code>rcb-pathways</code> target source converts the global remaining carbon budget (RCB) into an annual emission pathway, which can then be allocated using pathway allocation approaches. This approach:</p> <ol> <li>Generates a global pathway from the remaining carbon budget using normalized shifted exponential decay</li> <li>Applies pathway allocation approaches to distribute the global pathway among countries (e.g., <code>equal-per-capita</code>, <code>per-capita-adjusted</code>)</li> <li>Preserves cumulative totals \u2014 the sum of annual pathway emissions equals the original carbon budget</li> </ol> <p>Why use this? You want to start from a global carbon budget but need year-by-year emission trajectories for:</p> <ul> <li>Integration with IAMs (Integrated Assessment Models)</li> <li>Policy roadmaps requiring annual targets</li> <li>Comparison with AR6 scenario pathways</li> </ul> <p>Mathematical approach: Uses <code>generate_rcb_pathway_scenarios()</code> which creates an exponential decay curve that:</p> <ul> <li>Starts at historical emissions in the allocation year</li> <li>Reaches exactly zero by the end year</li> <li>Ensures discrete annual sums equal the budget</li> </ul> <p>Configuration: Set <code>target: \"rcb-pathways\"</code> in your data source config. See User Guide: Configuration for setup details.</p> <p>Technical details: RCB Pathway Generation</p>","boost":2},{"location":"science/allocations/#parameters","title":"Parameters","text":"<p>For real-world examples showing how these parameters affect allocation outcomes for different countries, see Parameter Effects Reference.</p>","boost":2},{"location":"science/allocations/#allocation-year","title":"Allocation Year","text":"<p>Reference year for calculating cumulative per capita allocations.</p> Category Parameter Name Budget <code>allocation_year</code> Pathway <code>first_allocation_year</code> <p>Earlier allocation years account for historical emissions in the cumulative calculation. See Polluter Pays.</p>","boost":2},{"location":"science/allocations/#building-blocks","title":"Building Blocks","text":"Component What it adds Budget Parameter Pathway Parameter Early allocation year Accounts for emissions since that year <code>allocation_year</code> <code>first_allocation_year</code> Responsibility weight Rescales by emissions from <code>historical_responsibility_year</code> <code>responsibility_weight</code> + <code>historical_responsibility_year</code> Same Capability weight Adjustment by capacity from allocation year onwards <code>capability_weight</code> Same Income floor Protects subsistence needs in capability calculations <code>income_floor</code> Same Gini adjustment Within-country inequality correction Use <code>*-gini-budget</code> allocation approach Use <code>*-gini</code> or <code>*-gini-adjusted</code> allocation approach Convergence mechanism Transition from current to target cumulative shares N/A Use <code>cumulative-per-capita-convergence*</code> allocation approach <p>Temporal note: Capability adjustments apply from the allocation year onwards, while responsibility weight rescaling uses emissions from <code>historical_responsibility_year</code> to the allocation year. This allows separating the periods for capability and responsibility accounting.</p> <p>These can be combined. For example, CBDR-RC can be interpreted and operationalised through:</p> <ul> <li>Early allocation year (e.g. 1850) + capability weight: simplest, but capability data may be unavailable for early years</li> <li>Allocation year of 1990 + responsibility weight from 1850 + capability weight: uses responsibility rescaling for 1850-1990 emissions while applying capability adjustments from 1990 onwards (when data is available)</li> <li>(Pathways only) Convergence approach + early allocation year + capability weight: with smooth transition path</li> </ul>","boost":2},{"location":"science/allocations/#example-configurations-budget","title":"Example Configurations: Budget","text":"Use Case Approach Key Parameters Forward-looking egalitarian <code>equal-per-capita-budget</code> Recent <code>allocation_year</code> Egalitarian + historical <code>equal-per-capita-budget</code> Early <code>allocation_year</code> (e.g. 1850, 1990) CBDR-RC (simplest) <code>per-capita-adjusted-budget</code> Early <code>allocation_year</code> + <code>capability_weight</code> CBDR-RC (via rescaling) <code>per-capita-adjusted-budget</code> <code>responsibility_weight</code> + <code>capability_weight</code> Inequality-sensitive CBDR-RC <code>per-capita-adjusted-gini-budget</code> Early <code>allocation_year</code> + <code>capability_weight</code>","boost":2},{"location":"science/allocations/#example-configurations-pathway","title":"Example Configurations: Pathway","text":"Use Case Approach Key Parameters Forward-looking egalitarian <code>equal-per-capita</code> Recent <code>first_allocation_year</code> Egalitarian + historical <code>equal-per-capita</code> Early <code>first_allocation_year</code> (e.g. 1850, 1990) CBDR-RC (simplest) <code>per-capita-adjusted</code> Early <code>first_allocation_year</code> + <code>capability_weight</code> CBDR-RC (via rescaling) <code>per-capita-adjusted</code> <code>responsibility_weight</code> + <code>capability_weight</code> CBDR-RC with convergence <code>cumulative-per-capita-convergence-adjusted</code> Early <code>first_allocation_year</code> + <code>capability_weight</code> Inequality-sensitive CBDR-RC <code>*-gini-adjusted</code> Early <code>first_allocation_year</code> + <code>capability_weight</code>","boost":2},{"location":"science/allocations/#gini-adjustment","title":"Gini Adjustment","text":"<p>Models national income distribution as log-normal and applies an income floor, excluding income below threshold when calculating capability. Higher Gini coefficients reduce the effective capability metric.</p> <p>See Subsistence vs. Luxury Emissions for conceptual context.</p> <p>Mathematical formulations: Budget | Pathway</p>","boost":2},{"location":"science/allocations/#maximum-deviation-constraint","title":"Maximum Deviation Constraint","text":"<p>Limits how far any country's allocation can deviate from equal per capita. Default: \u00b12 standard deviations.</p> <p>Parameter: <code>max_deviation_sigma</code></p> <p>Implementation details: Budget | Pathway</p>","boost":2},{"location":"science/allocations/#weight-normalization","title":"Weight Normalization","text":"<p>Combines responsibility and capability adjustments as multiplicative factors applied to the equal-per-capita baseline:</p> Text Only<pre><code>Adjusted population = Population \u00d7 responsibility_metric^(-w_r) \u00d7 capability_metric^(-w_c)\n</code></pre> <p>Where <code>w_r</code> and <code>w_c</code> are the normalized responsibility and capability weights (divided by their sum). Only the ratio between weights affects results; <code>(0.3, 0.7)</code> and <code>(0.15, 0.35)</code> produce identical allocations because they normalize to the same values.</p> <p>Mathematical specification: Budget | Pathway</p>","boost":2},{"location":"science/allocations/#dynamic-vs-preserved-shares","title":"Dynamic vs Preserved Shares","text":"<p>Parameter: <code>preserve_allocation_year_shares</code> (budget) / <code>preserve_first_allocation_year_shares</code> (pathway)</p> Mode Budget Pathway Dynamic (default) Cumulative population from allocation year Recalculated each year based on current pop/GDP Preserved Population at allocation year only Fixed at first allocation year <p>Mathematical specifications: Budget | Pathway</p>","boost":2},{"location":"science/allocations/#historical-responsibility","title":"Historical Responsibility","text":"<p>Two mechanisms:</p> <ol> <li>Early allocation year: Set <code>allocation_year</code> to 1850 or 1990 (calculates cumulative per capita since that year)</li> <li>Responsibility weight: Use <code>responsibility_weight</code> + <code>historical_responsibility_year</code> (multiplicative adjustment based on per-capita historical emissions)</li> </ol> <p>These can be combined. See Polluter Pays for conceptual foundations.</p> <p>Mathematical details: Budget | Pathway</p>","boost":2},{"location":"science/allocations/#convergence-mechanism-pathways-only","title":"Convergence Mechanism (Pathways Only)","text":"<p>Cumulative per capita convergence approaches provide exponential transition from current emissions to cumulative per capita targets.</p> <p>Properties:</p> <ul> <li>Smooth (continuous and differentiable)</li> <li>Cumulative-constrained: total over horizon equals target share</li> <li>Automatic speed: minimum speed satisfying cumulative constraints</li> </ul> <p>Mathematical derivation \u2192</p>","boost":2},{"location":"science/allocations/#strict-parameter-convergence-only","title":"Strict Parameter (Convergence Only)","text":"<p>Parameter: <code>strict</code> (default: True)</p> Mode Behavior Strict Raise error if no feasible convergence solution exists Permissive Accept approximate solutions, document deviations in warnings <p>Implementation details \u2192</p>","boost":2},{"location":"science/allocations/#per-capita-convergence-pcc","title":"Per Capita Convergence (PCC)","text":"<p>The <code>per-capita-convergence</code> approach linearly blends grandfathering (current emissions) with equal per capita over time. It includes grandfathering elements, which are critiqued in the literature; see Approaches Debated in the Literature for context.</p> <p>Formulation \u2192</p>","boost":2},{"location":"science/allocations/#see-also","title":"See Also","text":"<ul> <li>Climate Equity Concepts: Theoretical foundations and principles</li> <li>API Reference: Budget Allocations: Budget mathematical formulations</li> <li>API Reference: Pathway Allocations: Pathway mathematical formulations</li> <li>country-fair-shares Guide: When to use each approach</li> <li>References: Complete bibliography</li> </ul>","boost":2},{"location":"science/climate-equity-concepts/","title":"Climate Equity Concepts","text":"<p>This page introduces equity concepts that inform fair-shares allocation approaches. The goal is to help you understand the reasoning behind different approaches, not to prescribe which principles to adopt.</p> <p>For implementation details, see Allocation Approaches. For mathematical formulations, see the API Reference for budgets and pathways.</p> <p>Scope and limitations</p> <p>This documentation draws on a working subset of the climate equity literature (currently ~30 papers). It is not comprehensive \u2014 the sources cited here are illustrative examples from a much broader scholarly conversation, and we welcome corrections and suggestions. See References for the current bibliography.</p>","boost":2},{"location":"science/climate-equity-concepts/#principles-and-ethical-grounding","title":"Principles and Ethical Grounding","text":"<p>Allocation approaches operationalize principles drawn from several traditions in distributive justice. The table below maps the principles used in fair-shares to their ethical grounding and code-level implementation. This is necessarily a simplification \u2014 the literature contains richer and more contested accounts than any summary table can capture.</p>","boost":2},{"location":"science/climate-equity-concepts/#overview","title":"Overview","text":"Principle Core Question Draws From Where in fair-shares Equal per capita entitlement Does each person have equal rights to the atmosphere? Egalitarianism [Caney 2009; Bode 2004] <code>equal-per-capita-*</code> approaches Historical responsibility Should past emissions reduce future entitlements? Corrective justice, polluter pays [Meyer 2013; Shue 2015] <code>allocation_year</code>; <code>responsibility_weight</code> in <code>per-capita-adjusted</code> Ability to pay Should wealthier countries bear more of the burden? Capabilities approach [Caney 2010; Baer 2009] <code>capability_weight</code> in <code>per-capita-adjusted</code> Protection of basic needs Should subsistence emissions be shielded from mitigation? Sufficientarianism, right to development [Shue 2014; Meyer 2013] Gini-adjusted approaches with income floor <p>These principles are often combined. CBDR-RC (Common But Differentiated Responsibilities and Respective Capabilities), the cornerstone of the UNFCCC [Okereke 2016; Rajamani 2021], combines historical responsibility with ability to pay. The Paris Agreement added \"in light of different national circumstances\" [Rajamani 2021]. In fair-shares, CBDR-RC can be operationalized through parameter combinations such as early allocation year + capability adjustment (see Allocation Approaches).</p> <p>Additional influences: Unjust enrichment [Heyward 2021; Pickering 2012] provides independent grounding for historical responsibility \u2014 including cases where past emitters could not have known the consequences. The no-harm principle and duty to preserve physical preconditions [Shue 2015] provide general justification for mitigation action without mapping to specific allocation formulas. Prioritarianism and limitarianism inform theoretical debates but are not directly operationalized.</p>","boost":2},{"location":"science/climate-equity-concepts/#equal-per-capita-entitlement","title":"Equal Per Capita Entitlement","text":"<p>Grounded in egalitarianism \u2014 the view that all humans have equal moral status and therefore equal claims to shared resources [Caney 2009; Bode 2004]. Baer 2013 grounds this in cosmopolitan egalitarianism, treating individuals (not nations) as the fundamental moral units. Some authors critique equal per capita approaches as focusing on the wrong distribuendum \u2014 arguing that what matters is capabilities to meet needs, not emission rights per se [Caney 2021; Dooley 2021].</p> <p>Operationalized in: <code>equal-per-capita-budget</code>, <code>equal-per-capita</code> pathway (see Allocation Approaches)</p> <p>Further reading: Caney 2009, Bode 2004, Baer 2013, Matthews 2016</p>","boost":2},{"location":"science/climate-equity-concepts/#historical-responsibility","title":"Historical Responsibility","text":"<p>Grounded in corrective justice and the polluter pays principle. The long atmospheric lifetime of CO\u2082 means past emissions continue affecting the climate system, making cumulative accounting scientifically justified [Matthews 2016]. How to account for historical emissions \u2014 and from what start date \u2014 is one of the most debated questions in the literature (see Meyer 2013 for a treatment of the arguments). Pickering 2012 and Truccone-Borgogno 2022 develop an unjust enrichment framing that supports historical accountability independent of proving fault. Meyer 2013 proposes a benefits-based redistribution framing that sidesteps the non-identity problem.</p> <p>Operationalized in: Two mechanisms. First, early allocation year: setting <code>allocation_year</code> to an early date (e.g., 1850) works with any approach. Second, responsibility weight: <code>responsibility_weight</code> in <code>per-capita-adjusted</code> approaches applies a multiplicative adjustment based on per-capita historical emissions. See Historical Responsibility.</p> <p>Further reading: Shue 2015, Meyer 2013, Matthews 2016, Heyward 2021, Morrow 2017</p>","boost":2},{"location":"science/climate-equity-concepts/#ability-to-pay","title":"Ability to Pay","text":"<p>Grounded in the capabilities approach (following Sen and Nussbaum), which focuses on what people are able to do and be [Klinsky 2018; Okereke 2016]. In fair-shares, this broad tradition is operationalized through the narrower \"ability to pay\" indicator (GDP per capita) as a proxy \u2014 a simplification that does not capture the full scope of the capabilities framework. This is a forward-looking principle that does not depend on past actions [Heyward 2021].</p> <p>Operationalized in: <code>capability_weight</code> in <code>per-capita-adjusted</code> approaches (see Allocation Approaches).</p> <p>Further reading: Caney 2010, Baer 2009, Morrow 2017, Klinsky 2018</p>","boost":2},{"location":"science/climate-equity-concepts/#protection-of-basic-needs","title":"Protection of Basic Needs","text":"<p>Grounded in sufficientarianism \u2014 ensuring everyone meets a basic threshold of well-being [Meyer 2013; Zimm 2024] \u2014 and the right to development [Okereke 2016]. The literature distinguishes between subsistence emissions (necessary for basic needs) and luxury emissions (discretionary consumption), arguing they are not morally equivalent [Shue 2014; Baer 2009].</p> <p>Operationalized in: Gini-adjusted approaches with income floor parameter (see Gini Adjustment)</p> <p>Further reading: Shue 2014, Baer 2009, Meyer 2013, Zimm 2024</p>","boost":2},{"location":"science/climate-equity-concepts/#core-practical-convergence","title":"Core Practical Convergence","text":"<p>Shue 2015 argues that several independent principles converge toward the same practical conclusions about who should bear climate responsibility:</p> Principle Grounding Application Contribution (Polluter Pays) Caused the problem through emissions Past emissions create current obligation Benefit (Beneficiary Pays) Gained from the problem through economic development Inherited infrastructure justifies burden Ability to Pay (Capability) Became able to act due to the problem Industrialization created capacity <p>The argument is that for nations ranking high on all three measures, the duty to act is \"overdetermined\" \u2014 supported by multiple independent lines of reasoning. This convergence is influential but not uncontested; see Shue 2015 for the full argument and its limitations.</p>","boost":2},{"location":"science/climate-equity-concepts/#key-distinctions","title":"Key Distinctions","text":"<p>Methodological choices in fair shares analysis. See Allocations for implementation details.</p>","boost":2},{"location":"science/climate-equity-concepts/#production-vs-consumption-accounting","title":"Production vs. Consumption Accounting","text":"Aspect Production-Based Consumption-Based Definition Emissions attributed where produced (territorial) Emissions attributed where goods consumed Rationale Emissions occur within national boundaries under national policy control; producer countries benefit economically Consumer countries drive demand for emissions-intensive goods; wealthy nations have outsourced emissions Implications Favors countries that import manufactured goods (net importers show lower emissions) Favors countries that export manufactured goods (net exporters show lower emissions)","boost":2},{"location":"science/climate-equity-concepts/#cumulative-vs-annual-emissions-framing","title":"Cumulative vs. Annual Emissions Framing","text":"Aspect Budget (Cumulative) Pathway (Annual) Definition Atmosphere as finite resource with fixed remaining budget Climate action as dynamic process with year-by-year fairness Rationale Provides clear total constraint; scientifically grounded in TCRE Provides year-by-year guidance; can adapt to changing circumstances Implications Answers \"What is each country's fair share of a fixed cumulative budget?\" Answers \"What is each country's fair share of emissions in each future year?\"","boost":2},{"location":"science/climate-equity-concepts/#within-country-inequality","title":"Within-Country Inequality","text":"Aspect Without Adjustment With Gini Adjustment Definition Uses national average GDP per capita as capability indicator Adjusts GDP per capita using Gini coefficient to reflect distribution Rationale Simpler; data widely available More accurate picture of actual population circumstances Implications Treats high-inequality countries as more capable than warranted Recognizes that two countries with same GDP per capita but different Gini have different distributional realities","boost":2},{"location":"science/climate-equity-concepts/#scientific-foundations","title":"Scientific Foundations","text":"<p>TCRE (Transient Climate Response to Cumulative Emissions): The approximately linear relationship between cumulative CO\u2082 emissions and temperature change [Matthews 2016]. This provides the scientific basis for treating cumulative emissions as the relevant metric. See IPCC AR6 WG1.</p> <p>Carbon Debt: Matthews 2016 quantifies carbon debts 1990-2013 totaling 250 billion tonnes CO\u2082. For net-zero carbon debt frameworks, see Pelz 2025b.</p>","boost":2},{"location":"science/climate-equity-concepts/#approaches-debated-in-the-literature","title":"Approaches Debated in the Literature","text":"<p>Several approaches appear in climate policy discussions and have been subject to scholarly critique.</p>","boost":2},{"location":"science/climate-equity-concepts/#grandfathering","title":"Grandfathering","text":"<p>Allocating future emission entitlements based on current emission shares. Critiqued by multiple authors as rewarding past high emissions with no ethical basis [Kartha 2018; Dooley 2021; Morrow 2017; Caney 2009]. The <code>per-capita-convergence</code> approach includes grandfathering elements and is available in fair-shares for comparison; see PCC.</p>","boost":2},{"location":"science/climate-equity-concepts/#bau-deviation-framing","title":"BAU Deviation Framing","text":"<p>Treating deviation from business-as-usual emissions as a cost or sacrifice. Pelz 2025a argues this framing is inconsistent with CBDR-RC because it treats current emission levels as a baseline entitlement.</p>","boost":2},{"location":"science/climate-equity-concepts/#small-share-justification","title":"Small Share Justification","text":"<p>Arguments of the form \"We only emit X% of global emissions.\" Winkler 2020 notes this cannot be universalized and conflates total with per capita emissions.</p>","boost":2},{"location":"science/climate-equity-concepts/#philosophical-challenges","title":"Philosophical Challenges","text":"<p>Climate equity reasoning confronts persistent theoretical difficulties, including the non-identity problem (if different policies had been pursued, different people would exist) and intergenerational justice (whether current generations bear responsibility for ancestors' emissions). Various responses have been proposed, including benefits-based framing [Meyer 2013; Heyward 2021] and sufficientarian thresholds [Meyer 2013; Zimm 2024]. These are active debates without settled answers. See Meyer 2013 and Caney 2018 for detailed discussion.</p>","boost":2},{"location":"science/climate-equity-concepts/#multi-dimensional-justice","title":"Multi-Dimensional Justice","text":"<p>The literature identifies multiple dimensions of justice beyond the distributive focus of this tool:</p> Dimension In brief Role in fair-shares Distributive Justice How benefits and burdens are allocated [Zimm 2024] Primary focus of allocation approaches Procedural Justice Fairness of decision-making processes [Klinsky 2018] Outside scope of this tool Corrective Justice Responses to historical wrongdoing [Zimm 2024] Informs historical responsibility framing Recognitional Justice How actors are characterized shapes consideration of their interests [Klinsky 2018] Transparency about value judgments supports this Transitional Justice How to sequence policy toward more just conditions [Zimm 2024] Pathway allocations address the temporal dimension <p>Further reading: Klinsky 2018, Okereke 2016, Zimm 2024</p>","boost":2},{"location":"science/climate-equity-concepts/#policy-context","title":"Policy Context","text":"<p>Fair share allocations are increasingly referenced in climate litigation and policy analysis [Rajamani 2024]. For discussions of loss and damage, climate finance, and just transition, see Okereke 2016, Morrow 2017, Muttitt 2020, and References.</p>","boost":2},{"location":"science/climate-equity-concepts/#see-also","title":"See Also","text":"<p>Within fair-shares:</p> <ul> <li>Allocation Approaches \u2014 Design choices for budget and pathway allocations</li> <li>Other Operations \u2014 Harmonization, RCB pathways, validation</li> <li>API Reference: Budgets | Pathways \u2014 Mathematical formulations</li> <li>country-fair-shares Guide \u2014 Practical guidance</li> <li>References \u2014 Complete bibliography with annotations</li> </ul> <p>Key starting points in the literature:</p> <ul> <li>Shue 2015 \u2014 Core practical convergence argument</li> <li>Meyer 2013 \u2014 Historical emissions and intergenerational justice</li> <li>Caney 2021 \u2014 Climate Justice (Stanford Encyclopedia overview)</li> <li>Dooley 2021 \u2014 Ethical choices behind fair share quantifications</li> <li>Pelz 2025a \u2014 Entry points framework for NDC fairness</li> <li>Klinsky 2018 \u2014 Building equity into climate modelling</li> <li>Kartha 2018 \u2014 Cascading biases in allocation approaches</li> </ul>","boost":2},{"location":"science/glossary/","title":"Glossary","text":"<p>This page provides definitions for key terms used throughout the fair-shares documentation and codebase.</p>"},{"location":"science/glossary/#allocation-approaches","title":"Allocation Approaches","text":"<p>All approach names use <code>kebab-case</code> notation. See the Approach Catalog for complete details.</p>"},{"location":"science/glossary/#budget-approaches","title":"Budget Approaches","text":"<code>equal-per-capita-budget</code> Allocates a cumulative carbon budget proportional to population shares at the allocation year. Operationalizes the equal rights to atmosphere principle without historical responsibility or capability adjustments. See: API Reference \u00b7 Egalitarianism <code>per-capita-adjusted-budget</code> Allocates a cumulative carbon budget based on population, adjusted by historical responsibility and economic capability. Operationalizes CBDR-RC principles. See: API Reference \u00b7 CBDR-RC <code>per-capita-adjusted-gini-budget</code> Allocates a cumulative carbon budget with responsibility and capability adjustments, accounting for intra-national inequality via the Gini coefficient. Operationalizes capability (ability to pay) with subsistence protection. See: API Reference \u00b7 Subsistence Protection"},{"location":"science/glossary/#pathway-approaches-standard","title":"Pathway Approaches (Standard)","text":"<code>equal-per-capita</code> Allocates annual emissions along a pathway proportional to population shares. Equal rights to atmosphere principle applied year-by-year. See: API Reference \u00b7 Egalitarianism <code>per-capita-adjusted</code> Allocates annual emissions along a pathway with historical responsibility and capability adjustments. CBDR-RC principles applied year-by-year. See: API Reference \u00b7 CBDR-RC <code>per-capita-adjusted-gini</code> Allocates annual emissions along a pathway with responsibility, capability, and inequality adjustments. Includes subsistence protection. See: API Reference \u00b7 Subsistence Protection"},{"location":"science/glossary/#pathway-approaches-convergence","title":"Pathway Approaches (Convergence)","text":"<code>per-capita-convergence</code> Transitions from current emission patterns toward equal per capita emissions by a convergence year. Note: Privileges current emission patterns during transition and is not considered a fair share approach. See: API Reference \u00b7 Convergence <code>cumulative-per-capita-convergence</code> Budget-preserving convergence approach that distributes equal cumulative per capita shares from current emissions over time. Preserves cumulative per capita totals while creating smooth transition pathways. Can lead to steep curves when starting from current emissions. This is a fair share approach (unlike <code>per-capita-convergence</code> which includes grandfathering). See: API Reference \u00b7 Historical Responsibility <code>cumulative-per-capita-convergence-adjusted</code> Cumulative convergence approach with additional historical responsibility and capability adjustments via weighting parameters. See: API Reference <code>cumulative-per-capita-convergence-gini-adjusted</code> Cumulative convergence approach with responsibility, capability, and inequality adjustments. See: API Reference"},{"location":"science/glossary/#parameters","title":"Parameters","text":""},{"location":"science/glossary/#core-parameters","title":"Core Parameters","text":"<code>allocation_year</code> (type: <code>int</code>) The year when entitlements begin. Operationalizes historical responsibility: earlier years imply historical over-emitters have already consumed their fair share from that date forward. No neutral default\u2014this is a normative choice. Constraints: Must be \u2265 <code>historical_responsibility_year</code> if responsibility adjustment is used See: Parameter Effects \u00b7 Historical Responsibility <code>convergence_year</code> (type: <code>int</code>) Target year by which per capita emissions converge to equality. Used only in convergence approaches. Constraints: Must be &gt; <code>allocation_year</code> See: Convergence <code>emission_category</code> (type: <code>str</code>) The emission species being allocated (e.g., <code>\"CO2\"</code>, <code>\"Kyoto GHG\"</code>). Must match data sources. See: Allocation Approaches <code>group_level</code> (type: <code>str</code>, default: <code>\"iso3c\"</code>) MultiIndex level representing countries/regions (typically <code>\"iso3c\"</code> for ISO 3166-1 alpha-3 codes). See: TimeseriesDataFrame"},{"location":"science/glossary/#adjustment-weights","title":"Adjustment Weights","text":"<p>All weights must satisfy: <code>responsibility_weight + capability_weight \u2264 1.0</code></p> <code>responsibility_weight</code> (type: <code>float</code>, range: <code>[0.0, 1.0]</code>, default: <code>0.0</code>) Weight for historical responsibility adjustment. Reduces allocation for countries with higher historical emissions. Constraints: <code>0.0 \u2264 responsibility_weight \u2264 1.0</code>, requires <code>country_actual_emissions_ts</code> if &gt; 0 See: Parameter Effects \u00b7 Historical Responsibility <code>capability_weight</code> (type: <code>float</code>, range: <code>[0.0, 1.0]</code>, default: <code>0.0</code>) Weight for capability (ability to pay) adjustment. Reduces allocation for countries with higher GDP per capita. Constraints: <code>0.0 \u2264 capability_weight \u2264 1.0</code>, requires <code>gdp_ts</code> if &gt; 0 See: Parameter Effects \u00b7 Capability"},{"location":"science/glossary/#responsibility-parameters","title":"Responsibility Parameters","text":"<code>historical_responsibility_year</code> (type: <code>int</code>, default: <code>1990</code>) Starting year for cumulative historical emissions accounting. Must be \u2264 <code>allocation_year</code>. See: Parameter Effects \u00b7 Historical Responsibility <code>responsibility_per_capita</code> (type: <code>bool</code>, default: <code>True</code>) If <code>True</code>, calculate responsibility adjustment using per capita emissions. If <code>False</code>, use absolute emissions. See: Historical Responsibility <code>responsibility_exponent</code> (type: <code>float</code>, default: <code>1.0</code>) Exponent applied to responsibility adjustment. Values &gt; 1.0 increase non-linearity. See: Historical Responsibility <code>responsibility_functional_form</code> (type: <code>str</code>, default: <code>\"asinh\"</code>) Functional form for responsibility adjustment. Options: <code>\"asinh\"</code> (inverse hyperbolic sine), <code>\"power\"</code>. See: Historical Responsibility"},{"location":"science/glossary/#capability-parameters","title":"Capability Parameters","text":"<code>capability_per_capita</code> (type: <code>bool</code>, default: <code>True</code>) If <code>True</code>, calculate capability adjustment using GDP per capita. If <code>False</code>, use absolute GDP. See: Capability <code>capability_exponent</code> (type: <code>float</code>, default: <code>1.0</code>) Exponent applied to capability adjustment. Values &gt; 1.0 increase non-linearity. See: Capability <code>capability_functional_form</code> (type: <code>str</code>, default: <code>\"asinh\"</code>) Functional form for capability adjustment. Options: <code>\"asinh\"</code>, <code>\"power\"</code>. See: Capability"},{"location":"science/glossary/#inequality-parameters","title":"Inequality Parameters","text":"<code>income_floor</code> (type: <code>float</code>, range: <code>[0.0, \u221e)</code>, default: <code>0.0</code>) Minimum income threshold (in GDP per capita units). Income below this level is excluded from capability calculations via the Gini adjustment. Implements subsistence protection. See: Parameter Effects \u00b7 Subsistence Protection <code>max_gini_adjustment</code> (type: <code>float</code>, range: <code>[0.0, 1.0]</code>, default: <code>0.8</code>) Maximum magnitude of Gini-based allocation adjustment. Caps the effect of within-country inequality. See: Subsistence Protection"},{"location":"science/glossary/#constraint-parameters","title":"Constraint Parameters","text":"<code>max_deviation_sigma</code> (type: <code>float | None</code>, default: <code>2.0</code>) Standard deviations from mean for outlier detection. If not <code>None</code>, constrains extreme allocations. See: Allocation Approaches <code>preserve_allocation_year_shares</code> / <code>preserve_first_allocation_year_shares</code> (type: <code>bool</code>, default: <code>False</code>) If <code>True</code>, allocations use population shares at the allocation year only, rather than recalculating dynamically. Budget approaches use <code>preserve_allocation_year_shares</code>; pathway approaches use <code>preserve_first_allocation_year_shares</code>. See: Allocation Approaches"},{"location":"science/glossary/#result-types","title":"Result Types","text":""},{"location":"science/glossary/#budgetallocationresult","title":"BudgetAllocationResult","text":"<p>Container for budget allocation results. Contains relative shares of a cumulative carbon budget.</p> <p>Attributes:</p> <ul> <li><code>approach</code> (str): Name of allocation approach (e.g., <code>\"equal-per-capita-budget\"</code>)</li> <li><code>parameters</code> (dict): Parameter values used for allocation</li> <li><code>relative_shares_cumulative_emission</code> (TimeseriesDataFrame): Relative shares (fractions summing to 1.0) for each country. Has exactly one year column representing the allocation year.</li> <li><code>country_warnings</code> (dict[str, str] | None): Optional warnings about data quality issues</li> </ul> <p>Methods:</p> <ul> <li><code>get_absolute_budgets(remaining_budget)</code>: Multiply relative shares by a global budget to get absolute country-level budgets</li> </ul> <p>See: Budget Approaches</p>"},{"location":"science/glossary/#pathwayallocationresult","title":"PathwayAllocationResult","text":"<p>Container for pathway allocation results. Contains relative shares of annual emissions across multiple years.</p> <p>Attributes:</p> <ul> <li><code>approach</code> (str): Name of allocation approach (e.g., <code>\"per-capita-adjusted\"</code>)</li> <li><code>parameters</code> (dict): Parameter values used for allocation</li> <li><code>relative_shares_pathway_emissions</code> (TimeseriesDataFrame): Relative shares (fractions summing to 1.0) for each country and year. Has multiple year columns.</li> <li><code>country_warnings</code> (dict[str, str] | None): Optional warnings about data quality issues</li> </ul> <p>Methods:</p> <ul> <li><code>get_absolute_emissions(annual_emissions_budget)</code>: Multiply relative shares by global annual budgets to get absolute country-level pathways</li> </ul> <p>See: Pathway Approaches</p>"},{"location":"science/glossary/#data-structures","title":"Data Structures","text":""},{"location":"science/glossary/#timeseriesdataframe","title":"TimeseriesDataFrame","text":"<p>A <code>pandas.DataFrame</code> with a <code>pandas.MultiIndex</code> and year columns. The standard structure for all timeseries data in fair-shares.</p> <p>Index levels (in order):</p> <ol> <li><code>iso3c</code> (str): ISO 3166-1 alpha-3 country code (e.g., <code>\"USA\"</code>, <code>\"IND\"</code>, <code>\"DEU\"</code>)</li> <li><code>unit</code> (str): Physical unit for the data (e.g., <code>\"Mt CO2/yr\"</code>, <code>\"billion 2011 USD\"</code>)</li> <li><code>emission-category</code> (str): Emission species (e.g., <code>\"CO2\"</code>, <code>\"Kyoto GHG\"</code>)</li> </ol> <p>Columns:</p> <ul> <li>Year columns as strings (e.g., <code>\"2020\"</code>, <code>\"2021\"</code>, ...)</li> <li>Important: Year columns must be strings, not integers. Use <code>ensure_string_year_columns(df)</code> after loading data.</li> </ul> <p>Example:</p> Python<pre><code>                                            2020    2021    2022\niso3c  unit       emission-category\nUSA    Mt CO2/yr  CO2                      5000    4900    4800\nIND    Mt CO2/yr  CO2                      2500    2600    2700\nWorld  Mt CO2/yr  CO2                     35000   34500   34000\n</code></pre> <p>See: Function Signature for implementation details</p>"},{"location":"science/glossary/#multiindex","title":"MultiIndex","text":"<p>A hierarchical index for pandas DataFrames. All fair-shares data uses a 3-level MultiIndex with levels <code>[\"iso3c\", \"unit\", \"emission-category\"]</code>.</p> <p>Operations like <code>.loc[]</code>, <code>.xs()</code>, and <code>.groupby()</code> can select/aggregate along specific index levels.</p> <p>See: pandas MultiIndex documentation</p>"},{"location":"science/glossary/#equity-principles","title":"Equity Principles","text":""},{"location":"science/glossary/#cbdr-rc","title":"CBDR-RC","text":"<p>Common But Differentiated Responsibilities and Respective Capabilities. Foundational principle of the UNFCCC recognizing that:</p> <ol> <li>All countries share responsibility for addressing climate change</li> <li>Historical emissions and economic capacity create differentiated responsibilities</li> <li>Developed countries should take the lead given their historical contribution and greater means</li> </ol> <p>Operationalized via <code>responsibility_weight</code> and <code>capability_weight</code> parameters.</p> <p>See: CBDR-RC \u00b7 Climate Equity Concepts</p>"},{"location":"science/glossary/#egalitarianism-ethical-tradition","title":"Egalitarianism (Ethical Tradition)","text":"<p>A framework of distributive justice that emphasizes equal treatment and equal rights among all persons. In climate equity, egalitarianism grounds the principle of equal rights to the atmosphere.</p> <p>See: Egalitarianism \u00b7 Climate Equity Concepts</p>"},{"location":"science/glossary/#equal-rights-to-atmosphere-principle","title":"Equal Rights to Atmosphere (Principle)","text":"<p>The principle that every person has an equal per capita entitlement to atmospheric space. Derives from egalitarian ethical tradition. Every person has an equal claim to emit greenhouse gases.</p> <p>Operationalized by setting <code>responsibility_weight = 0</code> and <code>capability_weight = 0</code>.</p> <p>See: Egalitarianism \u00b7 Climate Equity Concepts</p>"},{"location":"science/glossary/#grandfathering","title":"Grandfathering","text":"<p>Allocates future entitlements based on current emission shares. Widely critiqued in the climate equity literature as lacking ethical basis, since it rewards past over-consumption (see Morrow 2017, Caney 2009). The <code>per-capita-convergence</code> approach contains grandfathering elements and is included for comparison with equity-based approaches.</p> <p>See: Approaches Debated in the Literature \u00b7 Per-capita Convergence</p>"},{"location":"science/glossary/#historical-responsibility","title":"Historical Responsibility","text":"<p>The principle that countries should bear differentiated responsibilities based on their cumulative historical emissions. Past emissions have consumed limited atmospheric capacity.</p> <p>Operationalized via:</p> <ul> <li><code>allocation_year</code> (earlier years = more historical responsibility)</li> <li><code>responsibility_weight</code> (direct adjustment based on historical emissions)</li> <li>Cumulative approaches (e.g., <code>cumulative-per-capita-convergence</code>)</li> </ul> <p>See: Historical Responsibility \u00b7 Climate Equity Concepts</p>"},{"location":"science/glossary/#subsistence-protection","title":"Subsistence Protection","text":"<p>The principle that basic needs for development should be protected when allocating emission rights. Poor populations should not be penalized for within-country inequality.</p> <p>Operationalized via:</p> <ul> <li><code>income_floor</code> (exempts low-income populations from Gini adjustment)</li> <li>Gini-adjusted approaches (account for intra-national inequality)</li> </ul> <p>See: Subsistence Protection \u00b7 Climate Equity Concepts</p>"},{"location":"science/glossary/#abbreviations","title":"Abbreviations","text":"API Application Programming Interface. In this documentation, refers to the function-level reference for allocation approaches. AR6 IPCC Sixth Assessment Report (2021-2023). Source of global emissions scenarios used in fair-shares. BAU Business As Usual. Baseline emissions scenario without climate policy. Note: framing deviation from BAU as a \"cost\" or \"sacrifice\" has been critiqued in the literature as inconsistent with CBDR-RC (see Kartha 2018). GDP Gross Domestic Product. Economic output measure used for capability adjustments. GHG Greenhouse Gas (e.g., CO2, CH4, N2O). \"Kyoto GHG\" refers to the basket of gases covered by the Kyoto Protocol. IAMC Integrated Assessment Modeling Consortium. Data format used for AR6 scenarios. IPCC Intergovernmental Panel on Climate Change. ISO 3166-1 alpha-3 Three-letter country codes (e.g., <code>USA</code>, <code>IND</code>, <code>DEU</code>). Standard for the <code>iso3c</code> index level. Mt CO2/yr Megatonnes of CO2 per year. Common unit for annual emissions. PRIMAP-hist Historical emissions dataset from PIK (Potsdam Institute for Climate Impact Research). RCB Remaining Carbon Budget. The amount of CO2 that can still be emitted while staying within a temperature target (e.g., 1.5\u00b0C). SSP Shared Socioeconomic Pathway. Scenarios combining socioeconomic projections with climate mitigation levels (e.g., SSP1-1.9, SSP2-4.5). TCRE Transient Climate Response to Cumulative Emissions. The near-linear relationship between cumulative CO2 emissions and global temperature increase. UNFCCC United Nations Framework Convention on Climate Change."},{"location":"science/other-operations/","title":"Other Operations","text":"<p>Operations that support allocation calculations: scenario harmonization, RCB pathway generation, data preprocessing, and validation.</p>"},{"location":"science/other-operations/#scenario-harmonization","title":"Scenario Harmonization","text":""},{"location":"science/other-operations/#harmonization-with-convergence","title":"Harmonization with Convergence","text":"<p>Aligns emission pathways with historical data at an anchor year, then converges back to the original scenario trajectory.</p> <ol> <li>Replace scenario values with historical data for years \u2264 anchor year</li> <li>Linearly interpolate for anchor year &lt; year &lt; convergence year</li> <li>Use original scenario values for years \u2265 convergence year</li> </ol> <p>Implementation \u2192 | <code>src/fair_shares/library/utils/timeseries.py</code></p>"},{"location":"science/other-operations/#cumulative-peak-preservation","title":"Cumulative Peak Preservation","text":"<p>Preserves the peak cumulative emissions using time-varying scaling when <code>preserve_cumulative_peak=True</code>.</p> <p>Implementation \u2192 | <code>src/fair_shares/library/utils/timeseries.py</code></p>"},{"location":"science/other-operations/#net-negative-emissions-handling","title":"Net-Negative Emissions Handling","text":"<p>Sets post-net-zero emissions to NaN with warnings. Pre-net-zero emissions are preserved unchanged.</p> <p>Implementation \u2192 | <code>src/fair_shares/library/utils/dataframes.py::set_post_net_zero_emissions_to_nan</code></p>"},{"location":"science/other-operations/#rcb-pathway-generation","title":"RCB Pathway Generation","text":"<p>Converts fixed carbon budget values into annual emission pathways using normalized shifted exponential decay:</p> <ol> <li>Pathway starts at historical emissions</li> <li>Reaches exactly zero by end year</li> <li>Discrete sum equals the carbon budget</li> </ol> <p>Implementation \u2192 | <code>src/fair_shares/library/utils/math/pathways.py</code></p>"},{"location":"science/other-operations/#data-preprocessing","title":"Data Preprocessing","text":""},{"location":"science/other-operations/#interpolation","title":"Interpolation","text":"<p>Fills missing values using linear or stepwise interpolation.</p> <p>Implementation \u2192 | <code>src/fair_shares/library/utils/timeseries.py::interpolate_scenarios_data</code></p>"},{"location":"science/other-operations/#unit-conversion","title":"Unit Conversion","text":"<p>Standardizes units (emissions: kt/Mt/Gt CO2e, population: million).</p> <p>Implementation \u2192 | <code>src/fair_shares/library/utils/units.py</code></p>"},{"location":"science/other-operations/#data-validation","title":"Data Validation","text":""},{"location":"science/other-operations/#timeseriesdataframe-validation","title":"TimeseriesDataFrame Validation","text":"<p>Validates structure (MultiIndex format) and content (non-negative values, complete time series).</p> <p>Implementation \u2192 | <code>src/fair_shares/library/validation/pipeline_validation.py</code></p>"},{"location":"science/other-operations/#cross-dataset-validation","title":"Cross-Dataset Validation","text":"<p>Verifies analysis countries + ROW = world totals, and ensures temporal/spatial alignment.</p> <p>Implementation \u2192 | <code>src/fair_shares/library/validation/pipeline_validation.py</code></p>"},{"location":"science/other-operations/#data-completeness","title":"Data Completeness","text":""},{"location":"science/other-operations/#analysis-country-selection","title":"Analysis Country Selection","text":"<p>Identifies countries with complete data across all datasets and computes Rest of World totals for remaining countries.</p> <p>Implementation \u2192 | <code>src/fair_shares/library/utils/data/completeness.py</code></p>"},{"location":"science/other-operations/#world-total-extraction","title":"World Total Extraction","text":"<p>Extracts world totals for validation. Supports keys: \"EARTH\", \"WLD\", \"World\".</p> <p>Implementation \u2192 | <code>src/fair_shares/library/utils/data/completeness.py</code></p>"},{"location":"science/other-operations/#see-also","title":"See Also","text":"<ul> <li>Allocation Approaches \u2014 Design choices</li> <li>API Reference \u2014 Function documentation</li> </ul>"},{"location":"science/parameter-effects/","title":"Parameter Effects Reference","text":"<p>This guide shows how key parameters affect allocation outcomes using real data for representative countries:</p> <ul> <li>USA: High historical emissions, high GDP per capita</li> <li>India: Large population, lower historical emissions per capita</li> <li>Germany: Medium population, high historical emissions and GDP per capita</li> </ul> <p>All examples use real data from PRIMAP (emissions), UN/OWID (population), World Bank (GDP), and UNU-WIDER (Gini).</p> <p>Reproducing examples: Examples are generated by <code>notebooks/docs/parameter_effects_examples.py</code>. Run <code>uv run python notebooks/docs/parameter_effects_examples.py</code> to regenerate with updated data.</p>","boost":2},{"location":"science/parameter-effects/#allocation_year-budget-first_allocation_year-pathway","title":"allocation_year (Budget) / first_allocation_year (Pathway)","text":"<p>Effect: Earlier allocation years increase the weight of historical population patterns. For equal-per-capita approaches, this affects shares based on when countries had different population distributions.</p> <p>Direction:</p> <ul> <li>Earlier years \u2192 Allocations reflect historical population distributions</li> <li>Later years \u2192 Allocations reflect current population distributions</li> </ul> <p>Example: <code>equal-per-capita-budget</code> with varying <code>allocation_year</code></p> Country allocation_year=2020 allocation_year=1990 allocation_year=1900 USA 4.0% 4.1% 4.4% India 16.7% 16.9% 16.7% Germany 0.8% 0.9% 1.2% <p>Example uses 1.5\u00b0C carbon budget (50% probability). The <code>allocation_year</code> parameter is what varies across columns.</p> <p>Key insight: For equal-per-capita allocation, the <code>allocation_year</code> determines the starting year for cumulative population accounting. Earlier allocation years use cumulative population over a longer historical period, which can shift shares if countries' relative population sizes have changed over time. The effect is limited here because global population shares are relatively stable across these periods.</p> <p>Mathematical detail: See equal_per_capita_budget API</p> <p>Theoretical basis: See Egalitarianism</p>","boost":2},{"location":"science/parameter-effects/#responsibility_weight","title":"responsibility_weight","text":"<p>Effect: Controls the strength of historical responsibility adjustments. Higher values penalize countries with high cumulative historical emissions.</p> <p>Direction:</p> <ul> <li><code>weight=0.0</code> \u2192 No historical responsibility adjustment (equal per capita)</li> <li><code>weight=0.5</code> \u2192 Moderate adjustment based on historical emissions</li> <li><code>weight=1.0</code> \u2192 Full adjustment (maximum penalty for historical emissions)</li> </ul> <p>Example: <code>per-capita-adjusted-budget</code> varying <code>responsibility_weight</code> (with <code>capability_weight=0.0</code>)</p> Country weight=0.0 weight=0.5 weight=1.0 USA 4.0% 0.5% 0.5% India 16.7% 8.2% 8.2% Germany 0.8% 0.1% 0.1% <p>Example uses <code>allocation_year=2020</code>, <code>historical_responsibility_year=1990</code>.</p> <p>Key insight: Historical responsibility substantially reduces shares for high-emitting developed countries (USA: 4.0% to 0.5%, Germany: 0.8% to 0.1%). India's share also decreases (16.7% to 8.2%) because the adjustment redistributes toward countries with the lowest per capita historical emissions, which are not shown in this three-country excerpt. The effect saturates between <code>weight=0.5</code> and <code>weight=1.0</code> in this example because historical emissions differences are so large.</p> <p>Mathematical detail: See per_capita_adjusted_budget API</p> <p>Theoretical basis: See Polluter Pays / Historical Responsibility</p>","boost":2},{"location":"science/parameter-effects/#capability_weight","title":"capability_weight","text":"<p>Effect: Controls the strength of capability (ability to pay) adjustments. Higher values reduce allocations for wealthy countries.</p> <p>Direction:</p> <ul> <li><code>weight=0.0</code> \u2192 No capability adjustment (equal per capita)</li> <li><code>weight=0.5</code> \u2192 Moderate adjustment based on GDP per capita</li> <li><code>weight=1.0</code> \u2192 Full adjustment (maximum reduction for high GDP)</li> </ul> <p>Example: <code>per-capita-adjusted-budget</code> varying <code>capability_weight</code> (with <code>responsibility_weight=0.0</code>)</p> Country weight=0.0 weight=0.5 weight=1.0 USA 4.0% 3.4% 3.4% India 16.7% 16.9% 16.9% Germany 0.8% 0.7% 0.7% <p>Example uses <code>allocation_year=2020</code>.</p> <p>Key insight: Capability adjustments have a smaller magnitude effect than historical responsibility adjustments. Wealthy countries see modest reductions (USA: 4.0% \u2192 3.4%, Germany: 0.8% \u2192 0.7%) while lower-GDP countries see small increases (India: 16.7% \u2192 16.9%). The effect also saturates between <code>weight=0.5</code> and <code>weight=1.0</code>.</p> <p>Mathematical detail: See per_capita_adjusted_budget API</p> <p>Theoretical basis: See Ability to Pay (Capability)</p>","boost":2},{"location":"science/parameter-effects/#income_floor","title":"income_floor","text":"<p>Effect: Sets a minimum income level for capability calculations, protecting subsistence needs. Income below this threshold is excluded from capability adjustments.</p> <p>Direction:</p> <ul> <li><code>floor=0</code> \u2192 All income counts toward capability</li> <li><code>floor=7500</code> \u2192 Moderate protection for basic needs</li> <li><code>floor=15000</code> \u2192 Strong protection for basic needs</li> </ul> <p>Example: <code>per-capita-adjusted-gini-budget</code> varying <code>income_floor</code> (with <code>capability_weight=0.5</code>)</p> Country floor=0 floor=7500 floor=15000 USA 3.4% 3.2% 3.1% India 16.9% 16.5% 16.6% Germany 0.7% 0.6% 0.6% <p>Example uses <code>allocation_year=2020</code>, Gini-adjusted capability calculation.</p> <p>Key insight: Income floor effects are modest but principled. Higher floors slightly reduce the capability penalty for wealthy countries (USA: 3.4% \u2192 3.1%) by recognizing that subsistence needs should not count as \"ability to pay\". The effect is nonlinear and depends on income distribution (captured by Gini coefficients).</p> <p>Mathematical detail: See per_capita_adjusted_gini_budget API</p> <p>Theoretical basis: See Subsistence vs. Luxury Emissions</p>","boost":2},{"location":"science/parameter-effects/#combining-parameters","title":"Combining Parameters","text":"<p>Real allocation approaches combine multiple principles. Common patterns:</p>","boost":2},{"location":"science/parameter-effects/#moderate-equity-responsibility-capability","title":"Moderate Equity (Responsibility + Capability)","text":"Python<pre><code>per_capita_adjusted_budget(\n    responsibility_weight=0.5,\n    capability_weight=0.5,\n    historical_responsibility_year=1990,\n)\n</code></pre> <p>Balances historical emissions and ability to pay with equal per-capita baseline.</p>","boost":2},{"location":"science/parameter-effects/#strong-historical-accountability","title":"Strong Historical Accountability","text":"Python<pre><code>per_capita_adjusted_budget(\n    responsibility_weight=1.0,\n    capability_weight=0.0,\n    historical_responsibility_year=1850,  # Industrial revolution\n)\n</code></pre> <p>Maximum penalty for historical emissions since industrialization.</p>","boost":2},{"location":"science/parameter-effects/#development-protective-capability","title":"Development-Protective Capability","text":"Python<pre><code>per_capita_adjusted_gini_budget(\n    responsibility_weight=0.0,\n    capability_weight=1.0,\n    income_floor=7500,  # ~$20/day\n)\n</code></pre> <p>Adjusts for wealth while protecting subsistence needs.</p>","boost":2},{"location":"science/parameter-effects/#understanding-parameter-interactions","title":"Understanding Parameter Interactions","text":"","boost":2},{"location":"science/parameter-effects/#weight-saturation","title":"Weight Saturation","text":"<p>As shown in the examples above, adjustment weights often saturate - differences between <code>weight=0.5</code> and <code>weight=1.0</code> can be minimal when underlying data differences are large.</p>","boost":2},{"location":"science/parameter-effects/#parameter-sensitivity-ranking","title":"Parameter Sensitivity Ranking","text":"<p>Based on the examples:</p> <ol> <li><code>responsibility_weight</code> (largest effect) - Can change allocations by 3-4 percentage points</li> <li><code>capability_weight</code> (moderate effect) - Typically 0.5-1 percentage point changes</li> <li><code>income_floor</code> (smallest effect) - Typically &lt;0.5 percentage point changes</li> <li><code>allocation_year</code> (context-dependent) - Effect depends on historical population changes</li> </ol>","boost":2},{"location":"science/parameter-effects/#multi-parameter-trade-offs","title":"Multi-Parameter Trade-offs","text":"<p>When combining adjustments:</p> <ul> <li>High responsibility weight + high capability weight \u2192 Very low allocations for developed countries</li> <li>Low responsibility weight + moderate capability weight \u2192 Focus on current capacity to act</li> <li>Responsibility alone \u2192 \"Polluter pays\" framing</li> <li>Capability alone \u2192 \"Common but differentiated\" without historical accountability</li> </ul>","boost":2},{"location":"science/parameter-effects/#see-also","title":"See Also","text":"<ul> <li>Climate Equity Concepts - Theoretical foundations for each parameter</li> <li>Principle to Code - How equity principles map to parameters</li> <li>Approach Catalog - Pre-configured combinations for common scenarios</li> <li>API Documentation - Mathematical definitions and validation rules</li> </ul>","boost":2},{"location":"science/principle-to-code/","title":"From Principle to Code","text":"","boost":2},{"location":"science/principle-to-code/#why-principles-matter","title":"Why Principles Matter","text":"<p>Any allocation of a constrained carbon budget involves choices about what matters and who bears costs. As Dooley 2021 argues, there is no value-neutral position in this context -- every approach embeds assumptions, whether or not they are made explicit.</p> <p>The goal of this tool is normative transparency: making value judgments visible and replicable so that they can be examined and debated. Fair-shares helps you operationalize the principles you choose, whatever those principles are.</p> <p>Key insight: Define your principles first, then select the allocation approach that operationalizes those principles.</p>","boost":2},{"location":"science/principle-to-code/#principles-first-workflow","title":"Principles-First Workflow","text":"<p>Based on the Pelz et al. 2025 \"entry points\" framework. This workflow describes process, not what to decide.</p> <pre><code>flowchart LR\n    Start([Start]) --&gt; Step1[1. Identify&lt;br/&gt;Principles]\n    Step1 --&gt; Step2[2. Define&lt;br/&gt;Quantity]\n    Step2 --&gt; Step3[3. Choose&lt;br/&gt;Approach]\n    Step3 --&gt; Step4[4. Select&lt;br/&gt;Indicators]\n    Step4 --&gt; Step5[5. Communicate&lt;br/&gt;Results]\n    Step5 --&gt; End([Complete])\n\n    style Step1 fill:#e1f5e1\n    style Step2 fill:#e1f5e1\n    style Step3 fill:#e1f5e1\n    style Step4 fill:#e1f5e1\n    style Step5 fill:#e1f5e1</code></pre>","boost":2},{"location":"science/principle-to-code/#entry-points-framework","title":"Entry Points Framework","text":"Step What Question to Ask Yourself What It Determines 1. Identify Principles What values define fairness in this context? Should equal entitlement, historical responsibility, and/or economic capability matter? Which normative foundations guide the allocation. Determines whether you need adjustment parameters (responsibility/capability weights) or pure equal per capita. 2. Define Quantity Am I allocating a fixed carbon budget or defining emission pathways over time? What is the policy question I'm answering? Whether you use budget approaches (one-time allocation) or pathway approaches (annual trajectories). Budgets answer \"how much total?\"; pathways answer \"what trajectory?\" 3. Choose Approach Given my principles, which formulation operationalizes them? The specific allocation function and its parameters. Approach names encode key features (<code>adjusted</code> = responsibility+capability, <code>gini-adjusted</code> = subsistence protection). 4. Select Indicators What data sources reflect my chosen principles? Which reference year for population/emissions/GDP? Do I need Gini coefficients? Data inputs to allocation functions. Population and emissions are foundational; GDP and Gini enable capability and subsistence adjustments. 5. Communicate Results Can someone else replicate my allocation from my stated principles and parameters? Have I made value judgments explicit? Transparency and reproducibility. Prevents \"black box\" allocations where principles are obscured by technical complexity. <p>Key insight: Start with principles, not approaches. Working backward from favorable allocations undermines scientific legitimacy.</p> <p>Resources: Allocation Approaches, Approach Catalog, Parameter Effects, Climate Equity Concepts</p>","boost":2},{"location":"science/principle-to-code/#quick-reference-navigate-to-principle-sections","title":"Quick Reference \u2014 Navigate to Principle Sections","text":"<p>Use this table to jump to detailed sections on each principle. Each section explains what it means, what questions you must answer, available building blocks, and trade-offs to consider.</p> Principle What It Addresses Egalitarianism Ethical tradition grounding equal per capita Historical Responsibility Past emissions create obligations Capability Economic capacity determines mitigation effort CBDR-RC Differentiated obligations under UNFCCC Subsistence Protection Basic needs emissions should be protected Convergence Smooth transition from current to fair share state <p>For implementation details: See Allocation Approaches for parameter specifications and function signatures.</p>","boost":2},{"location":"science/principle-to-code/#egalitarianism","title":"Egalitarianism","text":"<p>Egalitarianism is the ethical tradition grounding the principle of equal rights to the atmosphere (also called \"equal per capita\").</p>","boost":2},{"location":"science/principle-to-code/#what-it-means","title":"What It Means","text":"<p>The egalitarian tradition holds that each person globally has equal entitlement to atmospheric space. The atmosphere is a global commons that should be shared equally among all people. This principle of equal per capita distribution is the foundation of all approaches in fair-shares.</p> <ol> <li>Population reference year - Which year's population should determine allocation? Current population? Future projections?</li> <li>Temporal scope - Are you allocating a fixed cumulative budget (e.g., 1850-2050) or defining annual equal shares?</li> <li>Pure egalitarianism vs. adjustments - Should equal shares be the final allocation, or should they be adjusted for other principles (responsibility, capability, subsistence)?</li> </ol>","boost":2},{"location":"science/principle-to-code/#building-blocks-available","title":"Building Blocks Available","text":"<ul> <li>Equal per capita budgets - <code>equal_per_capita_budget()</code> allocates fixed carbon budgets proportional to population share</li> <li>Equal per capita pathways - <code>equal_per_capita()</code> allocates annual emissions proportional to population share in each year (immediate equal shares, no convergence)</li> <li>Cumulative per capita convergence pathways - <code>cumulative_per_capita_convergence()</code> creates pathways that preserve cumulative per capita shares by distributing them from current emissions over time. This is budget-preserving (same cumulative total as equal per capita budget) but can lead to steep curves when starting from current emissions. Not to be confused with <code>per-capita-convergence</code>, which is NOT budget-preserving and includes grandfathering elements.</li> </ul> <p>See: Equal Rights to Atmosphere for theory, Allocation Approaches for implementation.</p>","boost":2},{"location":"science/principle-to-code/#historical-responsibility-polluter-pays","title":"Historical Responsibility (Polluter Pays)","text":"","boost":2},{"location":"science/principle-to-code/#what-it-means_1","title":"What It Means","text":"<p>Countries bear responsibility proportional to cumulative historical emissions. Those who caused the climate problem through past emissions should bear greater costs of addressing it. This principle operationalizes UNFCCC's \"differentiated responsibilities\" and is grounded in both corrective justice (reparations for harm) and distributive justice (equalizing undeserved benefits from fossil-fueled development).</p> <ol> <li>Start date - When does responsibility begin? 1750 (full industrial history)? 1850 (data reliability)? 1990 (established scientific awareness via IPCC FAR)?</li> <li>Excusable ignorance - Should pre-1990 emissions count if scientific awareness was limited? Or does the beneficiary-pays framing (equalizing undeserved benefits) avoid the ignorance objection?</li> <li>Subsistence exemption - Should emissions needed for basic living standards be excluded from responsibility accounting?</li> <li>Compensation vs. redistribution - Are you assigning blame for wrongful emissions (compensation) or equalizing undeserved benefits (redistribution)?</li> <li>Responsibility weight - How much should historical emissions matter relative to other principles?</li> </ol>","boost":2},{"location":"science/principle-to-code/#building-blocks-available_1","title":"Building Blocks Available","text":"<ul> <li>Allocation year / first allocation year - Earlier years give greater weight to historical emissions by shrinking remaining budget for current/future emissions</li> <li>Responsibility weight (<code>responsibility_weight</code>) - In <code>*-adjusted</code> approaches (both budget and pathway), controls how much cumulative emissions reduce allocation</li> <li>Adjusted pathways - <code>per_capita_adjusted()</code> applies responsibility weighting to annual pathway allocations (immediate adjustment, no convergence)</li> <li>Climate debt accounting - Matthews (2016) methodology: debt = \u03a3 [actual emissions - (world emissions \u00d7 population fraction)]</li> </ul> <p>See: Polluter Pays for theory, Parameter Effects for examples.</p>","boost":2},{"location":"science/principle-to-code/#capability-ability-to-pay","title":"Capability (Ability to Pay)","text":"","boost":2},{"location":"science/principle-to-code/#what-it-means_2","title":"What It Means","text":"<p>Mitigation effort should be allocated according to economic capability. Those with greater resources can contribute more without threatening basic well-being. GDP-based adjustments create an inverse relationship: higher economic capacity results in smaller emission allocations (or greater mitigation obligations). This is a forward-looking principle\u2014unlike historical responsibility, it does not depend on past actions.</p> <ol> <li>Capability indicator - GDP per capita (aggregate economic capacity)? Income above development threshold (only surplus capacity counts)?</li> <li>Development threshold - Should capability only count income above subsistence levels? GDR framework uses $7,500/year (2010 PPP); other thresholds possible depending on definition of \"basic needs.\"</li> <li>Capability weight - How much should economic capacity matter relative to other principles? Weight of 1.0 means only capability matters; 0.5 balances capability with responsibility; 0.0 treats all countries equally regardless of wealth.</li> <li>Temporal reference - Which year's GDP determines capability? Current GDP reflects present capacity but changes annually. Historical average? Future projections?</li> <li>Purchasing power vs. market exchange rates - PPP-adjusted GDP (purchasing power) or market exchange rate GDP? PPP better reflects domestic capacity; market rates better reflect international finance capacity.</li> </ol>","boost":2},{"location":"science/principle-to-code/#building-blocks-available_2","title":"Building Blocks Available","text":"<ul> <li>Capability weight (<code>capability_weight</code>) - In <code>*-adjusted</code> approaches (both budget and pathway), controls how much GDP reduces emission allocation</li> <li>Adjusted pathways - <code>per_capita_adjusted()</code> applies capability weighting to annual pathway allocations (immediate adjustment, no convergence)</li> <li>Income floor (<code>income_floor</code>) - In <code>*-gini-adjusted</code> approaches, exempts income below threshold from capability accounting</li> <li>GDP per capita indicators - World Bank data with PPP adjustment available through fair-shares data sources</li> </ul> <p>See: Ability to Pay for theory, Parameter Effects for examples.</p>","boost":2},{"location":"science/principle-to-code/#cbdr-rc-common-but-differentiated-responsibilities-and-respective-capabilities","title":"CBDR-RC (Common But Differentiated Responsibilities and Respective Capabilities)","text":"","boost":2},{"location":"science/principle-to-code/#what-it-means_3","title":"What It Means","text":"<p>A cornerstone principle of the UNFCCC (1992). \"Common\" responsibilities acknowledge that all countries must act on climate, but these responsibilities are \"differentiated\" based on historical contribution to the problem and current economic capacity to address it. The Paris Agreement maintained this framework while adding \"in light of different national circumstances.\" The ICJ Advisory Opinion (2025) confirmed these are erga omnes obligations\u2014duties owed to the international community as a whole.</p> <ol> <li>Balance between responsibility and capability - How should historical emissions and economic capacity be weighted relative to each other? Equal weight? Capability dominant? Responsibility dominant?</li> <li>Operationalization of \"circumstances\" - What national circumstances beyond R&amp;C should differentiate obligations? Geography (climate vulnerability, renewable potential)? Development stage? Fossil fuel dependency for export revenue?</li> <li>Common baseline - What does \"common\" responsibility mean operationally? That all start from equal per capita? That all share same temperature goal? That all commit to domestic action regardless of allocation?</li> <li>Legal vs. political interpretation - CBDR-RC is legally binding under UNFCCC. How much should fair shares analysis reflect legal obligations vs. political feasibility?</li> </ol>","boost":2},{"location":"science/principle-to-code/#building-blocks-available_3","title":"Building Blocks Available","text":"<ul> <li><code>*-adjusted</code> approaches - Combine responsibility and capability through weighted adjustments to per capita baseline</li> <li>Responsibility weight + capability weight - Independently control how much each dimension matters</li> <li><code>*-gini-adjusted</code> approaches - Add subsistence protection through income floors and within-country inequality accounting</li> <li>UNFCCC classification - Annex I vs. Non-Annex I countries as rough proxy for differentiation (though increasingly outdated)</li> </ul> <p>See: CBDR-RC for theory, Allocation Approaches for implementation.</p>","boost":2},{"location":"science/principle-to-code/#subsistence-protection","title":"Subsistence Protection","text":"","boost":2},{"location":"science/principle-to-code/#what-it-means_4","title":"What It Means","text":"<p>This principle holds that not all emissions are morally equivalent. Emissions required for meeting basic needs (survival emissions) should be protected from mitigation burdens, while luxury emissions from high consumption can be restricted (Shue 2014). Income below development thresholds should not count toward mitigation capacity. The literature notes that this principle finds support across multiple philosophical traditions -- rights-based, utilitarian, contractarian, and egalitarian -- yet is often excluded from quantified approaches despite being foundational to UNFCCC's right to development.</p> <ol> <li>Development threshold - What income level defines subsistence vs. luxury? GDR framework uses $7,500/year (2010 PPP).</li> <li>Emissions vs. income protection - Should you exempt subsistence emissions (energy for cooking, heating, basic mobility) or subsistence income (capacity to purchase any goods, including mitigation)?</li> <li>Within-country inequality - Should capability account for income distribution within countries?</li> <li>Temporal dynamics - As countries develop and incomes rise, subsistence protection decreases. Should allocation adjust dynamically as populations move above threshold? Or fix threshold year for predictability?</li> </ol>","boost":2},{"location":"science/principle-to-code/#building-blocks-available_4","title":"Building Blocks Available","text":"<ul> <li>Income floor (<code>income_floor</code>) - In <code>*-gini-adjusted</code> approaches (both budget and pathway), exempts income below threshold from capability calculations</li> <li>Gini coefficient adjustments - Accounts for within-country inequality in capability assessments. High Gini \u2192 effective capability lower than GDP per capita suggests.</li> <li>Gini-adjusted pathways - <code>per_capita_adjusted_gini()</code> applies subsistence protection to annual pathway allocations (immediate adjustment, no convergence)</li> <li>Subsistence emissions accounting - Can be implemented through emission floors (not currently in core library but conceptually straightforward)</li> </ul> <p>See: Subsistence vs. Luxury for theory, Parameter Effects for examples.</p>","boost":2},{"location":"science/principle-to-code/#convergence","title":"Convergence","text":"","boost":2},{"location":"science/principle-to-code/#what-it-means_5","title":"What It Means","text":"<p>Convergence creates smooth pathways that gradually transition from current emissions toward fair share targets over time. This is ONE type of pathway approach\u2014pathways can also allocate immediately to fair shares without convergence (using functions like <code>equal_per_capita()</code>, <code>per_capita_adjusted()</code>, or <code>per_capita_adjusted_gini()</code>).</p> <p>Important distinction: fair-shares includes two types of convergence:</p> <ol> <li> <p>Cumulative per capita convergence (<code>cumulative-per-capita-convergence*</code>) - Budget-preserving fair share approaches that distribute equal cumulative per capita shares from current emissions. These are constrained to preserve cumulative totals and are considered fair share approaches.</p> </li> <li> <p>Per capita convergence (<code>per-capita-convergence</code>) - NOT budget-preserving, incorporates grandfathering elements by privileging current emission patterns. This is NOT considered a fair share approach and is included for comparison only.</p> </li> </ol> <p>Key questions when using convergence approaches:</p> <ol> <li>Pathway shape - Linear convergence? Exponential decline? Smooth vs. sharp transitions affect economic and political feasibility.</li> <li>Cumulative constraint - Should the pathway respect cumulative budget limits (i.e. reflect a fair share)?</li> <li>Initial conditions - Should pathway start from current actual emissions, or from an adjusted baseline?</li> </ol>","boost":2},{"location":"science/principle-to-code/#building-blocks-available_5","title":"Building Blocks Available","text":"<ul> <li>Convergence pathways - <code>cumulative_per_capita_convergence()</code> creates gradual transition pathways with cumulative budget constraints</li> <li>Immediate pathways (non-convergence) - <code>equal_per_capita()</code>, <code>per_capita_adjusted()</code>, <code>per_capita_adjusted_gini()</code> allocate to fair shares immediately in each year without gradual transition</li> <li>Convergence parameters - <code>first_allocation_year</code>, <code>convergence_year</code>, adjustment weights control convergence trajectory</li> <li>Adjusted convergence variants - <code>*-adjusted</code> and <code>*-gini-adjusted</code> versions available for convergence pathways, applying responsibility/capability logic to transition trajectories</li> </ul> <p>See: Convergence Mechanism for details.</p>","boost":2},{"location":"science/principle-to-code/#common-principle-combinations","title":"Common Principle Combinations","text":"<p>The following examples illustrate how principles combine in practice. Each configuration reflects specific value judgments\u2014they are not recommendations, but transparent demonstrations of how different ethical positions translate to allocation configurations.</p> <p>Note: The configurations below demonstrate the logic of combining principles, not prescriptions for which combinations you should use. Your task is to identify which principles matter for your analysis, then configure accordingly.</p>","boost":2},{"location":"science/principle-to-code/#example-1-equal-per-capita-egalitarian","title":"Example 1: Equal Per Capita (Egalitarian)","text":"<p>Value judgment: Equal entitlement to atmospheric space is the only relevant principle. Historical emissions and economic capability do not create differential obligations\u2014all that matters is equal per capita rights today.</p> <p>Configuration:</p> Python<pre><code>allocations = {\n    \"equal-per-capita-budget\": [\n        {\n            \"allocation_year\": [2020],\n            \"preserve_allocation_year_shares\": [False]\n        }\n    ]\n}\n# Run through allocation pipeline with data sources configured in conf/\n</code></pre> <p>What this reflects:</p> <ul> <li>No responsibility/capability weights \u2192 Historical emissions and wealth don't affect allocation</li> <li><code>allocation_year=2020</code> \u2192 Allocation based on 2020 population shares</li> <li><code>preserve_allocation_year_shares=False</code> \u2192 Shares adjust with population changes</li> </ul> <p>Distributional outcome: Countries with high population shares (India, China) receive proportionally large allocations. Historical emissions and GDP do not affect shares.</p> <p>Underlying reasoning: The atmosphere is treated as a global commons to be shared equally among all living persons.</p>","boost":2},{"location":"science/principle-to-code/#example-2-strong-cbdr-rc-responsibility-dominant","title":"Example 2: Strong CBDR-RC (Responsibility Dominant)","text":"<p>Value judgment: Historical responsibility is the primary basis for differentiation. Countries that caused the climate problem through cumulative emissions should bear proportionally greater mitigation burdens. Equal per capita provides the baseline, but historical excess emissions strongly reduce allocation.</p> <p>Configuration:</p> Python<pre><code>allocations = {\n    \"per-capita-adjusted-budget\": [\n        {\n            \"allocation_year\": [1990],\n            \"responsibility_weight\": [1.0],\n            \"capability_weight\": [0.0],\n            \"preserve_allocation_year_shares\": [False]\n        }\n    ]\n}\n# Run through allocation pipeline with data sources configured in conf/\n</code></pre> <p>What this reflects:</p> <ul> <li><code>allocation_year=1990</code> \u2192 Cumulative emissions from 1990-2020 count heavily</li> <li><code>responsibility_weight=1.0</code> \u2192 Full reduction in allocation for historical excess</li> <li><code>capability_weight=0.0</code> \u2192 GDP does not affect allocation</li> </ul> <p>Distributional outcome: Industrialized countries with high cumulative emissions (US, EU, Russia) receive very small or negative allocations. Countries with low historical emissions receive allocations above current emissions.</p> <p>Underlying reasoning: The polluter pays principle is paramount. Those who benefited from fossil-fueled development owe restitution through reduced future allocations.</p>","boost":2},{"location":"science/principle-to-code/#example-3-balanced-cbdr-rc-with-subsistence-protection","title":"Example 3: Balanced CBDR-RC with Subsistence Protection","text":"<p>Value judgment: Both historical responsibility and economic capability matter for differentiation, and basic needs emissions should be protected from capability assessments. This configuration operationalizes \"equity\" as a multidimensional concept combining polluter-pays, ability-to-pay, and subsistence protection principles.</p> <p>Configuration:</p> Python<pre><code>allocations = {\n    \"per-capita-adjusted-gini-budget\": [\n        {\n            \"allocation_year\": [2000],\n            \"responsibility_weight\": [0.5],\n            \"capability_weight\": [0.5],\n            \"income_floor\": [7500],\n            \"preserve_allocation_year_shares\": [False]\n        }\n    ]\n}\n# Run through allocation pipeline with data sources configured in conf/\n# Gini adjustment is automatic when gini data source is configured\n</code></pre> <p>What this reflects:</p> <ul> <li><code>allocation_year=2000</code> \u2192 Moderate historical accounting (post-Kyoto)</li> <li><code>responsibility_weight=0.5</code>, <code>capability_weight=0.5</code> \u2192 Balanced approach</li> <li><code>income_floor=7500</code> \u2192 Income below subsistence exempt from capability (GDR threshold, 2010 PPP)</li> <li>Gini data configured \u2192 Within-country inequality reduces effective capability</li> </ul> <p>Distributional outcome: Industrialized countries with high emissions AND high GDP (US, EU) face strong reductions. Least developed countries receive allocations above current emissions, protected by subsistence floor.</p> <p>Underlying reasoning: Climate equity is multidimensional. Historical harm creates obligations, current wealth determines capacity, and basic needs must be met before assessing mitigation capacity.</p>","boost":2},{"location":"science/principle-to-code/#example-4-immediate-pathway-with-capability-adjustment","title":"Example 4: Immediate Pathway with Capability Adjustment","text":"<p>Value judgment: Annual emissions should reflect fair shares immediately, not gradually converge. Economic capability should reduce allocations in each year, creating differentiated annual trajectories without grandfathering. This is a pathway approach (year-by-year allocations) but NOT a convergence approach (no gradual transition from current emissions).</p> <p>Configuration:</p> Python<pre><code>allocations = {\n    \"per-capita-adjusted\": [\n        {\n            \"first_allocation_year\": [2025],\n            \"capability_weight\": [0.5],\n            \"responsibility_weight\": [0.5]\n        }\n    ]\n}\n# Run through allocation pipeline with AR6 scenario data configured in conf/\n# This creates annual pathway allocations, NOT gradual convergence\n</code></pre> <p>What this reflects:</p> <ul> <li><code>first_allocation_year=2025</code> \u2192 Start pathway allocations from 2025</li> <li><code>capability_weight=0.5</code>, <code>responsibility_weight=0.5</code> \u2192 Balanced CBDR-RC in each year</li> <li>No convergence \u2192 Countries immediately receive fair shares in 2025, adjusted each year</li> <li>Immediate allocation \u2192 No grandfathering, high emitters get reduced shares immediately</li> </ul> <p>Distributional outcome: High-GDP, high-historical-emission countries (US, EU) face immediate strong reductions from current emissions. Low-income countries receive allocations above current emissions immediately. Year-by-year adjustments track population and GDP changes dynamically.</p> <p>Underlying reasoning: Fair shares should apply immediately, not phased in over time. Annual allocations respect both historical responsibility and current capacity without rewarding past excess through convergence.</p> <p>Contrast with convergence: This approach allocates fair shares immediately; convergence (Example 5) gradually transitions from current to fair shares, preserving inequality during the transition period.</p>","boost":2},{"location":"science/principle-to-code/#example-5-convergence-with-capability-adjustment","title":"Example 5: Convergence with Capability Adjustment","text":"<p>Value judgment: Immediate transition to equal per capita is economically disruptive and politically infeasible. A gradual pathway that converges to fair shares over time is necessary for transition planning, but economic capability should determine how fast countries converge and how much they pay for international support.</p> <p>Configuration:</p> Python<pre><code>allocations = {\n    \"cumulative-per-capita-convergence-adjusted\": [\n        {\n            \"first_allocation_year\": [2025],\n            \"capability_weight\": [0.3],\n            \"responsibility_weight\": [0.0]\n        }\n    ]\n}\n# Run through allocation pipeline with AR6 scenario data configured in conf/\n# Note: Use cumulative-per-capita-convergence-adjusted (not base convergence)\n# for capability/responsibility weighting\n</code></pre> <p>What this reflects:</p> <ul> <li><code>first_allocation_year=2025</code> \u2192 Begin convergence pathway from 2025</li> <li><code>capability_weight=0.3</code> \u2192 Wealth moderately reduces allocation</li> <li><code>responsibility_weight=0.0</code> \u2192 Historical emissions don't affect pathway</li> <li>Cumulative constraint \u2192 Total pathway emissions respect global budget</li> </ul> <p>Distributional outcome: Countries transition from current emissions toward cumulative per capita targets while preserving cumulative shares. High-emission countries have downward trajectories; low-emission countries have upward trajectories. Starting from current emissions means high emitters receive higher near-term allocations, but cumulative totals are budget-preserving (unlike <code>per-capita-convergence</code> which is NOT budget-preserving).</p> <p>Underlying reasoning: Cumulative per capita shares are the fair target, but immediate redistribution is impractical. Transition pathways balance long-term equity with near-term feasibility while preserving cumulative budgets.</p> <p>Contrast with immediate pathways: Cumulative per capita convergence creates gradual transitions from current emissions (preserving near-term inequality) while respecting cumulative budget constraints. Immediate pathways (Example 4) allocate fair shares from the start.</p>","boost":2},{"location":"science/principle-to-code/#example-6-development-first-minimal-differentiation","title":"Example 6: Development-First (Minimal Differentiation)","text":"<p>Value judgment: Development rights are paramount. Countries should be allowed to reach development thresholds before facing mitigation burdens. Only income above subsistence counts toward capability, and historical emissions before widespread scientific consensus (1990) should not create obligations.</p> <p>Configuration:</p> Python<pre><code>allocations = {\n    \"per-capita-adjusted-gini-budget\": [\n        {\n            \"allocation_year\": [1990],\n            \"responsibility_weight\": [0.2],\n            \"capability_weight\": [0.8],\n            \"income_floor\": [10000],\n            \"preserve_allocation_year_shares\": [False]\n        }\n    ]\n}\n# Run through allocation pipeline with data sources configured in conf/\n# Gini adjustment is automatic when gini data source is configured\n</code></pre> <p>What this reflects:</p> <ul> <li><code>allocation_year=1990</code> \u2192 Responsibility only for post-IPCC emissions</li> <li><code>responsibility_weight=0.2</code>, <code>capability_weight=0.8</code> \u2192 Capability matters more than history</li> <li><code>income_floor=10000</code> \u2192 Higher than GDR threshold (7500)\u2014broader subsistence definition</li> <li>Gini data configured \u2192 Within-country inequality affects effective capability</li> </ul> <p>Distributional outcome: Least developed countries receive allocations well above current emissions. High-income countries face strong capability reductions but light responsibility penalties.</p> <p>Underlying reasoning: The right to development takes precedence. Wealthy countries should lead mitigation because they have the capacity. Subsistence protection ensures development needs are met before mitigation burdens are assessed.</p>","boost":2},{"location":"science/principle-to-code/#what-this-tool-cannot-tell-you","title":"What This Tool Cannot Tell You","text":"<p>Fair-shares operationalizes principles -- it cannot tell you which principles to adopt. The following questions require normative judgment, and the literature contains diverse positions on each:</p> <ol> <li> <p>Which principles are morally relevant? \u2014 Should historical responsibility matter? Should capability determine obligations? These are philosophical questions about justice.</p> </li> <li> <p>Where do thresholds come from? \u2014 Income floors, responsibility start dates, convergence years involve value judgments about development rights and transition feasibility.</p> </li> <li> <p>What happens with negative allocations? \u2014 Many configurations result in soon-to-be negative allocations (carbon debts) for high historical emitters. Implementation mechanism (domestic mitigation vs. financial transfers) requires political specification.</p> </li> <li> <p>Is convergence ethically acceptable? \u2014 Convergence embeds grandfathering, rewarding past high emissions. The tool provides pure per-capita-convergence approaches for transparency, not endorsement. This is distinct from cumulative-per-capita-convergence, which starts with current per capita emissions but converges to cumulative per capita shares over time.</p> </li> <li> <p>Which temperature target? \u2014 Allocations depend on carbon budget, which depends on temperature target (1.5\u00b0C, 2\u00b0C) and probability threshold. These are risk tolerance decisions.</p> </li> </ol> <p>What the tool DOES provide:</p> <ul> <li>Operational transparency \u2014 Given your principles, what allocations follow?</li> <li>Sensitivity analysis \u2014 How do results change with different parameters?</li> <li>Replicability \u2014 Can others reproduce your results from your stated configuration?</li> </ul> <p>The gap between principles and policy: Fair shares allocations are reference points for assessing equity, not directly implementable policy. Moving from allocation to implementation requires additional specification: domestic mitigation vs. international support, cost-effectiveness, political feasibility, and more.</p>","boost":2},{"location":"science/references/","title":"References","text":"<p>Complete bibliography for the fair-shares project. All citations are drawn from curated rubrics reviewed for climate equity scholarship.</p> <p>Scope and contributions</p> <p>We draw on a working subset of the climate equity literature (~30 papers). The sources cited here are illustrative, not exhaustive -- the scholarly conversation is much broader. This collection will be expanded as the project develops. If you notice missing or misrepresented sources, we welcome corrections and additions.</p> <p>For context on how these inform allocation approaches, see:</p> <ul> <li>Climate Equity Concepts</li> <li>Allocation Approaches</li> <li>Other Operations</li> </ul> <p>Inline citations in <code>docs/science/</code> use <code>[Author YYYY]</code> format.</p> <p>[Baer 2009] Paul Baer, Tom Athanasiou, Sivan Kartha, and Eric Kemp-Benedict. \"Greenhouse Development Rights: A Proposal for a Fair Global Climate Treaty.\" Ethics, Place and Environment. DOI: 10.1080/13668790903195495</p> <p>Original GDR framework combining responsibility and capability using development thresholds.</p> <p>[Baer 2013] Paul Baer. \"The greenhouse development rights framework for global burden sharing: reflection on principles and prospects.\" WIREs Climate Change. DOI: 10.1002/wcc.201</p> <p>Reflection on GDR principles and implementation challenges.</p> <p>[Bode 2004] Sven Bode. \"Equal Emissions Per Capita Over Time - A Proposal to Combine Responsibility and Equity of Rights for Post-2012 GHG Emission Entitlement Allocation.\" European Environment. DOI: 10.1002/eet.359</p> <p>Early per-capita convergence proposal balancing historical responsibility and equal rights.</p> <p>[Budolfson 2021] Mark B. Budolfson, Francis Dennig, Frank Errickson, Simon Feindt, Maddalena Ferranna, Marc Fleurbaey, David Klenert, Ulrike Kornek, Kevin Kuruc, Adrien M\u00e9jean, Wei Peng, Noah Scovronick, Dean Spears, Fabian Wagner, and St\u00e9phane Zuber. \"Utilitarian benchmarks for emissions and pledges promote equity, climate and development.\" Nature Climate Change. DOI: 10.1038/s41558-021-01130-6</p> <p>Utilitarian welfare-based approach to emissions allocation and NDC assessment.</p> <p>[Caney 2009] Simon Caney. \"Justice and the distribution of greenhouse gas emissions.\" Journal of Global Ethics. DOI: 10.1080/17449620903110300</p> <p>Philosophical analysis of egalitarian, sufficientarian, and prioritarian principles.</p> <p>[Caney 2010] Simon Caney. \"Climate change and the duties of the advantaged.\" Critical Review of International Social and Political Philosophy. DOI: 10.1080/13698230903326331</p> <p>Examines ability-to-pay and beneficiary-pays principles for burden-sharing.</p> <p>[Caney 2018] Simon Caney. \"Justice and Posterity.\" Climate Justice: Integrating Economics and Philosophy (Oxford University Press). DOI: 10.1093/oso/9780198813248.003.0009</p> <p>Discusses intergenerational justice and non-identity problem in climate policy.</p> <p>[Caney 2021] Simon Caney. \"Climate Justice.\" Stanford Encyclopedia of Philosophy (Winter 2021 Edition).</p> <p>Comprehensive overview of climate justice principles, debates, and challenges.</p> <p>[GCI 2003] Global Commons Institute. \"Contraction and Convergence: A global solution to climate change.\" Schumacher Briefings 5. Green Books.</p> <p>Original framework for global emissions contraction with convergence to equal per capita shares.</p> <p>[Dooley 2021] Kate Dooley, Zebedee Nicholls, and Malte Meinshausen. \"Ethical choices behind quantifications of fair contributions under the Paris Agreement.\" Nature Climate Change. DOI: 10.1038/s41558-021-01015-8</p> <p>Analyzes how different equity frameworks (CBDR, capability, need) produce different national fair shares.</p> <p>[Heyward 2021] Clare Heyward. \"Is the beneficiary pays principle essential in climate justice?.\" Norsk filosofisk tidsskrift. DOI: 10.18261/issn.1504-2901-2021-02-03-07</p> <p>Critical assessment of beneficiary-pays versus polluter-pays principles.</p> <p>[Hohne 2014] Niklas H\u00f6hne, Michel den Elzen, and Donovan Escalante. \"Regional GHG reduction targets based on effort sharing: a comparison of studies.\" Climate Policy. DOI: 10.1080/14693062.2014.849452</p> <p>Comparative analysis of effort-sharing approaches and their implications for regional targets.</p> <p>[ICJ 2025] International Court of Justice. \"Obligations of States in Respect of Climate Change (Advisory Opinion).\" ICJ Advisory Opinion.</p> <p>Landmark legal opinion on state obligations under international environmental law.</p> <p>[Kartha 2018] Sivan Kartha, Simon Caney, Navroz K. Dubash, and Greg Muttitt. \"Cascading biases against poorer countries.\" Nature Climate Change. DOI: 10.1038/s41558-018-0152-7</p> <p>Identifies systematic biases in carbon budget methodologies that disadvantage developing nations.</p> <p>[Klinsky 2018] Sonja Klinsky, Timmons Roberts, Saleemul Huq, Chukwumerije Okereke, Peter Newell, Peter Dauvergne, Karen O'Brien, Heike Schroeder, Petra Tschakert, Jennifer Clapp, Michael Keck, Frank Biermann, Diana Liverman, Joyeeta Gupta, Atiq Rahman, Dirk Messner, David Pellow, and Steffen Bauer. \"Building equity in: strategies for integrating equity into modelling for a 1.5C world.\" Philosophical Transactions of the Royal Society A. DOI: 10.1098/rsta.2016.0461</p> <p>Strategies for incorporating distributional and procedural equity in integrated assessment models.</p> <p>[Matthews 2016] H. Damon Matthews. \"Quantifying historical carbon and climate debts among nations.\" Nature Climate Change. DOI: 10.1038/NCLIMATE2774</p> <p>Quantifies cumulative emissions and temperature contributions by country since industrialization.</p> <p>[Meyer 2013] Lukas H. Meyer. \"Why Historical Emissions Should Count.\" Chicago Journal of International Law.</p> <p>Philosophical defense of historical responsibility in climate burden-sharing.</p> <p>[Morrow 2017] David R. Morrow. \"Fairness in Allocating the Global Emissions Budget.\" Environmental Values. DOI: 10.3197/096327117X15046905490335</p> <p>Evaluates allocation principles (grandfathering, equal per capita, ability to pay) for carbon budgets.</p> <p>[Muttitt 2020] Greg Muttitt, Sivan Kartha, Kevin Anderson, and Greig Aitken. \"Equity, climate justice and fossil fuel extraction: principles for a managed phase out.\" Climate Policy. DOI: 10.1080/14693062.2020.1763900</p> <p>Applies equity principles to supply-side policies for fossil fuel extraction.</p> <p>[Okereke 2016] Chukwumerije Okereke and Philip Coventry. \"Climate justice and the international regime: before, during, and after Paris.\" WIREs Climate Change. DOI: 10.1002/wcc.419</p> <p>Traces evolution of equity and justice in climate negotiations through Paris Agreement.</p> <p>[Pan 2003] Jiahua Pan. \"Emissions Rights and their Transferability: Equity Concerns over Climate Change Mitigation.\" International Environmental Agreements: Politics, Law and Economics.</p> <p>Early examination of emissions trading and equity implications for developing countries.</p> <p>[Pelz 2025a] Setu Pelz, Matthew Gidden, Jared Katzman, Carl-Friedrich Schleussner, and Keywan Riahi. \"Entry points for assessing 'fair shares' in national mitigation contributions.\" Environmental Research Letters. DOI: 10.1088/1748-9326/ada45f</p> <p>Framework for principles-first approach to national fair shares assessment. Core methodological foundation.</p> <p>[Pelz 2025b] Setu Pelz, Matthew J. Gidden, Jared Katzman, Carl-Friedrich Schleussner, and Keywan Riahi. \"Using net-zero carbon debt to track climate overshoot responsibility.\" Proceedings of the National Academy of Sciences. DOI: 10.1073/pnas.2409316122</p> <p>Introduces carbon debt accounting to track responsibility for overshooting carbon budgets.</p> <p>[Pickering 2012] Jonathan Pickering and Christian Barry. \"On the concept of climate debt: its moral and political value.\" Critical Review of International Social and Political Philosophy. DOI: 10.1080/13698230.2012.727311</p> <p>Conceptual analysis of climate debt and its role in North-South negotiations.</p> <p>[Rajamani 2021] Lavanya Rajamani, Jutta Brunn\u00e9e, Meinhard Doelle, Annalisa Savaresi, Daniel Bodansky, and Sandra Maljean-Dubois. \"National 'fair shares' in reducing greenhouse gas emissions within the principled framework of international environmental law.\" Climate Policy. DOI: 10.1080/14693062.2021.1970504</p> <p>Legal analysis of fair shares within CBDR-RC and Paris Agreement architecture.</p> <p>[Rajamani 2024] Lavanya Rajamani. \"Interpreting the Paris Agreement in its Normative Environment.\" Current Legal Problems. DOI: 10.1093/clp/cuae011</p> <p>Situates Paris Agreement within broader international environmental law principles.</p> <p>[Shue 2014] Henry Shue. \"Climate Justice: Vulnerability and Protection.\" Oxford University Press (Book).</p> <p>Foundational work on subsistence protection and basic rights in climate policy.</p> <p>[Shue 2015] Henry Shue. \"Historical Responsibility, Harm Prohibition, and Preservation Requirement: Core Practical Convergence on Climate Change.\" Moral Philosophy and Politics. DOI: 10.1515/mopp-2013-0009</p> <p>Identifies convergence between diverse ethical traditions on key climate principles.</p> <p>[Truccone-Borgogno 2022] Santiago Truccone-Borgogno. \"Climate Justice and the Duty of Restitution.\" Moral Philosophy and Politics. DOI: 10.1515/mopp-2021-0071</p> <p>Examines restitutive justice frameworks for historical emissions and climate harms.</p> <p>[Winkler 2020] Harald Winkler. \"Putting equity into practice in the global stocktake under the Paris Agreement.\" Climate Policy. DOI: 10.1080/14693062.2019.1680337</p> <p>Practical operationalization of equity principles in Paris Agreement's global stocktake.</p> <p>[Zimm 2024] Caroline Zimm, Beniamino Callegari, Jihoon Min, William F. Lamb, and Jarmo S. Kikstra. \"Justice considerations in climate research.\" Nature Climate Change. DOI: 10.1038/s41558-023-01869-0</p> <p>Review of how justice is integrated (or neglected) in climate modeling and scenario analysis.</p>"},{"location":"user-guide/","title":"User Guide","text":""},{"location":"user-guide/#workflows","title":"Workflows","text":"Workflow Notebook Description country-fair-shares <code>301_custom_fair_share_allocation.ipynb</code> Country-level allocations with pipeline iamc-regional-fair-shares <code>401_custom_iamc_allocation.ipynb</code> IAMC model region allocations <p>Both workflows produce relative shares (0-1) and absolute emissions (Mt CO2e).</p>"},{"location":"user-guide/#outputs","title":"Outputs","text":"Output Type Description Format Relative shares Country fractions summing to 1.0 Parquet, CSV Absolute emissions Shares x global target in physical units Parquet, CSV Comparison tables Results across multiple approaches/parameters CSV (wide)"},{"location":"user-guide/#configuration","title":"Configuration","text":"<p>Data sources are configured in <code>conf/data_sources/</code>.</p> Data Type Options Target <code>rcbs</code> (budgets), <code>ar6</code> (pathways), <code>rcb-pathways</code> Emissions PRIMAP-hist versions Population UN/OWID GDP World Bank WDI Gini UNU-WIDER <p>The <code>rcb-pathways</code> target converts a global remaining carbon budget into an annual emission pathway using exponential decay, then allocates it among countries. Set <code>target: \"rcb-pathways\"</code> in your data source config. See Other Operations for details.</p>"},{"location":"user-guide/#choosing-an-approach","title":"Choosing an Approach","text":"<p>Two questions:</p> <ol> <li>Budget or pathway? Do you need a single cumulative target or year-by-year emissions?</li> <li>Which principles? Equal entitlements, historical responsibility, capability, subsistence protection -- or some combination?</li> </ol> <p>Then:</p> <ul> <li>Approach Catalog -- all 10 approaches at a glance</li> <li>Principle-to-Code -- how principles map to parameters</li> <li>Allocation Approaches -- design and parameter details</li> </ul>"},{"location":"user-guide/approach-catalog/","title":"Approach Catalog","text":"<p>All 10 allocation approaches at a glance. For math, see the API Reference. For theory, see Allocation Approaches.</p>","boost":2},{"location":"user-guide/approach-catalog/#the-allocation-year-parameter","title":"The Allocation Year Parameter","text":"<p>The allocation year applies to all approaches (except <code>per-capita-convergence</code>) and represents a fundamental debate in climate equity literature: when do allocations begin? In budget approaches, this parameter is called <code>allocation_year</code>; in pathway approaches, it is called <code>first_allocation_year</code>.</p> <ul> <li>Early allocation_year (e.g., 1850, 1990): Accounts for historical responsibility by starting the \"equal entitlement clock\" earlier. Historical over-emitters have already consumed their fair share from that date forward.</li> <li>Recent allocation_year (e.g., 2015, 2020): Focuses on current/future population without accounting for historical emissions through this mechanism.</li> </ul> <p>This is distinct from (and complementary to) other responsibility mechanisms like <code>responsibility_weight</code> or cumulative accounting. The choice of allocation year is a normative parameter\u2014there is no neutral default.</p>","boost":2},{"location":"user-guide/approach-catalog/#budget-approaches","title":"Budget Approaches","text":"<p>Budget approaches allocate a cumulative emissions budget (e.g., a remaining carbon budget compatible with 1.5\u00b0C) at a single point in time, rather than allocating emissions year-by-year along a pathway.</p> <p>Use when: You need national targets for cumulative emissions (e.g., \"What share of the remaining carbon budget should each country get?\")</p> Approach Principles Best For Links <code>equal-per-capita-budget</code> Equal per capita National targets based on population shares API \u00b7 Science <code>per-capita-adjusted-budget</code> CBDR-RC, Capability Differentiated responsibility with historical emissions and GDP adjustments API \u00b7 Science <code>per-capita-adjusted-gini-budget</code> CBDR-RC, Capability, Sufficientarianism Adjusted allocation accounting for intra-national inequality (Gini coefficient) API \u00b7 Science <p>All budget approaches support Historical Responsibility via <code>allocation_year</code> (see above).</p>","boost":2},{"location":"user-guide/approach-catalog/#pathway-approaches","title":"Pathway Approaches","text":"<p>Pathway approaches allocate emissions over multiple years, producing annual emission shares that collectively respect a global emissions trajectory.</p> <p>Use when: You need year-by-year emissions guidance (e.g., \"What emissions pathway should each country follow to 2050?\")</p>","boost":2},{"location":"user-guide/approach-catalog/#equal-per-capita-family","title":"Equal Per Capita Family","text":"Approach Principles Best For Links <code>equal-per-capita</code> Equal per capita Pathways based on population shares API \u00b7 Science <code>per-capita-adjusted</code> CBDR-RC, Capability Pathways with historical emissions and GDP adjustments API \u00b7 Science <code>per-capita-adjusted-gini</code> CBDR-RC, Capability, Sufficientarianism Adjusted pathways accounting for intra-national inequality API \u00b7 Science <p>All Equal Per Capita approaches support Historical Responsibility via <code>first_allocation_year</code> (see above).</p>","boost":2},{"location":"user-guide/approach-catalog/#convergence-family","title":"Convergence Family","text":"<p>Convergence approaches allow countries to gradually transition from current emissions to their fair share target.</p> Approach Principles Best For Links <code>per-capita-convergence</code> Transition mechanism (not equity-based)* Comparing against grandfathering baselines API \u00b7 Science <code>cumulative-per-capita-convergence</code> CBDR-RC, Cumulative accounting Transition pathways that account for cumulative historical emissions API \u00b7 Science <code>cumulative-per-capita-convergence-adjusted</code> CBDR-RC, Capability, Cumulative accounting Cumulative convergence with responsibility and capability adjustments API \u00b7 Science <code>cumulative-per-capita-convergence-gini-adjusted</code> CBDR-RC, Capability, Sufficientarianism, Cumulative accounting Cumulative convergence accounting for intra-national inequality API \u00b7 Science <p>All Convergence approaches (except <code>per-capita-convergence</code>) support Historical Responsibility via <code>first_allocation_year</code> (see above). The cumulative approaches additionally account for historical emissions through cumulative per-capita accounting.</p> <p>Note on <code>per-capita-convergence</code>: This approach privileges current emission patterns during the transition period (grandfathering). It is not generally considered a fair share approach in the literature because it allocates more to currently high-emitting countries without equity-based justification (see Morrow 2017, Caney 2009). It is included for comparison with equity-based approaches.</p>","boost":2},{"location":"user-guide/approach-catalog/#choosing-an-approach","title":"Choosing an Approach","text":"<ol> <li>Budget vs Pathway? Do you need a single cumulative target or year-by-year guidance?</li> <li>Account for history? Set early <code>allocation_year</code>, and/or use cumulative approaches, and/or use <code>responsibility_weight</code></li> <li>Account for capability? Use <code>-adjusted</code> variants with <code>responsibility_weight</code> and <code>capability_weight</code></li> <li>Account for inequality within countries? Use <code>-gini</code> variants</li> </ol> <p>See From Principle to Code for how principles map to parameters.</p>","boost":2},{"location":"user-guide/approach-catalog/#registry-reference","title":"Registry Reference","text":"<p>All approaches are registered in <code>src/fair_shares/library/allocations/registry.py</code>. The registry maps approach names (kebab-case) to implementation functions.</p> <p>To get a list of all available approaches programmatically:</p> Python<pre><code>from fair_shares.library.allocations.registry import get_allocation_functions\n\napproaches = get_allocation_functions()\nprint(list(approaches.keys()))\n</code></pre>","boost":2},{"location":"user-guide/approach-catalog/#adding-approaches","title":"Adding Approaches","text":"<p>See the Developer Guide.</p>","boost":2},{"location":"user-guide/country-fair-shares/","title":"country-fair-shares","text":"<p>The <code>301_custom_fair_share_allocation.ipynb</code> notebook calculates fair share allocations for individual countries.</p>"},{"location":"user-guide/country-fair-shares/#workflow","title":"Workflow","text":"<pre><code>graph LR\n    A[1. Data Sources] --&gt; B[2. Approaches]\n    B --&gt; C[3. Pipeline]\n    C --&gt; D[4. Allocations]\n    D --&gt; E[5. Results]</code></pre> Step Action Data Sources Select emissions, population, GDP datasets Approaches Configure allocation approach parameters Pipeline Run data preprocessing (automated) Allocations Calculate country shares Results Export to Parquet/CSV"},{"location":"user-guide/country-fair-shares/#step-1-data-sources","title":"Step 1: Data Sources","text":""},{"location":"user-guide/country-fair-shares/#emission-category","title":"Emission Category","text":"Category Description <code>co2-ffi</code> (default) CO2 from fossil fuels and industry <code>all-ghg-ex-co2-lulucf</code> All GHGs excluding CO2 from land use <code>all-ghg</code> All greenhouse gases including LULUCF"},{"location":"user-guide/country-fair-shares/#target-source","title":"Target Source","text":"Source Description <code>rcbs</code> Remaining Carbon Budgets - single cumulative values <code>ar6</code> IPCC AR6 scenarios - time-series pathways <code>rcb-pathways</code> Remaining Carbon Budgets - time-series pathways"},{"location":"user-guide/country-fair-shares/#supporting-data","title":"Supporting Data","text":"Data Type Purpose <code>emissions</code> Historical emissions for responsibility calculations <code>population</code> Per capita calculations <code>gdp</code> Capability-based adjustments <code>gini</code> Within-country inequality adjustments <p>Available sources are configured in <code>conf/data_sources/</code>.</p>"},{"location":"user-guide/country-fair-shares/#step-2-allocation-approaches","title":"Step 2: Allocation Approaches","text":""},{"location":"user-guide/country-fair-shares/#budget-approaches-for-targetrcbs","title":"Budget Approaches (for <code>target=\"rcbs\"</code>)","text":"Approach Description <code>equal-per-capita-budget</code> Equal share per person <code>per-capita-adjusted-budget</code> Adjusted for responsibility and capability <code>per-capita-adjusted-gini-budget</code> Further adjusted for within-country inequality"},{"location":"user-guide/country-fair-shares/#pathway-approaches-for-targetar6-or-targetrcb-pathways","title":"Pathway Approaches (for <code>target=\"ar6\"</code> or <code>target=\"rcb-pathways\"</code>)","text":"Approach Description <code>equal-per-capita</code> Equal share per person per year <code>per-capita-adjusted</code> Adjusted for responsibility and capability <code>per-capita-adjusted-gini</code> Further adjusted for within-country inequality <code>per-capita-convergence</code> Transition from current emissions to equal per capita (comparison only) <code>cumulative-per-capita-convergence</code> Budget-preserving transition from current emissions to cumulative targets <code>cumulative-per-capita-convergence-adjusted</code> Cumulative convergence with responsibility and capability adjustments <code>cumulative-per-capita-convergence-gini-adjusted</code> Cumulative convergence accounting for intra-national inequality <p>For detailed explanations, see Allocation Approaches.</p>"},{"location":"user-guide/country-fair-shares/#step-3-data-pipeline","title":"Step 3: Data Pipeline","text":"<p>The pipeline runs automatically when you execute the Step 3 cell. It:</p> <ol> <li>Validates your configuration</li> <li>Loads raw data files</li> <li>Processes emissions, GDP, population data</li> <li>Prepares target scenarios or budgets</li> <li>Saves processed files for allocation</li> </ol> <p>Processing typically takes 1-3 minutes depending on data sources.</p>"},{"location":"user-guide/country-fair-shares/#step-4-run-allocations","title":"Step 4: Run Allocations","text":"<p>The allocation step:</p> <ol> <li>Loads processed data from the pipeline</li> <li>Runs each approach with all parameter combinations</li> <li>Calculates relative shares (summing to 1)</li> <li>Computes absolute emissions (Mt CO2e)</li> <li>Saves results to parquet and CSV</li> </ol>"},{"location":"user-guide/country-fair-shares/#step-5-explore-results","title":"Step 5: Explore Results","text":""},{"location":"user-guide/country-fair-shares/#output-files","title":"Output Files","text":"<p>Results are saved to <code>output/{source_id}/allocations/{allocation_folder}/</code>:</p> File Format Description <code>allocations_relative.parquet</code> Parquet Relative shares (0-1) <code>allocations_absolute.parquet</code> Parquet Absolute emissions (Mt CO2e) <code>allocations_wide.csv</code> CSV Wide format for spreadsheets <code>param_manifest.csv</code> CSV All parameter combinations"},{"location":"user-guide/country-fair-shares/#output-types","title":"Output Types","text":"<ul> <li>Relative shares: Country fractions summing to 1.0 per year</li> <li>Absolute emissions: Relative share \u00d7 global target in physical units</li> </ul>"},{"location":"user-guide/country-fair-shares/#comparing-approaches","title":"Comparing Approaches","text":"<p>To compare multiple allocation approaches:</p> Python<pre><code>allocations = {\n    \"equal-per-capita-budget\": [\n        {\"allocation_year\": [2020], \"preserve_allocation_year_shares\": [False]}\n    ],\n    \"per-capita-adjusted-budget\": [\n        {\n            \"allocation_year\": [2020],\n            \"preserve_allocation_year_shares\": [False],\n            \"responsibility_weight\": [0.5],\n            \"capability_weight\": [0.5],\n        }\n    ],\n}\n</code></pre> <p>Both approaches run in a single pipeline execution. Results include an <code>approach</code> column for filtering.</p>"},{"location":"user-guide/country-fair-shares/#reference-notebooks","title":"Reference Notebooks","text":"Notebook Purpose <code>302_example_templates_budget_allocations.py</code> Budget allocation examples <code>303_example_templates_pathway_allocations.py</code> Pathway allocation examples"},{"location":"user-guide/country-fair-shares/#see-also","title":"See Also","text":"<ul> <li>Allocation Approaches - Theoretical foundations</li> <li>API Reference - Function signatures</li> <li>Other Operations - RCB pathway generation, net-negative handling</li> </ul>"},{"location":"user-guide/iamc-regional-fair-shares/","title":"iamc-regional-fair-shares","text":"<p>The <code>401_custom_iamc_allocation.ipynb</code> notebook calculates fair share allocations for IAMC model regions and prepares remaining budgets for IAM model input.</p> <p>For allocation examples without model preparation, see:</p> <ul> <li><code>402_example_iamc_budget_allocations.ipynb</code> - Budget allocation examples</li> <li><code>403_example_iamc_pathway_allocations.ipynb</code> - Pathway allocation examples</li> </ul> <p>Use this workflow with IAMC-format scenario data (model, scenario, region, variable, year columns). For country-level allocations, use country-fair-shares.</p>"},{"location":"user-guide/iamc-regional-fair-shares/#data-requirements","title":"Data Requirements","text":""},{"location":"user-guide/iamc-regional-fair-shares/#iamc-format","title":"IAMC Format","text":"<p>Your data should have columns:</p> Column Description <code>model</code> Model name (e.g., \"SSP_SSP2_v6.3_ES\") <code>scenario</code> Scenario name (e.g., \"ECPC-2015-800Gt\") <code>region</code> Region identifier <code>variable</code> Variable name Year columns <code>1990</code>, <code>1995</code>, <code>2000</code>, <code>2015</code>, <code>2020</code>, <code>2025</code>, ..."},{"location":"user-guide/iamc-regional-fair-shares/#required-variables","title":"Required Variables","text":"Variable Purpose <code>Population</code> Per capita calculations <code>GDP\\|PPP</code> Capability adjustments (optional) <p>An emissions variable is needed only if you're subtracting historical emissions to compute remaining budgets (see Preparing Remaining Budgets). The variable name is configurable -- use whatever your IAMC data provides.</p>"},{"location":"user-guide/iamc-regional-fair-shares/#key-functions","title":"Key Functions","text":""},{"location":"user-guide/iamc-regional-fair-shares/#loading-data","title":"Loading Data","text":"Python<pre><code>from fair_shares.library.utils.data.iamc import load_iamc_data\n\ndata = load_iamc_data(\n    data_file=\"data/scenarios/iamc_example/iamc_reporting_example.xlsx\",\n    population_variable=\"Population\",\n    gdp_variable=\"GDP|PPP\",\n    regions=[\"AFR\", \"CHN\", \"EEU\", \"FSU\", \"LAM\", \"MEA\", \"NAM\", \"PAO\", \"PAS\", \"RCPA\", \"SAS\", \"WEU\"],\n    allocation_start_year=2015,\n    budget_end_year=2100,\n    expand_to_annual=True,  # Interpolate non-annual data\n)\n</code></pre>"},{"location":"user-guide/iamc-regional-fair-shares/#equal-per-capita-allocation","title":"Equal Per Capita Allocation","text":"Python<pre><code>from fair_shares.library.allocations.budgets.per_capita import equal_per_capita_budget\n\n# Extract dataframes from loaded data\npopulation_ts = data[\"population\"].rename_axis(index={\"region\": \"iso3c\"})\n\nresult = equal_per_capita_budget(\n    population_ts=population_ts,\n    allocation_year=2015,\n    emission_category=\"all-ghg-ex-co2-lulucf\",\n    preserve_allocation_year_shares=False,\n    group_level=\"iso3c\",\n)\n\nshares = result.relative_shares_cumulative_emission[\"2015\"]\n</code></pre>"},{"location":"user-guide/iamc-regional-fair-shares/#capability-adjusted-allocation","title":"Capability-Adjusted Allocation","text":"Python<pre><code>from fair_shares.library.allocations.budgets.per_capita import per_capita_adjusted_budget\n\n# Extract dataframes from loaded data\npopulation_ts = data[\"population\"].rename_axis(index={\"region\": \"iso3c\"})\ngdp_ts = data[\"gdp\"].rename_axis(index={\"region\": \"iso3c\"})\n\nresult = per_capita_adjusted_budget(\n    population_ts=population_ts,\n    gdp_ts=gdp_ts,\n    allocation_year=2015,\n    emission_category=\"all-ghg-ex-co2-lulucf\",\n    capability_weight=0.5,\n    responsibility_weight=0.0,\n    historical_responsibility_year=1990,\n    preserve_allocation_year_shares=False,\n    group_level=\"iso3c\",\n)\n</code></pre>"},{"location":"user-guide/iamc-regional-fair-shares/#preparing-remaining-budgets-for-iam-model-input","title":"Preparing Remaining Budgets for IAM Model Input","text":"<p>Use notebook 401 for model input preparation. Notebooks 402/403 show allocation examples only.</p>"},{"location":"user-guide/iamc-regional-fair-shares/#understanding-timesteps-vs-periods","title":"Understanding Timesteps vs Periods","text":"<p>IAM models often use timestep labels that represent multi-year periods. For example, in MESSAGEix, timestep <code>2030</code> represents 2026-2030, <code>2040</code> represents 2031-2040, etc.</p> <p>Critical: Your remaining budget must start from the first year of the first period, not the timestep label.</p>"},{"location":"user-guide/iamc-regional-fair-shares/#calculation-method","title":"Calculation Method","text":"<p>If allocating from 2015 and your first model period is 2026-2030:</p> Text Only<pre><code>Remaining Budget (from 2026) = Fair Share Allocation (2015\u2192) - Actual Emissions (2015-2025)\n</code></pre> <p>Steps:</p> <ol> <li>Run allocation from your allocation year (e.g., 2015)</li> <li>Subtract cumulative actual emissions from allocation year to (first period start - 1)</li> <li>Export remaining budget in Mt CO2e</li> <li>Use as cumulative emission constraint in your model (e.g., <code>bound_emission</code> in MESSAGEix)</li> </ol>"},{"location":"user-guide/iamc-regional-fair-shares/#example-workflow-in-notebook-401","title":"Example Workflow in Notebook 401","text":"<p>See \"Step 7: Prepare for IAM Model Input\" in notebook 401 for:</p> <ul> <li>Configuration cells for model timestep/period</li> <li>Automated calculation of remaining budgets</li> <li>Export in model-ready format</li> </ul> <p>Important:</p> <ul> <li>Emissions must be annual (use <code>expand_to_annual=True</code> when loading data)</li> <li>Units should match your model (typically Mt CO2e)</li> <li>Negative remaining budgets indicate the region has exceeded its allocation</li> </ul>"},{"location":"user-guide/iamc-regional-fair-shares/#handling-model-timesteps","title":"Handling Model Timesteps","text":"<p>The notebook automatically handles different timestep patterns from IAMC models:</p> <ul> <li>Annual data (2020, 2021, 2022, ...) - No interpolation needed</li> <li>5-year intervals (2020, 2025, 2030, ...) - Interpolates to annual when <code>expand_to_annual=True</code></li> <li>10-year intervals (2020, 2030, 2040, ...) - Interpolates to annual when <code>expand_to_annual=True</code></li> <li>Mixed patterns - Handles non-uniform timesteps automatically</li> </ul>"},{"location":"user-guide/iamc-regional-fair-shares/#see-also","title":"See Also","text":"<ul> <li>country-fair-shares - Full pipeline for country-level analysis</li> <li>Allocation Approaches - Theoretical foundations</li> <li>Budget Functions API - Function signatures</li> </ul>"},{"location":"user-guide/output-schema/","title":"Output Schema","text":"<p>This page documents the structure of allocation outputs and how parquet files are transformed to CSV format.</p>"},{"location":"user-guide/output-schema/#output-files","title":"Output Files","text":"<p>All allocation runs produce four output files:</p> File Format Description <code>allocations_relative.parquet</code> Parquet Country fractions summing to 1.0 (all columns) <code>allocations_absolute.parquet</code> Parquet Shares \u00d7 global target in Mt CO2e (all columns) <code>allocations_wide.csv</code> CSV Simplified wide format for spreadsheet use <code>param_manifest.csv</code> CSV Parameter combinations used in the run"},{"location":"user-guide/output-schema/#parquet-format-full-detail","title":"Parquet Format (Full Detail)","text":"<p>The parquet files contain the complete allocation results with all metadata and parameter columns.</p>"},{"location":"user-guide/output-schema/#identifier-columns","title":"Identifier Columns","text":"Column Type Description <code>iso3c</code> string Country code (e.g., 'USA', 'CHN') <code>approach</code> string Allocation method (e.g., 'equal-per-capita-budget') <code>climate-assessment</code> string Climate scenario (e.g., '1.5C', '2C') <code>quantile</code> string Probability percentile (e.g., '0.5' for median) <code>emission-category</code> string Emission type (e.g., 'co2-ffi', 'all-ghg')"},{"location":"user-guide/output-schema/#data-source-columns","title":"Data Source Columns","text":"Column Type Description <code>source-id</code> string Composite data source identifier <code>emissions-source</code> string Historical emissions dataset <code>gdp-source</code> string GDP dataset <code>population-source</code> string Population dataset <code>gini-source</code> string Gini coefficient dataset <code>target-source</code> string Target type ('rcbs', 'ar6', etc.)"},{"location":"user-guide/output-schema/#parameter-columns","title":"Parameter Columns","text":"<p>Individual parameter columns for each allocation approach:</p> Column Type Used By <code>allocation-year</code> int Budget approaches <code>first-allocation-year</code> int Pathway approaches <code>preserve-allocation-year-shares</code> bool Budget approaches <code>preserve-first-allocation-year-shares</code> bool Pathway approaches <code>responsibility-weight</code> float Adjusted approaches <code>capability-weight</code> float Adjusted approaches <code>historical-responsibility-year</code> int Adjusted approaches <code>responsibility-per-capita</code> bool Adjusted approaches <code>capability-per-capita</code> bool Adjusted approaches <code>responsibility-exponent</code> float Adjusted approaches <code>capability-exponent</code> float Adjusted approaches <code>responsibility-functional-form</code> string Adjusted approaches <code>capability-functional-form</code> string Adjusted approaches <code>max-deviation-sigma</code> float All approaches (optional) <code>income-floor</code> float Gini-adjusted approaches <code>max-gini-adjustment</code> float Gini-adjusted approaches <code>convergence-year</code> int Convergence approaches <code>convergence-speed</code> float Convergence approaches"},{"location":"user-guide/output-schema/#year-columns","title":"Year Columns","text":"Column Pattern Type Description <code>\"2020\"</code> etc. float Allocation values for each year (strings) <p>Note: Year columns are stored as strings, not integers. Always use <code>\"2020\"</code>, not <code>2020</code>.</p>"},{"location":"user-guide/output-schema/#quality-columns","title":"Quality Columns","text":"Column Type Description <code>warnings</code> string Quality warnings (if any) <code>missing-net-negative-mtco2e</code> float Missing net-negative emissions"},{"location":"user-guide/output-schema/#csv-format-simplified","title":"CSV Format (Simplified)","text":"<p>The <code>allocations_wide.csv</code> file simplifies the parquet structure for spreadsheet use by:</p> <ol> <li>Combining relative and absolute into one file with a <code>data-type</code> column</li> <li>Collapsing parameter columns into <code>approach-short</code></li> <li>Collapsing metadata columns into <code>variable</code></li> <li>Excluding redundant columns</li> <li>Converting to kebab-case for consistency</li> </ol>"},{"location":"user-guide/output-schema/#column-transformation","title":"Column Transformation","text":""},{"location":"user-guide/output-schema/#1-data-type-column-added","title":"1. Data Type Column (Added)","text":"Column Type Values <code>data-type</code> string 'relative', 'absolute' <p>Indicates whether values are fractions (relative) or Mt CO2e (absolute).</p>"},{"location":"user-guide/output-schema/#2-approach-short-collapsed","title":"2. Approach Short (Collapsed)","text":"<p>The <code>approach-short</code> column collapses all parameter columns into a compact code:</p> <p>Format: <code>{approach-code}-{param1}{value1}-{param2}{value2}...</code></p> <p>Example transformations:</p> Parquet Columns CSV <code>approach-short</code> <code>approach=\"equal-per-capita\"</code>, <code>first-allocation-year=2020</code> <code>EPC-y2020</code> <code>approach=\"per-capita-adjusted\"</code>, <code>responsibility-weight=0.5</code>, <code>capability-weight=0.5</code> <code>PC-Adj-rw0.5-cw0.5</code> <code>approach=\"cumulative-per-capita-convergence\"</code>, <code>convergence-speed=0.42</code> <code>CPCC-cs0.42</code> <p>Approach codes:</p> Full Approach Name Short Code <code>equal-per-capita</code> <code>EPC</code> <code>per-capita-adjusted</code> <code>PC-Adj</code> <code>per-capita-adjusted-gini</code> <code>PC-Adj-Gini</code> <code>per-capita-convergence</code> <code>PCC</code> <code>cumulative-per-capita-convergence</code> <code>CPCC</code> <code>cumulative-per-capita-convergence-adjusted</code> <code>CPCC-Adj</code> <code>cumulative-per-capita-convergence-gini-adjusted</code> <code>CPCC-Adj-Gini</code> <code>equal-per-capita-budget</code> <code>EPC-B</code> <code>per-capita-adjusted-budget</code> <code>PC-Adj-B</code> <code>per-capita-adjusted-gini-budget</code> <code>PC-Adj-Gini-B</code> <p>Parameter prefixes:</p> Parameter Prefix <code>first-allocation-year</code> <code>y</code> <code>allocation-year</code> <code>ay</code> <code>preserve-first-allocation-year-shares</code> <code>pfa</code> <code>preserve-allocation-year-shares</code> <code>pa</code> <code>convergence-year</code> <code>c</code> <code>convergence-speed</code> <code>cs</code> <code>responsibility-weight</code> <code>rw</code> <code>capability-weight</code> <code>cw</code> <code>historical-responsibility-year</code> <code>hr</code> <code>responsibility-per-capita</code> <code>rpc</code> <code>capability-per-capita</code> <code>cpc</code> <code>responsibility-exponent</code> <code>re</code> <code>capability-exponent</code> <code>ce</code> <code>responsibility-functional-form</code> <code>rff</code> <code>capability-functional-form</code> <code>cff</code> <code>max-deviation-sigma</code> <code>s</code> <code>income-floor</code> <code>if</code> <code>max-gini-adjustment</code> <code>ga</code>"},{"location":"user-guide/output-schema/#3-variable-column-collapsed","title":"3. Variable Column (Collapsed)","text":"<p>The <code>variable</code> column encodes key metadata in pipe-delimited format:</p> <p>Format: <code>{emission-category}|{target-source}|{source}|{climate-assessment}|{quantile}|{approach-short}</code></p> <p>Example:</p> Text Only<pre><code>co2-ffi|rcbs|primap-hist-v2.5|1.5C|0.5|EPC-y2020\n</code></pre> <p>This enables filtering and pivoting in spreadsheet software.</p>"},{"location":"user-guide/output-schema/#4-csv-column-order","title":"4. CSV Column Order","text":"<p>The CSV uses this column order:</p> <ol> <li>Data Context: <code>source-id</code>, <code>allocation-folder</code></li> <li>Source Data: <code>emissions-source</code>, <code>gdp-source</code>, <code>population-source</code>, <code>gini-source</code></li> <li>Target: <code>target-source</code></li> <li>Approach: <code>data-type</code>, <code>approach-short</code>, <code>variable</code></li> <li>Identity: <code>iso3c</code>, <code>unit</code></li> <li>Quality: <code>warnings</code>, <code>missing-net-negative-mtco2e</code></li> <li>Years: <code>2020</code>, <code>2021</code>, ..., <code>2100</code> (in chronological order)</li> </ol>"},{"location":"user-guide/output-schema/#5-excluded-columns","title":"5. Excluded Columns","text":"<p>These columns from parquet are excluded from CSV:</p> <p>Parameter columns (collapsed into <code>approach-short</code>):</p> <ul> <li>All individual parameter columns listed in Parquet Format section</li> </ul> <p>Metadata columns (collapsed into <code>variable</code> or redundant):</p> <ul> <li><code>approach</code> (encoded in <code>approach-short</code>)</li> <li><code>emission-category</code> (encoded in <code>variable</code>)</li> <li><code>climate-assessment</code> (encoded in <code>variable</code>)</li> <li><code>quantile</code> (encoded in <code>variable</code>)</li> <li><code>source</code> (encoded in <code>variable</code>)</li> </ul>"},{"location":"user-guide/output-schema/#customizing-csv-output","title":"Customizing CSV Output","text":"<p>The CSV transformation can be customized when calling <code>convert_parquet_to_wide_csv()</code>:</p>"},{"location":"user-guide/output-schema/#custom-parameter-prefixes","title":"Custom Parameter Prefixes","text":"Python<pre><code>from fair_shares.library.utils.data.parquet_to_csv import convert_parquet_to_wide_csv\n\n# Use custom prefixes for specific parameters\ncustom_prefixes = {\n    \"responsibility-weight\": \"resp\",\n    \"capability-weight\": \"cap\",\n}\n\nconvert_parquet_to_wide_csv(\n    allocations_dir=\"output/example/allocations/run-001/\",\n    config_prefixes=custom_prefixes\n)\n</code></pre> <p>Result: <code>PC-Adj-resp0.5-cap0.5</code> instead of <code>PC-Adj-rw0.5-cw0.5</code></p>"},{"location":"user-guide/output-schema/#custom-approach-names","title":"Custom Approach Names","text":"Python<pre><code># Use custom short codes for approaches\ncustom_names = {\n    \"equal-per-capita\": \"Equal\",\n    \"per-capita-adjusted\": \"Adjusted\",\n}\n\nconvert_parquet_to_wide_csv(\n    allocations_dir=\"output/example/allocations/run-001/\",\n    approach_names=custom_names\n)\n</code></pre> <p>Result: <code>Equal-y2020</code> instead of <code>EPC-y2020</code></p>"},{"location":"user-guide/output-schema/#working-with-outputs","title":"Working with Outputs","text":""},{"location":"user-guide/output-schema/#in-python-parquet","title":"In Python (Parquet)","text":"Python<pre><code>import pandas as pd\n\n# Load full detail\ndf_relative = pd.read_parquet(\"allocations_relative.parquet\")\ndf_absolute = pd.read_parquet(\"allocations_absolute.parquet\")\n\n# Filter by approach\nepc = df_relative[df_relative[\"approach\"] == \"equal-per-capita\"]\n\n# Filter by parameter value\nhigh_responsibility = df_relative[df_relative[\"responsibility-weight\"] &gt;= 0.5]\n</code></pre>"},{"location":"user-guide/output-schema/#in-python-csv","title":"In Python (CSV)","text":"Python<pre><code>import pandas as pd\n\n# Load simplified format\ndf = pd.read_csv(\"allocations_wide.csv\")\n\n# Separate relative and absolute\nrelative = df[df[\"data-type\"] == \"relative\"]\nabsolute = df[df[\"data-type\"] == \"absolute\"]\n\n# Filter by approach-short\nepc = df[df[\"approach-short\"].str.startswith(\"EPC\")]\n</code></pre>"},{"location":"user-guide/output-schema/#in-r-parquet","title":"In R (Parquet)","text":"S<pre><code>library(arrow)\n\n# Load full detail\ndf_relative &lt;- read_parquet(\"allocations_relative.parquet\")\ndf_absolute &lt;- read_parquet(\"allocations_absolute.parquet\")\n\n# Filter by approach\nepc &lt;- df_relative %&gt;%\n  filter(approach == \"equal-per-capita\")\n</code></pre>"},{"location":"user-guide/output-schema/#in-excel-csv","title":"In Excel (CSV)","text":"<ol> <li>Open <code>allocations_wide.csv</code> directly</li> <li>Filter by <code>data-type</code> column to see relative or absolute</li> <li>Filter by <code>approach-short</code> to compare approaches</li> <li>Use pivot tables with <code>variable</code> column for cross-cutting analysis</li> </ol>"},{"location":"user-guide/output-schema/#see-also","title":"See Also","text":"<ul> <li>User Guide - Workflows for running allocations</li> <li>API Reference - Function documentation</li> <li>Allocation Approaches - Approach descriptions and parameters</li> </ul>"}]}